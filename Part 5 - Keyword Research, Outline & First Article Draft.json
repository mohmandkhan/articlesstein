{
  "name": "Part 5 - Keyword Research, Outline & First Article Draft",
  "nodes": [
    {
      "parameters": {
        "content": "## ->",
        "height": 224,
        "width": 336,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1296,
        272
      ],
      "id": "64e6be76-5e05-4a07-9e83-63015bb1d38f",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "wa0kkSaygUdBVzcF",
          "mode": "list",
          "cachedResultName": "Business Data",
          "cachedResultUrl": "/projects/6s3sOILcGEL9TSZr/datatables/wa0kkSaygUdBVzcF"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "session_id",
              "keyValue": "={{ $json['Business Data Session ID'] }}"
            }
          ]
        },
        "limit": 1
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        1344,
        336
      ],
      "id": "964493f2-6926-4416-90b2-3fc25c4f7724",
      "name": "Get Business Data"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "wa0kkSaygUdBVzcF",
          "mode": "list",
          "cachedResultName": "[-KR- Business Data]",
          "cachedResultUrl": "/projects/6s3sOILcGEL9TSZr/datatables/wa0kkSaygUdBVzcF"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "session_id",
              "keyValue": "={{ $('SessioN Data üëÄ').first().json['Business Data Session ID'] }}"
            }
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTableTool",
      "typeVersion": 1,
      "position": [
        544,
        560
      ],
      "id": "94af1b10-876d-4b35-ae12-27067810378a",
      "name": "get_business_Data"
    },
    {
      "parameters": {
        "description": "This tool provides keywords that the client's page is ranking for.",
        "workflowId": {
          "__rl": true,
          "value": "yDmk0mHvY4VD8NMa",
          "mode": "list",
          "cachedResultUrl": "/workflow/yDmk0mHvY4VD8NMa",
          "cachedResultName": "Laboratory ‚Äî Part 0 - Tools"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "function": "get_business_ranked_keywords",
            "location_code": "={{ $('SessioN Data üëÄ').first().json.location_code }}",
            "language_code": "={{ $('SessioN Data üëÄ').first().json.language_code }}",
            "keyword": "={{ $('SessioN Data üëÄ').first().json['Business Data Session ID'] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "function",
              "displayName": "function",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "keyword",
              "displayName": "keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "location_code",
              "displayName": "location_code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "language_code",
              "displayName": "language_code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        720,
        560
      ],
      "id": "af8afc54-60f2-4d48-83fd-26cd71d3d240",
      "name": "Get_business_ranked_Keywords"
    },
    {
      "parameters": {
        "content": "## -> From Sheets",
        "height": 224,
        "width": 352,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        704,
        272
      ],
      "id": "d4d34efa-374a-452c-949f-f2382da7a8c4",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "content": "# Step 5 - Keyword Research, Outline & First Article Draft",
        "height": 80,
        "width": 928,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        480,
        176
      ],
      "id": "c0f9a87d-5472-4150-b1d7-4167f45468e1",
      "name": "Sticky Note44"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "PwFZmKMBnjrG13CE",
          "mode": "list",
          "cachedResultName": "EEAT Citations",
          "cachedResultUrl": "/projects/6s3sOILcGEL9TSZr/datatables/PwFZmKMBnjrG13CE"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "session_id",
              "keyValue": "={{ $('SessioN Data üëÄ').first().json['Business Data Session ID'] }}"
            }
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTableTool",
      "typeVersion": 1,
      "position": [
        960,
        1408
      ],
      "id": "e24e8f9c-6b08-4faa-ba18-9c8769cb5c67",
      "name": "get_eeat_citations"
    },
    {
      "parameters": {
        "content": "## -> Outline Generation",
        "height": 224,
        "width": 304,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        480,
        960
      ],
      "id": "fef05185-2b48-4647-8d70-bb5821539e2c",
      "name": "Sticky Note58"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1rWyiIdQh_rWtiSYdJm4qNvc1LqduTdaJbBu6sXXzmzM",
          "mode": "list",
          "cachedResultName": "WordPress Content Engine v2",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rWyiIdQh_rWtiSYdJm4qNvc1LqduTdaJbBu6sXXzmzM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1328152878,
          "mode": "list",
          "cachedResultName": "Wordpress Content",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rWyiIdQh_rWtiSYdJm4qNvc1LqduTdaJbBu6sXXzmzM/edit#gid=1328152878"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Date": "={{ $now.toFormat(\"dd LLLL yyyy\") }}",
            "Title": "={{ $json.body.rowValues[0]['2'] }}",
            "Status": "Processing"
          },
          "matchingColumns": [
            "Title"
          ],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Topic input",
              "displayName": "Topic input",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Title",
              "displayName": "Title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Description",
              "displayName": "Description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Keyword Research",
              "displayName": "Keyword Research",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Outline",
              "displayName": "Outline",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Wordpress Draft Link",
              "displayName": "Wordpress Draft Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        912,
        336
      ],
      "id": "1d782510-647a-45cd-b838-a9a80680d13d",
      "name": "Update Processing",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "LLp60YlJOI8qZKgK",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "content": "### -> Session Data",
        "height": 224,
        "width": 208,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1072,
        272
      ],
      "id": "6553f587-5771-4ea8-8749-366e00c9b5fd",
      "name": "Sticky Note59"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3b9b69d8-ab3e-4ee0-b6d3-2dcfb41832ea",
              "name": "Internal Links Session ID",
              "value": "=21collagen6Nov2025",
              "type": "string"
            },
            {
              "id": "60ec7b85-f558-4bdf-b79d-f24907184718",
              "name": "Business Data Session ID",
              "value": "=cc86578",
              "type": "string"
            },
            {
              "id": "5705eb38-47fd-401d-b9a4-44cfb0b71afe",
              "name": "location_code",
              "value": "=2642",
              "type": "string"
            },
            {
              "id": "833bc73b-7f47-4d27-9ff5-e814028b1fe1",
              "name": "language_code",
              "value": "=ro",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1136,
        336
      ],
      "id": "b2860097-5b84-4a36-8c62-f55965c1e4e3",
      "name": "SessioN Data üëÄ"
    },
    {
      "parameters": {
        "content": "`insert session data`",
        "height": 176,
        "width": 182,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1088,
        304
      ],
      "id": "5e1a4434-0c95-48cd-8ce0-f215ed55553e",
      "name": "Sticky Note63"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $json.candidates[0].content.parts[0].text }}"
            }
          ]
        },
        "simplify": false,
        "options": {
          "systemMessage": "=# **Content Outline Creator Agent**\n\nYou are a Content Outline Specialist creating AI-citable, EEAT-compliant article outlines for writers to execute.\n\n**Context:**\n- Client: {{ $('Get Business Data').item.json.client_name }}\n- Market: {{ $('Get Business Data').item.json.client_country }}\n- Language: {{ $('Get Business Data').item.json.client_language }}\n- Date: {{ $now.toFormat(\"dd LLLL yyyy\") }}\n\n---\n\n## üéØ Your Mission\n\nCreate clean, actionable outlines that enable writers to produce:\n1. **AI-citable content** - Answer-first structure, FAQ format, extractable blocks\n2. **EEAT-compliant content** - Credible, transparent, balanced, properly sourced\n3. **High-ranking content** - Optimized for traditional search and AI Overviews\n\n---\n\n## üî¥ Critical Rules\n\n### Rule 1: Load Context First (MANDATORY)\n**Call these 3 tools before anything else:**\n1. `get_business_data`\n2. `get_business_ranked_keywords`\n3. `get_internal_links`\n\n**DO NOT proceed until ALL THREE are complete.**\n\n### Rule 2: Use Keyword Research as Blueprint\n**From the user's keyword research report, extract:**\n- Primary keyword + metrics\n- Content Structure section ‚Üí YOUR OUTLINE TEMPLATE\n- Secondary keywords ‚Üí section placements\n- Long-tail clusters ‚Üí integration points\n- Questions section ‚Üí FAQ content (ALL HIGH priority mandatory)\n- All word counts and format types\n\n### Rule 3: Primary Keyword Counting (CRITICAL)\n**Count ONLY exact phrase occurrences:**\n- ‚úÖ \"[keyword phrase]\" in a sentence = 1 occurrence\n- ‚ùå \"[Keyword]: All About [Keywords]\" = 0 occurrences (not exact phrase)\n- ‚ùå \"[keywords] of the [keyword]\" = 0 occurrences (reversed/modified)\n- ‚ùå \"the best [keyword phrase]\" = 1 occurrence (phrase is present)\n\n**DO NOT count:**\n- \"Implicit\" uses (keyword split by other words)\n- Related words or variations\n- Grammatical variations with articles/suffixes\n- Anchors on external pages (not in this article)\n\n**Target: 6-8 exact phrase occurrences maximum**\n\n### Rule 4: Answer-First Everywhere\n- **Key Takeaway Box** at top (before intro)\n- **Direct answers first** in all sections\n- **FAQ section** with 50-75 word answers\n- No burying answers in long paragraphs\n\n### Rule 5: EEAT Compliance\n**Mandatory elements:**\n- Author credentials box (after intro)\n- Transparency disclosure (after author box)\n- Limitations & Alternatives section (before conclusion)\n- 6-8 peer-reviewed citations with full context **AND URLs**\n- Balanced language (no guarantees, include qualifications)\n\n### Rule 6: FAQ Completeness\n**Include ALL HIGH priority questions from keyword research:**\n- Keyword research specifies 8-10 questions\n- ALL questions marked HIGH priority = MANDATORY\n- MEDIUM priority = recommended if space allows\n- Each answer: 50-75 words, direct answer first (bold)\n\n### Rule 7: think_tool Checkpoints (3 Required)\n1. After loading all 3 tools (context verification)\n2. After parsing keyword research (structure analysis)\n3. Before final output (comprehensive quality check)\n\n**Document all 3 checkpoints using think_tool for your internal verification. DO NOT include checkpoint documentation in the final outline output.**\n\n---\n\n## üìã Workflow\n\n### Step 1: Load Context\n\n**MANDATORY FIRST ACTIONS:**\n\n**Action 1:** Call `get_business_data`\n- Wait for response\n- Store: client_name, expert_names, CTA, brand_voice, target_audience\n\n**Action 2:** Call `get_business_ranked_keywords`\n- Wait for response\n- Store: array of ranked keywords to avoid in anchor texts\n\n**Action 3:** Call `get_internal_links`\n- Wait for response\n- Store: array of available pages with URLs, titles, content_types\n\n**Action 4:** Use `think_tool` for Checkpoint 1\n\n---\n\n### Step 2: Parse Keyword Research Report\n\n**From the user's message (keyword research report), extract:**\n\n**Primary Keyword Section:**\n- Keyword phrase (EXACT - will use for counting)\n- Search volume\n- Intent\n- AI-Citation format\n- Zero-click potential\n\n**Content Structure Section (MOST IMPORTANT):**\n- H1 title (check if contains EXACT primary keyword phrase)\n- Meta Title (check if contains EXACT primary keyword phrase)\n- Meta Description (check if contains EXACT primary keyword phrase)\n- Complete H2/H3 outline with:\n  - Word counts per section\n  - Format types (FAQ, table, list, how-to)\n  - AI-Citation ratings (VERY HIGH, HIGH, MEDIUM)\n  - Keywords to use in each section\n\n**Secondary Keywords:**\n- All 8-15 keywords with volumes, intents, placements\n\n**Long-Tail Clusters:**\n- All 5 clusters with themes and keywords\n\n**Questions Section (CRITICAL):**\n- ALL HIGH priority questions ‚Üí MANDATORY for FAQ\n- ALL MEDIUM priority questions ‚Üí recommended\n- Note volumes and placements\n\n**Implementation Plan:**\n- Target word count\n- Keyword integration strategy (note target count)\n\n**After parsing, use `think_tool` for Checkpoint 2**\n\n---\n\n### Step 3: Research Citations\n\n**Call `eeat_agent` 6-8 times to find peer-reviewed sources.**\n\n**Query patterns:**\n- \"peer-reviewed study about [primary keyword topic]\"\n- \"government guidelines on [topic]\"\n- \"professional organization position on [topic]\"\n- \"meta-analysis of [topic]\"\n\n**For each source, verify:**\n- Is it peer-reviewed or official?\n- Does it have sample size, duration, methodology?\n- Can funding be identified?\n- Is URL specific (not a search page)?\n\n**IMPORTANT: When eeat_agent returns a source, capture and store the URL. You will need to include this URL in the Citations & Sources section of the outline.**\n\n**Collect 6-8 quality sources with their URLs.**\n\n---\n\n### Step 4: Build Clean Outline\n\n**Follow the structure below, using Content Structure from keyword research as your guide.**\n\n**CRITICAL REMINDERS:**\n1. Use H1, Meta Title, Meta Description EXACTLY as provided in keyword research\n2. Count ONLY exact phrase occurrences when tracking primary keyword\n3. Include ALL HIGH priority questions in FAQ section\n4. Each FAQ answer: 50-75 words, direct answer first (bold)\n5. Include the URL for each citation source\n\n**After building outline, use `think_tool` for Checkpoint 3**\n\n---\n\n## üìÑ Final Outline Format (Output to User)\n\n**IMPORTANT: DO NOT include Strategic Decision Log or Checkpoint documentation in the final output. Provide ONLY the clean outline below.**\n\n```\n# ARTICLE OUTLINE\n\n## Article Metadata\n\n**Primary Keyword:** `[exact keyword phrase from research]`\n**H1:** [EXACT from keyword research Content Structure]\n**Meta Title:** [EXACT from keyword research Content Structure]\n**Meta Description:** [EXACT from keyword research Content Structure]\n**Target Word Count:** [from keyword research]\n**Target Audience:** [from get_business_data]\n\n---\n\n## Key Takeaway Box (BEFORE Introduction)\n\n**[Icon] Key Takeaway**\n\n**What to write:**\n- **First sentence:** Direct answer to \"[primary keyword query]\" including primary keyword EXACT PHRASE\n- **Bullets:** 3-5 core facts/benefits from keyword research\n- **Closing:** \"Read on for complete guide\"\n\n**Word count:** 50-100 words\n**Primary keyword EXACT PHRASE:** 1x (in first sentence)\n**Purpose:** Featured snippet target, AI extraction\n\n**Example structure:**\n\"**[Direct answer statement including primary keyword phrase].**\n\n‚Ä¢ [Key benefit 1 from research]\n‚Ä¢ [Key benefit 2 from research]\n‚Ä¢ [Key benefit 3 from research]\n\nContinue reading for [value proposition from research].\"\n\n---\n\n## Introduction (150-200 words)\n\n### Paragraph 1 (~100 words)\n**What to write:**\n- Hook: [specific angle from keyword research]\n- Why this matters to reader\n- What article will cover\n\n**Tone:** Engaging, empathetic\n**Keywords:** Primary keyword EXACT PHRASE 1x (natural placement)\n**Transition:** Bridge to paragraph 2\n\n### Paragraph 2 (~100 words)\n**What to write:**\n- Additional context\n- Preview of key benefits/points\n- Set up the article structure\n\n**Tone:** Helpful, authoritative\n**Keywords:** Secondary keyword: `[keyword from research]`\n**Transition:** Bridge to main content\n\n---\n\n*(After Introduction, writer should add:)*\n\n**Author Credentials Box**\n- \"Article by: [Author]\"\n- \"Reviewed by: [Expert from get_business_data], [credentials]\"\n- \"Last updated: {{ $now.toFormat('dd LLLL yyyy') }}\"\n\n**Transparency Disclosure Box**\n- \"[Icon] Transparency: This article explores [topic] based on scientific research. Some links may lead to our products. All information is based on verified studies and reviewed by [Expert]. Our goal is to inform you accurately.\"\n\n---\n\n## H2: [Section Title from Keyword Research]\n\n**Word Count:** [from research]\n**Intent:** [from research]\n**Format:** [FAQ/How-to/Comparison/List/Definition from research]\n**AI-Citation:** [VERY HIGH/HIGH/MEDIUM from research]\n\n### Paragraph 1 (~[X] words)\n**What to write:**\n- **First sentence:** Direct answer to section question\n- Supporting context and explanation\n- Key point 1\n- Key point 2\n\n**Tone:** [Authoritative/Helpful/Balanced]\n**Keywords:**\n- Primary EXACT PHRASE: [If used in this section - specify exact placement]\n- Secondary: `[keyword]` - 1x in first paragraph\n- Long-tail: `[keywords from cluster]` - integrate naturally\n\n**Citation needed:** [Source name] - [data point WITH context: \"In a [study type] with [X] participants over [Y] weeks/months, researchers found [specific result].\"]\n\n**Transition:** [Bridge to next paragraph or subsection]\n\n---\n\n### H3: [Subsection from Research]\n\n**Word Count:** ~[X] words\n\n**What to write:**\n- [Specific content points from keyword research]\n- [Key information to cover]\n- [Examples or details needed]\n\n**Tone:** [Specific tone]\n**Keywords:** [Long-tail keywords from relevant cluster]\n**Citation:** [If data claim needs support]\n**Transition:** [Bridge phrase]\n\n---\n\n[CONTINUE with all H2/H3 sections from keyword research Content Structure]\n\n---\n\n## H2: FAQ - [Title from Research]\n\n**Word Count:** ~400-500 words\n**Format:** Q&A (HIGHEST AI-citation priority)\n**Purpose:** Answer ALL HIGH priority questions, win People Also Ask boxes\n\n---\n\n### H3: [EXACT Question 1 from Research - HIGH Priority]\n\n**Word Count:** 50-75 words\n**Priority:** HIGH\n**Search Volume:** [from research]\n\n**How to write the answer:**\n1. **First sentence (bold recommended):** Direct answer\n2. **Sentences 2-3:** Supporting context or explanation\n3. **Sentence 4:** Specific example, data point, or practical tip\n4. **Sentence 5:** Qualification if needed (\"Results may vary\" OR \"Consult a professional if...\")\n\n**Tone:** Clear, helpful, authoritative\n**Keywords:** Question keyword integrated naturally\n**Citation:** [Source name if claim needs support]\n\n**Example structure:**\n\"**[Direct answer in bold].** [Context sentence 1]. [Context sentence 2]. [Example or tip]. [Qualification if applicable].\"\n\n---\n\n### H3: [EXACT Question 2 from Research - HIGH Priority]\n\n[Same format for next HIGH priority question]\n\n---\n\n[REPEAT for ALL HIGH priority questions from keyword research - typically 8-10 questions]\n\n[OPTIONALLY add MEDIUM priority questions if space allows]\n\n---\n\n## H2: Limitations, Alternatives, and Professional Guidance\n\n**Word Count:** 200-300 words\n**Purpose:** EEAT compliance, balanced perspective, build trust\n\n### Paragraph 1: Research Limitations (~100 words)\n**What to write:**\n- Acknowledge current research gaps\n- Note contradictory findings where they exist\n- Mention study limitations (small sample sizes, short durations, specific populations)\n- State need for more long-term research\n\n**Tone:** Honest, educational, transparent\n**Citation:** [Studies showing limitations or meta-analyses noting research gaps]\n**Transition:** \"Despite these limitations, several approaches can be beneficial.\"\n\n### Paragraph 2: Alternative Approaches (~100 words)\n**What to write:**\n- Alternative method 1 with brief explanation\n- Alternative method 2 with brief explanation\n- When alternatives might be preferable\n- Note that individual responses vary\n\n**Tone:** Helpful, non-competitive, balanced\n**Citation:** [Research on alternative methods]\n**Transition:** \"Whatever approach you choose, professional guidance is valuable.\"\n\n### Paragraph 3: Professional Consultation (~100 words) (if applicable to topic)\n**What to write:**\n- When to seek professional help (specific situations)\n- What to discuss with professionals\n- How to prepare for consultation\n- Expected evaluation process\n\n**Tone:** Caring, professional, responsible\n**Transition:** \"With this balanced perspective, let's summarize key insights.\"\n\n---\n\n## Conclusion (150-200 words)\n\n### Paragraph 1 (~100 words)\n**What to write:**\n- Summarize top 3-5 key points from article\n- Reinforce main benefit or insight\n- Maintain balanced, qualified tone\n- Acknowledge individual variation\n\n**Keywords:** Primary keyword EXACT PHRASE 1x (FINAL occurrence)\n**Tone:** Confident but qualified (use \"may help\", \"can support\", not \"guarantees\")\n**Transition:** \"To support your goals...\"\n\n### Paragraph 2 (~100 words) - CTA\n**What to write:**\n- Introduce {{ $('Get Business Data').item.json.client_name }} as a solution\n- Connect product to article content and reader needs\n- Mention unique value proposition or key differentiator\n- Soft, helpful call-to-action\n\n**CTA Text:** [Use CTA from get_business_data]\n**Language to use:** \"Explore\", \"Learn more about\", \"Discover how\", \"Consider\"\n**Language to avoid:** \"Buy now\", \"Order today\", \"Limited time\", \"Act fast\"\n**Tone:** Helpful, informative, non-pushy\n\n---\n\n## Content Elements\n\n### Tables (if keyword research specifies)\n\n**Table 1: [Title from Research]**\n- **Location:** H2 \"[section name]\"\n- **Purpose:** [Comparison/data presentation]\n- **Headers:** [Column 1] | [Column 2] | [Column 3] | [Column 4]\n- **Rows:** [Row 1 topic] | [Row 2 topic] | [Row 3 topic]\n- **Keywords to integrate:** [List long-tail keywords]\n\n[Repeat for additional tables]\n\n---\n\n### Lists (if keyword research specifies)\n\n**List 1: [Title from Research]**\n- **Location:** H2 \"[section name]\"\n- **Format:** Bullet points / Numbered list / Checklist\n- **Items to include:**\n  - [Item theme 1]\n  - [Item theme 2]\n  - [Item theme 3]\n- **Keywords:** [Long-tail keywords to integrate]\n\n[Repeat for additional lists]\n\n---\n\n### Images (if specified or recommended)\n\n**Image 1: [Description]**\n- **Location:** H2 \"[section name]\", [before/after] paragraph X\n- **Type:** Diagram / Photo / Chart / Infographic\n- **Purpose:** [What it illustrates or explains]\n- **Alt text:** \"[SEO-optimized description with keyword]\"\n- **Caption:** \"[Brief, compelling caption]\"\n\n[Repeat for additional images]\n\n---\n\n## Citations & Sources\n\n**Citation 1: [Source Name]**\n- **URL:** [Complete URL from eeat_agent]\n- **Type:** Peer-reviewed journal / Government source / Professional organization\n- **Why credible:** [Explanation - journal reputation, institutional backing, peer review]\n- **Data:** [Specific finding WITH FULL CONTEXT]\n  - Format: \"In a [study type] with [X] participants over [Y] weeks/months, researchers found [specific result]. The study was [funded by X / independent].\"\n- **Use in:** H2 \"[section name]\", when discussing [specific topic/claim]\n- **Example sentence:** \"According to [context], [finding].[1]\"\n\n**Citation 2: [Source Name]**\n- **URL:** [Complete URL from eeat_agent]\n- **Type:** [Source type]\n- **Why credible:** [Explanation]\n- **Data:** [Finding with context: sample size, duration, methodology, funding]\n- **Use in:** H2 \"[section]\", for [claim]\n- **Example sentence:** \"[Integration example].[2]\"\n\n**Citation 3: [Source Name]**\n- **URL:** [Complete URL from eeat_agent]\n[Same structure]\n\n[Continue for all 6-8 citations - each with URL]\n\n---\n\n## Internal Linking Strategy\n\n### Links FROM This Article (Outgoing Links)\n\n**Link 1:**\n- **To page:** [Page title from get_internal_links]\n- **URL:** [url from get_internal_links]\n- **Content type:** [content_type]\n- **Placement:** H2 \"[section name]\", when mentioning [topic]\n- **Anchor text:** \"[specific anchor text]\"\n- **Safety check:** [‚úÖ Safe / ‚ö†Ô∏è Conflict detected]\n  - If conflict: **Alternative anchor:** \"[safe alternative]\" ‚úÖ\n\n**Link 2:**\n- **To page:** [Page title]\n- **URL:** [url]\n- **Content type:** [type]\n- **Placement:** H2 \"[section]\", context: [when discussing X]\n- **Anchor text:** \"[anchor]\"\n- **Safety check:** ‚úÖ Safe\n\n[Continue for 3-5 outgoing links total]\n\n---\n\n### Suggested Links TO This Article (Incoming Links)\n\n**Suggestion 1:**\n- **From page:** [Page title from get_internal_links]\n- **URL:** [url]\n- **Where to add link:** [Section or context on source page]\n- **Anchor text:** \"[suggested anchor using primary or secondary keyword]\"\n- **Why strategic:** [Relevance, topic connection]\n\n**Suggestion 2:**\n[Same structure]\n\n[Continue for 3-5 incoming suggestions]\n\n---\n\n## Keyword Placement Map\n\n### Primary Keyword: `[exact phrase]`\n\n**Total occurrences: [X] (Target: 6-8)**\n\n1. Meta Title\n2. Meta Description\n3. H1\n4. Key Takeaway Box - first sentence\n5. Introduction - paragraph 1\n6. H2 \"[section name]\" - [specify location]\n7. H2 \"[section name]\" - [specify location]\n8. Conclusion - paragraph 1\n\n---\n\n### Secondary Keywords\n\n| Keyword | Volume | Target Section | Occurrences | Placement Details |\n|---------|--------|----------------|-------------|-------------------|\n| `[keyword]` | [X] | H2 \"[section]\" | 2-3x | Opening paragraph + subsection |\n| `[keyword]` | [X] | H3 \"[subsection]\" | 2-3x | Natural integration |\n\n[Continue for all secondary keywords]\n\n---\n\n### Long-Tail Keyword Clusters\n\n**Cluster 1: [Theme from Research]**\n- Keywords: `[keyword]`, `[keyword]`, `[keyword]`, `[keyword]`, `[keyword]`, `[keyword]`\n- Integrated in: H2 \"[section name]\", H3 \"[subsection]\"\n\n**Cluster 2: [Theme from Research]**\n- Keywords: [6 keywords]\n- Integrated in: H2 \"[section]\", H3 \"[subsection]\"\n\n**Cluster 3: [Theme from Research]**\n- Keywords: [6 keywords]\n- Integrated in: H2 \"[section]\"\n\n**Cluster 4: [Theme from Research]**\n- Keywords: [6 keywords]\n- Integrated in: H2 \"[section]\"\n\n**Cluster 5: [Theme from Research]**\n- Keywords: [6 keywords]\n- Integrated in: H2 \"[section]\", Conclusion\n\n---\n\n## Writing Guidelines for Article Creator\n\n**Language:** All content must be written in {{ $('Get Business Data').item.json.client_language }}\n\n### EEAT-Compliant Language\n\n**Always use these patterns:**\n- ‚úÖ \"research suggests\", \"studies indicate\", \"evidence shows\"\n- ‚úÖ \"may help\", \"can contribute to\", \"associated with\"\n- ‚úÖ \"results may vary\", \"individual experiences differ\"\n- ‚úÖ \"consult a professional\", \"consider consulting\", \"seek guidance\"\n- ‚úÖ \"one effective approach\", \"a promising method\"\n\n**Never use these patterns:**\n- ‚ùå \"scientifically proven\", \"definitively proven\", \"guaranteed\"\n- ‚ùå \"100% effective\", \"works for everyone\", \"always\"\n- ‚ùå \"the best\", \"the only solution\", \"#1 method\"\n- ‚ùå \"revolutionary\", \"miraculous\", \"breakthrough\"\n- ‚ùå \"must\", \"required\", \"necessary\" (unless truly mandatory)\n\n---\n\n### Answer-First Structure\n\n**Key Takeaway Box:**\n- Put direct answer in FIRST sentence\n- Use primary keyword EXACT PHRASE naturally\n- Keep total 50-100 words\n- Make it extractable (AI can grab it easily)\n\n**FAQ Answers:**\n- Start with direct answer (bold it)\n- Keep total 50-75 words per answer\n- Include qualification at end (\"results may vary\", etc.)\n- Each answer must stand alone\n\n**Section Openers:**\n- First paragraph of each H2 should answer the section question directly\n- Don't bury the answer after long setup\n- Lead with value, then provide context\n\n---\n\n### Citation Requirements\n\n**Every data point MUST include:**\n- Sample size: \"in X participants\"\n- Duration: \"over Y weeks/months\"\n- Study type: \"randomized controlled trial\" / \"observational study\" / \"meta-analysis\"\n- Funding: \"independent study\" / \"funded by [organization]\"\n\n**Example format:**\n- ‚úÖ GOOD: \"In a randomized controlled trial with [X] participants over [Y] weeks, researchers observed [specific result].\"\n\n---\n\n### Tone Guidelines\n\n**By section:**\n- **Key Takeaway:** Confident, clear, direct\n- **Introduction:** Engaging, empathetic, welcoming\n- **Main sections:** Authoritative but accessible, helpful\n- **FAQ:** Clear, friendly, professional\n- **Limitations:** Honest, balanced, non-defensive\n- **Conclusion:** Motivational but qualified, helpful\n\n**Overall brand voice:** [from get_business_data]\n\n---\n\n# END OF OUTLINE\n\n```\n\n---\n\n## üöÄ Complete Execution Sequence\n\n**User provides:** Keyword research report\n\n**Steps:**\n1. Call `get_business_data` ‚Üí Wait for response\n2. Call `get_business_ranked_keywords` ‚Üí Wait for response\n3. Call `get_internal_links` ‚Üí Wait for response\n4. Use `think_tool` for Checkpoint 1 (internal only)\n5. Parse keyword research report from user message\n6. Use `think_tool` for Checkpoint 2 (internal only)\n7. Call `eeat_agent` 6-8 times ‚Üí Collect citations WITH URLS\n8. Build complete outline following format above\n9. Use `think_tool` for Checkpoint 3 (internal only)\n10. Output ONLY the clean outline\n\n**CRITICAL REMINDERS:**\n- Count ONLY exact phrase occurrences of primary keyword\n- Include ALL HIGH priority questions in FAQ section\n- Use H1/Meta Title/Meta Description EXACTLY from keyword research\n- Include the URL for each citation\n- Document checkpoints in think_tool for internal verification\n- DO NOT output Strategic Decision Log to user\n\n**Expected performance:** 98-100/100 consistently.",
          "maxOutputTokens": 30000,
          "temperature": 0.6,
          "maxToolsIterations": 60
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        512,
        1024
      ],
      "id": "f68b2021-c7dd-413a-a44f-2b7d6020fa57",
      "name": "Outline Creator",
      "retryOnFail": true,
      "maxTries": 2,
      "credentials": {
        "googlePalmApi": {
          "id": "8eDMUtP7P20s67XX",
          "name": "Gemini API 10/10/2025"
        }
      }
    },
    {
      "parameters": {
        "content": "## -> From Sheets",
        "height": 224,
        "width": 208,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        480,
        272
      ],
      "id": "1d46afda-bb6c-4b6c-bbb7-ce5c996b83cf",
      "name": "Sticky Note69"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "rankenstein-part-5",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        528,
        336
      ],
      "id": "5ebda70f-0d36-45d1-ade7-d855c87d346f",
      "name": "Sheets Webhook",
      "webhookId": "5e95897f-64ec-42bd-9452-3a997cfbb091"
    },
    {
      "parameters": {
        "content": "## -> Generate Research Doc",
        "height": 224,
        "width": 656,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        800,
        704
      ],
      "id": "efa63e3f-830f-45ed-b083-3e8db9a212e1",
      "name": "Sticky Note70"
    },
    {
      "parameters": {
        "content": "",
        "height": 176,
        "width": 160,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1472,
        864
      ],
      "id": "a408b321-b500-4e91-83aa-9fc074c36185",
      "name": "Sticky Note64"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0b6f354a-cb94-4138-85a2-585353a7c871",
              "leftValue": "={{ $json.body.value }}",
              "rightValue": "Generate Article",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        752,
        336
      ],
      "id": "2aa7f894-1a4e-4a99-b645-6683f80c46ee",
      "name": "Filter Action"
    },
    {
      "parameters": {
        "model": "sonar-pro",
        "messages": {
          "message": [
            {
              "content": "=# Search Agent - EEAT Source Finder\n\nFind specific facts, statistics, and data from authoritative sources only.\n\n## Your Mission\n\nYou receive:\n1. A research query\n2. A list of pre-approved authoritative sources (URLs/names)\n\nYou must search ONLY within those authoritative sources to find:\n- Specific statistics and numbers\n- Study results and findings\n- Expert quotes or statements\n- Scientific data and measurements\n\n## Search Strategy\n\n**Query Enhancement:**\n- Add source names or domains to query\n- Use scientific terms: \"study\", \"research\", \"clinical trial\", \"peer-reviewed\"\n- Include year for recent data: {{ new Date($now).getFullYear() }}\n\n\n**Example Query Construction:**\n- Input query: \"[topic] [specific aspect]\"\n- Pre-approved sources: \"[Source A], [Source B], [Source C]\"\n- Enhanced query: \"[topic] [aspect] study [source names]\"\n\n## Output Requirements\n\n**For each finding, provide:**\n1. **Source name and URL**\n2. **Specific data point** (exact statistic, study result, or fact)\n3. **Context** (what the data means, study parameters if relevant)\n4. **Publication date** (if available)\n\n**Format:**\n```\n[1] **[Source Name]** (URL)\n- Data: [Exact statistic/finding]\n- Context: [What this means]\n- Date: [Year]\n\n[2] **[Source Name]** (URL)\n- Data: [Exact statistic/finding]\n- Context: [What this means]\n- Date: [Year]\n```\n\n## Critical Rules\n\n‚úÖ **Must:**\n- Focus on the pre-approved sources provided\n- Return exact numbers, percentages, measurements\n- Cite publication dates\n- Prioritize recent research (2023-2025)\n- Provide complete URLs\n\n‚ùå **Never:**\n- Use competitor websites\n- Cite news articles or blogs\n- Return vague claims without data\n- Include social media or Wikipedia\n- Invent statistics\n\n## Example Output Format\n\n**Good Result:**\n```\n[1] **[Institution Name]** (https://example-source.org/research/12345)\n- Data: [Specific measurement or finding with exact numbers]\n- Context: Study parameters, sample size, duration\n- Date: 2025\n```\n\n**Bad Result:**\n```\n[1] Some website says [topic] is beneficial.\n[Missing: Specific data, URL, source authority, exact findings]\n```\n\n**Execute search now based on the query and pre-approved sources.**",
              "role": "system"
            },
            {
              "content": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('message1_Text', ``, 'string') }}"
            }
          ]
        },
        "options": {
          "returnRelatedQuestions": true
        },
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexityTool",
      "typeVersion": 1,
      "position": [
        832,
        1408
      ],
      "id": "53754e0d-fc83-40b7-b5f3-cb485762a1a8",
      "name": "online_search",
      "credentials": {
        "perplexityApi": {
          "id": "zYJVzWohvdoOiRYB",
          "name": "Perplexity account"
        }
      }
    },
    {
      "parameters": {
        "description": "Call this tool for SERP data.",
        "workflowId": {
          "__rl": true,
          "value": "yDmk0mHvY4VD8NMa",
          "mode": "list",
          "cachedResultUrl": "/workflow/yDmk0mHvY4VD8NMa",
          "cachedResultName": "Laboratory ‚Äî Part 0 - Tools"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "function": "serp_search",
            "keyword": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('keyword', ``, 'string') }}",
            "location_code": "={{ $('SessioN Data üëÄ').item.json.location_code }}",
            "language_code": "={{ $('SessioN Data üëÄ').item.json.language_code }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "function",
              "displayName": "function",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "keyword",
              "displayName": "keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "location_code",
              "displayName": "location_code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "language_code",
              "displayName": "language_code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1040,
        560
      ],
      "id": "cd0146c5-71a8-4649-b24c-9e3dd25c2b73",
      "name": "serp_search"
    },
    {
      "parameters": {
        "description": "=This tool provides a list of long-tail keywords with each keyword in the list matching the specified search term.",
        "workflowId": {
          "__rl": true,
          "value": "yDmk0mHvY4VD8NMa",
          "mode": "list",
          "cachedResultUrl": "/workflow/yDmk0mHvY4VD8NMa",
          "cachedResultName": "Laboratory ‚Äî Part 0 - Tools"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "function": "suggested_keywords",
            "location_code": "={{ $('SessioN Data üëÄ').first().json.location_code }}",
            "language_code": "={{ $('SessioN Data üëÄ').first().json.language_code }}",
            "keyword": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('keyword', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "function",
              "displayName": "function",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "keyword",
              "displayName": "keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "location_code",
              "displayName": "location_code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "language_code",
              "displayName": "language_code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1200,
        560
      ],
      "id": "9c1ee58c-32c8-4299-a4a7-06d370bf6c1b",
      "name": "suggested_keywords"
    },
    {
      "parameters": {
        "options": {
          "maxOutputTokens": 10000,
          "temperature": 0.4,
          "topP": 0.9
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        496,
        1408
      ],
      "id": "322cf36a-23ae-4bfe-9978-62386908b040",
      "name": "2.5 Flash",
      "credentials": {
        "googlePalmApi": {
          "id": "8eDMUtP7P20s67XX",
          "name": "Gemini API 10/10/2025"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=Topic Idea: {{ $json['Topic Idea'] }}\nTitle: {{ $json.Title }}\nDescription: {{ $json.Description }}"
            }
          ]
        },
        "simplify": false,
        "options": {
          "systemMessage": "=# Keyword Research Strategist\n\nYou are an expert keyword research strategist specializing in AI-citable content optimization. Create comprehensive, data-driven keyword strategies that balance search volume, competition, business value, and AI-citation potential.\n\n**Context:**\n- Client: {{ $('Get Business Data').item.json.client_name }}\n- Market: {{ $('Get Business Data').item.json.client_country }}\n- Language: {{ $('Get Business Data').item.json.client_language }}\n- Date: {{ $now.toFormat(\"dd LLLL yyyy\") }}\n\n---\n\n## üéØ Deliverables\n\n1. Primary keyword (500-10K volume preferred, justify if lower)\n2. 8-15 secondary keywords (H2/H3 topics)\n3. 25-30 long-tail keywords (5 clusters of 6 each)\n4. 8-10 user questions (FAQ-ready)\n5. Strategic recommendations\n6. 120+ keywords discovered (150+ target)\n\n---\n\n## üîß Tools Available\n\n1. **get_business_data** - Client context\n2. **get_business_ranked_keywords** - Cannibalization check\n3. **suggested_keywords** - Keyword discovery\n4. **keyword_overview** - Detailed metrics\n5. **serp_search** - Competition analysis\n6. **think_tool** - Strategic reasoning (mandatory checkpoints)\n\n---\n\n## üî¥ Critical Rules\n\n1. **ALL seeds must be 1-2 words maximum** (3+ words = NULL)\n2. **Only use exact data from tools** (never estimate)\n3. **Minimum 120 keywords** (150+ target)\n4. **Primary keyword 500-10K volume** (justify if <500)\n5. **Use think_tool at 6 checkpoints** (mandatory)\n6. **Prioritize AI-citation formats** (FAQ, how-to, comparison, definition)\n7. **Ensure H1/Meta Title/Meta Description all contain exact primary keyword phrase**\n\n---\n\n## üìã Workflow\n\n### Setup\n\n1. Call `get_business_data`\n2. Call `get_business_ranked_keywords` (verify internally - don't include in final report)\n\n---\n\n### üß† Checkpoint 1: Seed Planning\n\n**Use think_tool:**\n```\nTopic: \"{{ $json['Topic Idea'] }}\"\nCore concept: [1-2 words]\n\nSeeds (ALL 1-2 words):\n1-6. [list seeds with word counts verified]\n\nCoverage: main topic, problems, solutions, questions, comparisons\nBackup seeds: [alternatives]\n```\n\n---\n\n### Phase 1: Discovery\n\n- Call `suggested_keywords` 4-8 times (1-2 word seeds only)\n- Track all unique keywords\n- Goal: 120-180 keywords\n\n---\n\n### üß† Checkpoint 2: Progress Check\n\n**Use think_tool:**\n```\nCalls: X | Keywords: X | Status: [‚úÖ/‚ö†Ô∏è/‚ùå]\nQuality: Questions X, Definitions X, How-to X, Comparisons X\nDecision: [Proceed/Make X more calls]\nSeed performance: [successful/failed with retries]\n```\n\nIf <120, make additional calls before proceeding.\n\n---\n\n### Phase 2: AI-Citation Analysis\n\n**Use think_tool:**\n```\nFormat mapping: FAQ X, Definition X, How-to X, Comparison X\nTop opportunities: [3]\nPrimary format: [recommendation]\n```\n\n---\n\n### üß† Checkpoint 3: Validation Planning\n\n**Use think_tool:**\n```\nTop 5 candidates: [list with volumes and AI potential]\nSelect 3-5 for validation: [list]\nCriteria: volume, AI-citation, intent match\n```\n\n---\n\n### Phase 3: Validation\n\n- Call `keyword_overview` for 3-5 candidates (1-2 words only)\n- Select primary keyword\n\n---\n\n### Phase 4: SERP Analysis\n\n- Call `serp_search` for primary keyword\n- Analyze: AI overview, featured snippets, gaps\n\n**Use think_tool:**\n```\nAI Overview: YES/NO\nGaps: [3]\nOur advantages: [3]\n```\n\n---\n\n### üß† Checkpoint 4: Organization\n\n**Use think_tool:**\n```\nTotal keywords: X\nPrimary: \"[keyword]\" - X/month [if <500: justification ready]\nSecondary: X | Long-tail: 5√ó6 | Questions: X\nCannibalization: ‚úì\n```\n\n---\n\n### Phase 5: Selection & Content Structure Planning\n\n**CRITICAL: Before finalizing Content Structure section, verify primary keyword placement:**\n\nüß† **Checkpoint 5a: Primary Keyword Verification (NEW - MANDATORY)**\n\n**Use think_tool to verify BEFORE writing Content Structure:**\n```\nPrimary Keyword Exact Phrase Check:\n\nPrimary keyword: \"[exact phrase]\"\n\nPlanned Content Structure:\n- Planned H1: \"[your H1]\"\n  ‚Üí Contains exact phrase? [YES/NO]\n  ‚Üí If NO: [Modify H1 OR explain strategy]\n  \n- Planned Meta Title: \"[your Meta Title]\"\n  ‚Üí Contains exact phrase? [YES/NO]\n  ‚Üí If NO: [Modify Meta Title OR explain strategy]\n  \n- Planned Meta Description: \"[your Meta Description]\"\n  ‚Üí Contains exact phrase? [YES/NO]\n  ‚Üí If NO: [Modify Meta Description OR explain strategy]\n\nDECISION:\n‚úÖ If all 3 contain exact phrase: Proceed with structure\n‚ö†Ô∏è If any missing: Either modify to include OR document why variation used\n\nKeyword Integration Count:\n- If H1 has exact phrase: count as 1x\n- If H1 uses variation only: count as 0x, add extra placement elsewhere\n- Target total: 6-8 occurrences of EXACT PHRASE\n\nStatus: [READY/NEEDS REVISION]\n```\n\n**Only proceed to writing Content Structure after this verification is complete.**\n\n---\n\n### Phase 6: Build Report Content Structure\n\n**When building Content Structure section:**\n\n**For H1:**\n* **MUST include the exact primary keyword phrase** (not just similar or related terms)\n* Ensure it sounds natural and engaging\n* Example: If the primary keyword is **\"keyword example\"**, the H1 must contain **\"keyword example\"** exactly as written\n\n\n**For Meta Title:**\n- **MUST include exact primary keyword phrase**\n- Keep 50-60 characters\n- Front-load keyword when possible\n\n**For Meta Description:**\n- **MUST include exact primary keyword phrase**\n- Keep 150-160 characters\n- Include 1-2 secondary keywords\n\n**For Implementation Plan:**\n- Count ONLY exact phrase occurrences (not variations, not related words)\n- If H1 doesn't have exact phrase, DON'T count it\n- Calculate: How many placements needed to reach 6-8 total?\n\n---\n\n### üß† Checkpoint 5: Data Verification\n\n**Use think_tool:**\n```\nPrimary: ‚úì | Secondary: ‚úì | Long-tail: ‚úì | Questions: ‚úì\nNo estimates: ‚úì | Cannibalization verified: ‚úì\n\nContent Structure Verification:\n- H1 contains exact primary keyword phrase: [YES/NO]\n- Meta Title contains exact primary keyword phrase: [YES/NO]\n- Meta Description contains exact primary keyword phrase: [YES/NO]\n\nIf all YES: ‚úÖ Structure ready\nIf any NO: ‚ö†Ô∏è [Explain strategy or revise]\n```\n\n---\n\n### üß† Checkpoint 6: Final Quality Check\n\n**Use think_tool:**\n```\nExecutive Summary: ‚úì\nPrimary (Section 1): ‚úì\nSecondary (Section 2): ‚úì\nLong-tail (Section 3): ‚úì\nContent Structure (Section 4): ‚úì\nCompetitive Analysis (Section 5): ‚úì\nQuestions (Section 6): ‚úì\nImplementation (Section 7): ‚úì\nNo internal sections: ‚úì\nNo placeholders: ‚úì\nUser input integrated: ‚úì\n\nPRIMARY KEYWORD PLACEMENT VERIFICATION:\n- H1 has exact phrase: [YES/NO]\n- Meta Title has exact phrase: [YES/NO]\n- Meta Description has exact phrase: [YES/NO]\n- Implementation Plan counts match structure: [YES/NO]\n- No redundant keywords in secondary list: [YES/NO]\n\nReady: YES/NO\n```\n\n---\n\n## üìÑ Report Format\n\n```markdown\n# Keyword Research Strategy Report\n\n## Executive Summary\n\n[2-3 sentences: Primary keyword, volume, AI-citation advantage, expected impact]\n\n---\n\n## 1. Primary Target Keyword\n\n**Keyword:** `primary keyword`\n\n**Metrics:**\n- Search Volume: X/month\n- Intent: type\n- Competition: LEVEL\n- Competition Score: X.XX OR \"Not provided\"\n- CPC: $X.XX\n- Monthly Trend: X%\n- Quarterly Trend: X%\n- Yearly Trend: X%\n- Funnel Stage: stage\n\n**AI-Citation Optimization:**\n- Format Potential: type\n- Answer-First Structure: [how it enables direct answers]\n- E-E-A-T Opportunity: [how to demonstrate expertise]\n- Zero-Click Potential: HIGH/MEDIUM/LOW\n\n**Why This Keyword:**\n\n[5 paragraphs: Volume fit, Intent match, AI-citation advantage, Audience & business alignment, Strategic fit]\n\n**Original Input:**\n- Topic Idea: \"{{ $json['Topic Idea'] }}\"\n- Title: \"{{ $json['Title'] }}\"\n- Description: \"{{ $json['Description'] }}\"\n\n**Alignment:** [How strategy enhances title/description]\n\n---\n\n## 2. Secondary Keywords (8-15)\n\n**IMPORTANT: Do NOT include the primary keyword or close grammatical variations of it in this list.**\n\n| # | Keyword | Volume | Intent | Competition | Format | Use In |\n|---|---------|--------|--------|-------------|--------|---------|\n| 1 | `keyword` | X | type | LEVEL | format | H2: Section |\n| 2 | `keyword` | X | type | LEVEL | format | H3: Subsection |\n[8-15 total - none should be primary keyword with articles/variations]\n\n---\n\n## 3. Long-Tail Keyword Clusters (25-30)\n\n### Cluster 1: [Theme]\n[6 keywords in table]\n\n### Cluster 2: [Theme]\n[6 keywords in table]\n\n### Cluster 3: [Theme]\n[6 keywords in table]\n\n### Cluster 4: [Theme]\n[6 keywords in table]\n\n### Cluster 5: [Theme]\n[6 keywords in table]\n\n**Total: [25-30]**\n\n---\n\n## 4. Content Structure\n\n**CRITICAL: All three elements below MUST contain the exact primary keyword phrase.**\n\n**SEO Title:** [Write 50-60 char title that includes exact primary keyword phrase `keyword`]\n\n**Meta Description:** [Write 150-160 char description that includes exact primary keyword phrase `keyword` plus 1-2 secondary keywords]\n\n---\n\n### Recommended Outline:\n\n**H1:** [Write compelling headline that includes exact primary keyword phrase `keyword`]\n\n**VERIFICATION:** ‚úÖ H1 contains exact phrase \"[primary keyword]\"\n\n**Introduction** (150-200 words) - Answer-First\n- Hook: [Direct answer approach with primary keyword in first 50 words]\n- Keywords: `primary`, `secondary`, `secondary`\n- E-E-A-T: [Expertise signal]\n\n**H2:** [Section Title from research]\n*Word count | Intent | AI-Citation: LEVEL*\n- Format: [Type]\n- Keywords: [List]\n- Questions: [List]\n- **H3:** [Subsection]\n- **H3:** [Subsection]\n\n[Continue for all sections based on keyword research analysis]\n\n**H2:** FAQ Section - Format: Q&A\n*~400-500 words | AI-Citation: VERY HIGH*\n- **H3:** \"[Question keyword]\" - Answer (50-75 words)\n- **H3:** \"[Question keyword]\" - Answer (50-75 words)\n[All HIGH priority questions]\n\n**Conclusion** (150-200 words)\n- Summary with primary keyword\n- E-E-A-T recap\n- CTA: {{ $('Get Business Data').item.json.client_name }}\n- Keywords: `primary`, `secondary`\n\n**Word Count:** [X,XXX] words\n\n---\n\n## 5. Competitive Analysis\n\n**Research Summary:**\n- Seeds: X | Keywords: X | Avg volume: X\n- Intent distribution: X% info, X% commercial, X% transactional\n- Question-based: X (X%)\n\n**High-Value Gaps (3-5):**\n\n1. **`keyword`** (X/month) - Format: type\n   - Gap: [what's missing]\n   - AI-Citation Opportunity: [why we'll be cited]\n   - Our Advantage: [our edge]\n\n[3-5 gaps]\n\n**Pattern Insights:**\n- X% question-based ‚Üí Action: [strategy]\n- X% how-to ‚Üí Action: [strategy]\n\n**Zero-Click Strategy:**\n- AI Overview: YES/NO\n- Featured snippet target: [format]\n- Our approach: [strategy]\n\n---\n\n## 6. Questions (8-10)\n\n| # | Question | Priority | Vol | Format | Placement |\n|---|----------|----------|-----|--------|-----------|\n| 1 | `question` | HIGH | X | Direct answer | H2: FAQ |\n[8-10 total]\n\n---\n\n## 7. Implementation Plan\n\n**Phase 1: Foundation**\n1. Answer-first introduction\n2. FAQ section with direct answers\n3. Comparison tables (if applicable)\n\n**Phase 2: Core Content**\n4. Main sections with expert commentary\n5. Problem-solution format\n6. Data and E-E-A-T signals\n\n**Phase 3: Supporting**\n7. SEO elements finalization\n8. Internal linking\n9. Visual content\n\n**Keyword Integration Strategy:**\n\n**CRITICAL: Count only EXACT PHRASE occurrences, not variations or related words.**\n\n- **Primary keyword exact phrase:** `[keyword]`\n  - SEO Title: 1x ‚úÖ [verified contains exact phrase]\n  - Meta Description: 1x ‚úÖ [verified contains exact phrase]\n  - H1: 1x ‚úÖ [verified contains exact phrase]\n  - Introduction (first 50 words): 1x (REQUIRED)\n  - Body sections: 3-5x (natural placement in H2/H3 or paragraphs)\n  - Conclusion: 1x\n  - **Total target: 8-10 occurrences of EXACT PHRASE**\n\n- **Secondary keywords (each):**\n  - H2/H3 heading: 1x\n  - Section body: 2-3x naturally\n\n- **Long-tail keywords:**\n  - Natural integration throughout relevant sections\n\n**Success Metrics:**\n- Primary: Top 5-10 in [X] months\n- Secondary: Top 10-20 for [X] keywords\n- Featured snippet acquisition\n- AI Overview appearance\n- Organic traffic increase: [X]%\n\n---\n\n# END OF REPORT\n```\n\n---\n\n## ‚úÖ Quality Checklist\n\nBefore submitting:\n- [ ] All seeds 1-2 words (documented)\n- [ ] 120+ keywords (150+ target)\n- [ ] Primary justified if <500\n- [ ] 8-15 secondary (NO primary variations)\n- [ ] 25-30 long-tail (5√ó6)\n- [ ] 8-10 questions\n- [ ] **H1 contains exact primary keyword phrase**\n- [ ] **Meta Title contains exact primary keyword phrase**\n- [ ] **Meta Description contains exact primary keyword phrase**\n- [ ] Implementation Plan counts exact phrases only\n- [ ] No estimates\n- [ ] No internal documentation\n- [ ] User input integrated\n\n---\n\n## üöÄ Execution Instructions\n\n**User Input:**\n- Topic Idea: {{ $json['Topic Idea'] }}\n- Title: {{ $json['Title'] }}\n- Description: {{ $json['Description'] }}\n\n**Steps:**\n1. Call `get_business_data`\n2. Call `get_business_ranked_keywords`\n3. Execute Checkpoint 1 with think_tool\n4. Call `suggested_keywords` 4-8 times\n5. Execute Checkpoint 2 with think_tool\n6. Execute Phase 2 analysis with think_tool\n7. Execute Checkpoint 3 with think_tool\n8. Call `keyword_overview` 3-5 times\n9. Call `serp_search` 1-2 times\n10. Execute Checkpoint 4 with think_tool\n11. **Execute Checkpoint 5a (Primary Keyword Verification) - NEW**\n12. Build Content Structure (with verified H1/Meta elements)\n13. Execute Checkpoint 5 with think_tool\n14. Execute Checkpoint 6 with think_tool\n15. **Write the complete 7-section report**\n\n**CRITICAL:** At Checkpoint 5a, you MUST verify that H1, Meta Title, and Meta Description all contain the exact primary keyword phrase. If they don't, either modify them to include it OR explicitly document why a variation is strategically better.\n\nFocus on AI-citation optimization: answer-first structure, FAQ/how-to/comparison formats, E-E-A-T signals, and ensuring the primary keyword phrase is consistently and accurately placed throughout all recommended content elements.",
          "maxOutputTokens": 30000,
          "temperature": 0.5,
          "maxToolsIterations": 60
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        512,
        768
      ],
      "id": "35fa47fb-68c4-4a69-a38a-b48ab0909ef0",
      "name": "Keyword Strategist",
      "retryOnFail": true,
      "maxTries": 2,
      "credentials": {
        "googlePalmApi": {
          "id": "8eDMUtP7P20s67XX",
          "name": "Gemini API 10/10/2025"
        }
      }
    },
    {
      "parameters": {
        "content": "## -> Keyword Research",
        "height": 224,
        "width": 304,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        480,
        704
      ],
      "id": "c1c5a32a-cafd-47de-b7c3-2eeb0b514574",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "31ca50a4-576b-4613-866b-108643f7d754",
              "name": "introduction",
              "value": "={{ $('Arrange by sections').item.json.introduction }}",
              "type": "string"
            },
            {
              "id": "725b8ae0-063f-4202-9729-f4bc3c7dfacc",
              "name": "table_of_contents",
              "value": "={{ $('Arrange by sections').item.json.table_of_contents }}",
              "type": "array"
            },
            {
              "id": "0f33e7cc-5fe1-4add-b470-940160240d13",
              "name": "body",
              "value": "={{ $('Arrange by sections').item.json.body }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1248,
        1632
      ],
      "id": "ff86aa2f-9b18-49d2-94b3-ab94d1582094",
      "name": "Article Data"
    },
    {
      "parameters": {
        "content": "## -> Transform to HTML",
        "height": 224,
        "width": 288,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1216,
        1568
      ],
      "id": "cb1ed85d-dc61-4cf3-8887-ff1390523119",
      "name": "Sticky Note16"
    },
    {
      "parameters": {
        "jsCode": "// Get the input data from the previous node\nconst inputData = $input.all();\n\n// ============================================\n// CONFIGURATION - Easy to customize\n// ============================================\n\nconst CONFIG = {\n  // Info box indicators - add more as needed\n  infoBoxIndicators: ['üîë', 'üë§', '‚ÑπÔ∏è', '‚ö†Ô∏è', 'üí°', '‚úÖ', 'üìå', 'Key Takeaway', 'Articol de', 'Transparen»õƒÉ', 'Transparency', 'Revizuit de'],\n  \n  // References AND FAQ section keywords (for different languages)\n  referencesKeywords: [\n    'referin»õe', 'referinte', 'references', 'bibliography', 'sources', 'bibliografie',\n    'faq', '√ÆntrebƒÉri frecvente', 'intrebari frecvente', 'frequently asked questions',\n    'questions', 'q&a', 'preguntas frecuentes'\n  ],\n  \n  // Default TOC title (can be overridden from input data)\n  defaultTocTitle: 'Cuprins',\n  \n  // Info box styling\n  infoBoxStyle: 'border-left: 4px solid #e0e0e0; padding: 15px 20px; margin: 20px 0; background-color: #f9f9f9; font-size: 0.95em;'\n};\n\n// ============================================\n// UTILITY FUNCTIONS\n// ============================================\n\n// Generate slug from text (handles multiple languages)\nfunction generateSlug(text) {\n  if (!text) return 'section';\n  \n  return text\n    .toLowerCase()\n    .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '') // Remove diacritics\n    .replace(/[`'\"]/g, '') // Remove quotes and backticks\n    .replace(/[^\\w\\s-]/g, '') // Remove special chars\n    .replace(/\\s+/g, '-') // Spaces to hyphens\n    .replace(/-+/g, '-') // Multiple hyphens to single\n    .replace(/^-+|-+$/g, '') // Trim hyphens\n    .trim() || 'section';\n}\n\n// Detect if a line is an info box indicator\nfunction isInfoBox(text) {\n  if (!text || typeof text !== 'string') return false;\n  \n  return CONFIG.infoBoxIndicators.some(indicator => \n    text.includes(indicator)\n  );\n}\n\n// Detect if we're in a references or FAQ section\nfunction isReferencesSection(text) {\n  if (!text || typeof text !== 'string') return false;\n  \n  const normalizedText = text.toLowerCase();\n  return CONFIG.referencesKeywords.some(keyword => \n    normalizedText.includes(keyword)\n  );\n}\n\n// Process markdown links [text](url) - FIXED to handle all cases\nfunction processMarkdownLinks(text) {\n  if (!text || typeof text !== 'string') return text || '';\n  \n  // Match [text](url) pattern\n  // This regex captures: [any text except ]](any url except ))\n  return text.replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, (match, linkText, url) => {\n    // Clean up the URL (remove any accidental spaces or trailing parentheses)\n    const cleanUrl = url.trim().replace(/\\)$/, '');\n    // Don't convert if the link text already contains an anchor tag\n    if (linkText.includes('<a href=')) {\n      return match; // Keep original\n    }\n    return `<a href=\"${cleanUrl}\" target=\"_blank\" rel=\"noopener\">${linkText}</a>`;\n  });\n}\n\n// Process markdown formatting (bold, italic, code)\nfunction processMarkdown(text) {\n  if (!text || typeof text !== 'string') return text || '';\n  \n  // Process links first (before bold/italic to avoid conflicts)\n  text = processMarkdownLinks(text);\n  \n  // Process bold text **text** or __text__\n  text = text.replace(/\\*\\*([^*]+?)\\*\\*/g, '<strong>$1</strong>');\n  text = text.replace(/__([^_]+?)__/g, '<strong>$1</strong>');\n  \n  // Process italic text *text* or _text_ (but not URLs or already processed)\n  text = text.replace(/(?<![*_<])\\*(?!\\*)([^*<>]+?)\\*(?![*_>])/g, '<em>$1</em>');\n  text = text.replace(/(?<![*_<])_(?!_)([^_<>]+?)_(?![*_>])/g, '<em>$1</em>');\n  \n  // Process inline code `text`\n  text = text.replace(/`([^`]+?)`/g, '<code>$1</code>');\n  \n  return text;\n}\n\n// Process internal links - MORE ROBUST VERSION\nfunction processInternalLinks(text, internalLinks) {\n  if (!text || typeof text !== 'string') return text || '';\n  if (!internalLinks || !Array.isArray(internalLinks) || internalLinks.length === 0) return text;\n  \n  let processedText = text;\n  \n  internalLinks.forEach(link => {\n    if (!link || !link.anchor_text || !link.url) return;\n    \n    const anchorText = link.anchor_text;\n    const url = link.url;\n    \n    // Escape special regex characters in anchor text\n    const escapedAnchor = anchorText.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n    \n    // Split by HTML tags to avoid processing inside tags\n    const parts = processedText.split(/(<[^>]+>)/g);\n    \n    processedText = parts.map((part, index) => {\n      // Only process non-HTML parts (even indices)\n      if (index % 2 === 1) return part;\n      \n      // Check if this part already contains a link to avoid double-linking\n      if (part.includes(`href=\"${url}\"`) || part.includes(`href='${url}'`)) return part;\n      \n      // Create word boundary regex\n      const regex = new RegExp(`\\\\b${escapedAnchor}\\\\b`, 'gi');\n      \n      // Replace only the first occurrence to avoid over-linking\n      let replaced = false;\n      return part.replace(regex, (match) => {\n        if (replaced) return match;\n        replaced = true;\n        return `<a href=\"${url}\" target=\"_blank\" rel=\"noopener\">${match}</a>`;\n      });\n    }).join('');\n  });\n  \n  return processedText;\n}\n\n// Convert plain URLs to clickable links - ONLY convert standalone URLs\nfunction convertURLsToLinks(text) {\n  if (!text || typeof text !== 'string') return text || '';\n  \n  // Match URLs that are NOT already inside href attributes or markdown link syntax\n  // Negative lookbehind: not preceded by href=\" or href=' or ](\n  // Negative lookahead: not followed by )\n  return text.replace(/(?<!href=['\"]|]\\()https?:\\/\\/[^\\s<)]+(?!\\))/g, (match) => {\n    return `<a href=\"${match}\" target=\"_blank\" rel=\"noopener\">${match}</a>`;\n  });\n}\n\n// Process list items within blockquote lines\nfunction processBlockquoteLines(lines, internalLinks) {\n  let html = '';\n  let inList = false;\n  let currentParagraph = [];\n  \n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    \n    // Check if this line is a list item\n    const listMatch = line.match(/^[\\*\\-\\+]\\s+(.+)$/);\n    \n    if (listMatch) {\n      // Close any open paragraph\n      if (currentParagraph.length > 0) {\n        const paragraphText = currentParagraph.join(' ');\n        html += `<p>${processMarkdown(processInternalLinks(paragraphText, internalLinks))}</p>\\n`;\n        currentParagraph = [];\n      }\n      \n      // Start list if not already in one\n      if (!inList) {\n        html += '<ul>\\n';\n        inList = true;\n      }\n      \n      const listItem = listMatch[1].trim();\n      html += `<li>${processMarkdown(processInternalLinks(listItem, internalLinks))}</li>\\n`;\n    } else if (line === '') {\n      // Empty line\n      if (inList) {\n        html += '</ul>\\n';\n        inList = false;\n      }\n      if (currentParagraph.length > 0) {\n        const paragraphText = currentParagraph.join(' ');\n        html += `<p>${processMarkdown(processInternalLinks(paragraphText, internalLinks))}</p>\\n`;\n        currentParagraph = [];\n      }\n    } else {\n      // Regular text\n      if (inList) {\n        html += '</ul>\\n';\n        inList = false;\n      }\n      currentParagraph.push(line);\n    }\n  }\n  \n  // Close any remaining list or paragraph\n  if (inList) {\n    html += '</ul>\\n';\n  }\n  if (currentParagraph.length > 0) {\n    const paragraphText = currentParagraph.join(' ');\n    html += `<p>${processMarkdown(processInternalLinks(paragraphText, internalLinks))}</p>\\n`;\n  }\n  \n  return html;\n}\n\n// ============================================\n// INTRODUCTION CONVERTER\n// ============================================\n\nfunction convertIntroductionToHTML(introduction, internalLinks) {\n  if (!introduction || typeof introduction !== 'string') return '';\n  \n  const lines = introduction.split('\\n');\n  let html = '';\n  let inBlockquote = false;\n  let blockquoteLines = [];\n  let blockquoteType = 'default'; // 'default', 'info-box'\n  \n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const trimmedLine = line.trim();\n    \n    // Handle blockquote start/continuation\n    if (trimmedLine.startsWith('>')) {\n      if (!inBlockquote) {\n        inBlockquote = true;\n        blockquoteLines = [];\n        blockquoteType = 'default';\n      }\n      \n      // Remove '>' and add to blockquote content\n      const content = trimmedLine.substring(1).trim();\n      \n      // Detect if this is an info box (check first line for indicators)\n      if (blockquoteLines.length === 0 && isInfoBox(content)) {\n        blockquoteType = 'info-box';\n      }\n      \n      if (content) {\n        blockquoteLines.push(content);\n      } else {\n        blockquoteLines.push(''); // Empty line within blockquote\n      }\n      continue;\n    }\n    \n    // Handle blockquote end\n    if (inBlockquote) {\n      // Use different styling for info boxes\n      if (blockquoteType === 'info-box') {\n        html += `<div class=\"info-box\" style=\"${CONFIG.infoBoxStyle}\">\\n`;\n      } else {\n        html += '<blockquote class=\"wp-block-quote\">\\n';\n      }\n      \n      // Process blockquote lines (handles lists and paragraphs)\n      html += processBlockquoteLines(blockquoteLines, internalLinks);\n      \n      if (blockquoteType === 'info-box') {\n        html += '</div>\\n';\n      } else {\n        html += '</blockquote>\\n';\n      }\n      \n      inBlockquote = false;\n      blockquoteLines = [];\n      blockquoteType = 'default';\n    }\n    \n    // Handle horizontal rules\n    if (trimmedLine === '---' || trimmedLine === '___' || trimmedLine === '***') {\n      html += '<hr class=\"wp-block-separator\">\\n';\n      continue;\n    }\n    \n    // Handle regular paragraphs\n    if (trimmedLine !== '') {\n      html += `<p>${processMarkdown(processInternalLinks(trimmedLine, internalLinks))}</p>\\n`;\n    }\n  }\n  \n  // Close any open blockquote at end\n  if (inBlockquote && blockquoteLines.length > 0) {\n    if (blockquoteType === 'info-box') {\n      html += `<div class=\"info-box\" style=\"${CONFIG.infoBoxStyle}\">\\n`;\n    } else {\n      html += '<blockquote class=\"wp-block-quote\">\\n';\n    }\n    \n    html += processBlockquoteLines(blockquoteLines, internalLinks);\n    \n    if (blockquoteType === 'info-box') {\n      html += '</div>\\n';\n    } else {\n      html += '</blockquote>\\n';\n    }\n  }\n  \n  return html;\n}\n\n// ============================================\n// BODY CONVERTER\n// ============================================\n\nfunction convertBodyToHTML(body, internalLinks) {\n  if (!body || typeof body !== 'string') return '';\n  \n  const lines = body.split('\\n');\n  let html = '';\n  let inList = false;\n  let inOrderedList = false;\n  let inBlockquote = false;\n  let blockquoteLines = [];\n  let inTable = false;\n  let isTableHeader = true;\n  let inReferences = false; // Track if we're in the References/FAQ section\n  \n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const trimmedLine = line.trim();\n    \n    // Skip completely empty lines (but handle closures first)\n    if (trimmedLine === '') {\n      if (inList) {\n        html += '</ul>\\n';\n        inList = false;\n      }\n      if (inOrderedList) {\n        html += '</ol>\\n';\n        inOrderedList = false;\n      }\n      if (inBlockquote) {\n        html += '<blockquote class=\"wp-block-quote\">\\n';\n        blockquoteLines.forEach(bqLine => {\n          if (bqLine) {\n            html += `<p>${processMarkdown(processInternalLinks(bqLine, internalLinks))}</p>\\n`;\n          }\n        });\n        html += '</blockquote>\\n';\n        inBlockquote = false;\n        blockquoteLines = [];\n      }\n      if (inTable) {\n        html += '</tbody>\\n</table></figure>\\n';\n        inTable = false;\n      }\n      continue;\n    }\n    \n    // Handle blockquote\n    if (trimmedLine.startsWith('>')) {\n      // Close any open lists or tables\n      if (inList) { html += '</ul>\\n'; inList = false; }\n      if (inOrderedList) { html += '</ol>\\n'; inOrderedList = false; }\n      if (inTable) { html += '</tbody>\\n</table></figure>\\n'; inTable = false; }\n      \n      if (!inBlockquote) {\n        inBlockquote = true;\n        blockquoteLines = [];\n      }\n      const content = trimmedLine.substring(1).trim();\n      if (content) {\n        blockquoteLines.push(content);\n      }\n      continue;\n    } else if (inBlockquote) {\n      // Close blockquote\n      html += '<blockquote class=\"wp-block-quote\">\\n';\n      blockquoteLines.forEach(bqLine => {\n        if (bqLine) {\n          html += `<p>${processMarkdown(processInternalLinks(bqLine, internalLinks))}</p>\\n`;\n        }\n      });\n      html += '</blockquote>\\n';\n      inBlockquote = false;\n      blockquoteLines = [];\n    }\n    \n    // Handle headers (H2, H3, H4, H5, H6) - MUST close tables first\n    const headerMatch = trimmedLine.match(/^(#{2,6})\\s+(.+)$/);\n    if (headerMatch) {\n      // Close any open lists or tables BEFORE header\n      if (inList) { html += '</ul>\\n'; inList = false; }\n      if (inOrderedList) { html += '</ol>\\n'; inOrderedList = false; }\n      if (inTable) { html += '</tbody>\\n</table></figure>\\n'; inTable = false; }\n      \n      const level = headerMatch[1].length;\n      const headerText = headerMatch[2].trim();\n      \n      // Check if this is a references/FAQ section\n      if (level === 2 && isReferencesSection(headerText)) {\n        inReferences = true;\n      }\n      \n      if (level === 2) {\n        const slug = generateSlug(headerText);\n        // NO internal links in headers\n        html += `<h2 id=\"${slug}\">${processMarkdown(headerText)}</h2>\\n`;\n      } else if (level === 3) {\n        html += `<h3>${processMarkdown(headerText)}</h3>\\n`;\n      } else {\n        html += `<h${level}>${processMarkdown(headerText)}</h${level}>\\n`;\n      }\n      continue;\n    }\n    \n    // Handle tables\n    if (trimmedLine.startsWith('|')) {\n      // Close any open lists\n      if (inList) { html += '</ul>\\n'; inList = false; }\n      if (inOrderedList) { html += '</ol>\\n'; inOrderedList = false; }\n      \n      if (!inTable) {\n        inTable = true;\n        isTableHeader = true;\n        html += '<figure class=\"wp-block-table\"><table>\\n<thead>\\n<tr>\\n';\n        \n        // Parse header row\n        const cells = trimmedLine.split('|')\n          .map(cell => cell.trim())\n          .filter(cell => cell !== '');\n        \n        cells.forEach(cell => {\n          html += `<th>${processMarkdown(processInternalLinks(cell, internalLinks))}</th>\\n`;\n        });\n        \n        html += '</tr>\\n</thead>\\n<tbody>\\n';\n        continue;\n      }\n      \n      // Check if this is the separator line\n      if (trimmedLine.match(/^[\\|\\s:-]+$/)) {\n        continue; // Skip separator\n      }\n      \n      // Parse data rows\n      const cells = trimmedLine.split('|')\n        .map(cell => cell.trim())\n        .filter(cell => cell !== '');\n      \n      if (cells.length > 0) {\n        html += '<tr>\\n';\n        cells.forEach(cell => {\n          html += `<td>${processMarkdown(processInternalLinks(cell, internalLinks))}</td>\\n`;\n        });\n        html += '</tr>\\n';\n      }\n      continue;\n    } else if (inTable && !trimmedLine.startsWith('|')) {\n      // Close table when we hit a non-table line\n      html += '</tbody>\\n</table></figure>\\n';\n      inTable = false;\n      // Don't continue - process this line normally\n    }\n    \n    // Handle ordered lists\n    const orderedListMatch = trimmedLine.match(/^(\\d+)\\.\\s+(.+)$/);\n    if (orderedListMatch) {\n      if (inList) { html += '</ul>\\n'; inList = false; }\n      if (inTable) { html += '</tbody>\\n</table></figure>\\n'; inTable = false; }\n      \n      if (!inOrderedList) {\n        html += '<ol>\\n';\n        inOrderedList = true;\n      }\n      \n      let listItem = orderedListMatch[2].trim();\n      \n      // Process markdown first (including markdown links), then convert remaining plain URLs\n      listItem = processMarkdown(processInternalLinks(listItem, internalLinks));\n      \n      // In References/FAQ section, convert plain URLs to links (after markdown processing)\n      if (inReferences) {\n        listItem = convertURLsToLinks(listItem);\n      }\n      \n      html += `<li>${listItem}</li>\\n`;\n      continue;\n    } else if (inOrderedList && !trimmedLine.match(/^\\d+\\./)) {\n      html += '</ol>\\n';\n      inOrderedList = false;\n    }\n    \n    // Handle unordered lists\n    const listMatch = trimmedLine.match(/^[\\*\\-\\+]\\s+(.+)$/);\n    if (listMatch) {\n      if (inOrderedList) { html += '</ol>\\n'; inOrderedList = false; }\n      if (inTable) { html += '</tbody>\\n</table></figure>\\n'; inTable = false; }\n      \n      if (!inList) {\n        html += '<ul>\\n';\n        inList = true;\n      }\n      \n      let listItem = listMatch[1].trim();\n      \n      // Remove checkbox syntax\n      listItem = listItem.replace(/^\\[\\s?\\]\\s*/, '');\n      listItem = listItem.replace(/^\\[x\\]\\s*/i, '');\n      \n      html += `<li>${processMarkdown(processInternalLinks(listItem, internalLinks))}</li>\\n`;\n      continue;\n    } else if (inList && !trimmedLine.match(/^[\\*\\-\\+]/)) {\n      html += '</ul>\\n';\n      inList = false;\n    }\n    \n    // Handle horizontal rules\n    if (trimmedLine === '---' || trimmedLine === '___' || trimmedLine === '***') {\n      html += '<hr class=\"wp-block-separator\">\\n';\n      continue;\n    }\n    \n    // Handle regular paragraphs\n    if (trimmedLine !== '' && !inTable) {\n      let paragraphContent = trimmedLine;\n      \n      // Process markdown first (including markdown links), then convert remaining plain URLs\n      paragraphContent = processMarkdown(processInternalLinks(paragraphContent, internalLinks));\n      \n      // In References/FAQ section, convert plain URLs to links (after markdown processing)\n      if (inReferences) {\n        paragraphContent = convertURLsToLinks(paragraphContent);\n      }\n      \n      html += `<p>${paragraphContent}</p>\\n`;\n    }\n  }\n  \n  // Close any open tags at end\n  if (inList) html += '</ul>\\n';\n  if (inOrderedList) html += '</ol>\\n';\n  if (inBlockquote && blockquoteLines.length > 0) {\n    html += '<blockquote class=\"wp-block-quote\">\\n';\n    blockquoteLines.forEach(bqLine => {\n      if (bqLine) {\n        html += `<p>${processMarkdown(processInternalLinks(bqLine, internalLinks))}</p>\\n`;\n      }\n    });\n    html += '</blockquote>\\n';\n  }\n  if (inTable) html += '</tbody>\\n</table></figure>\\n';\n  \n  return html;\n}\n\n// ============================================\n// TABLE OF CONTENTS GENERATOR\n// ============================================\n\nfunction generateTOC(tocArray, internalLinks, tocTitle) {\n  if (!tocArray || !Array.isArray(tocArray) || tocArray.length === 0) return '';\n  \n  // Use provided title or default\n  const title = tocTitle || CONFIG.defaultTocTitle;\n  \n  let html = '<nav class=\"table-of-contents wp-block-group\">\\n';\n  html += `<h2>${title}</h2>\\n`;\n  html += '<ul>\\n';\n  \n  tocArray.forEach(item => {\n    if (!item || typeof item !== 'string') return;\n    \n    const slug = generateSlug(item);\n    // Process markdown but NO internal links in TOC\n    const cleanText = processMarkdown(item);\n    html += `<li><a href=\"#${slug}\">${cleanText}</a></li>\\n`;\n  });\n  \n  html += '</ul>\\n</nav>\\n';\n  \n  return html;\n}\n\n// ============================================\n// MAIN PROCESSING\n// ============================================\n\nconst outputData = inputData.map(item => {\n  try {\n    const data = item.json;\n    \n    // Validate data structure\n    if (!data || typeof data !== 'object') {\n      console.error('Invalid data format:', data);\n      return {\n        json: {\n          html_full: '<article><p>Error: Invalid data format</p></article>'\n        }\n      };\n    }\n    \n    // Extract internal links (if available)\n    const internalLinks = data.internal_links || [];\n    \n    // Extract TOC title (if provided)\n    const tocTitle = data.toc_title || null;\n    \n    // Convert each section\n    const htmlIntroduction = data.introduction \n      ? convertIntroductionToHTML(data.introduction, internalLinks)\n      : '';\n    \n    const htmlTOC = data.table_of_contents \n      ? generateTOC(data.table_of_contents, internalLinks, tocTitle)\n      : '';\n    \n    const htmlBody = data.body \n      ? convertBodyToHTML(data.body, internalLinks)\n      : '';\n    \n    // Build complete HTML\n    let htmlFull = '<article class=\"article-content\">\\n';\n    \n    if (htmlIntroduction) {\n      htmlFull += `<div class=\"article-introduction\">\\n${htmlIntroduction}</div>\\n`;\n    }\n    \n    if (htmlTOC) {\n      htmlFull += htmlTOC;\n    }\n    \n    if (htmlBody) {\n      htmlFull += `<div class=\"article-body\">\\n${htmlBody}</div>\\n`;\n    }\n    \n    htmlFull += '</article>';\n    \n    return {\n      json: {\n        html_full: htmlFull\n      }\n    };\n    \n  } catch (error) {\n    console.error('Error processing article:', error);\n    return {\n      json: {\n        html_full: `<article><p>Error: ${error.message}</p></article>`\n      }\n    };\n  }\n});\n\nreturn outputData;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1376,
        1632
      ],
      "id": "c22aae28-6066-4cda-8a33-f66dd4d164d8",
      "name": "HTML Format"
    },
    {
      "parameters": {
        "resource": "image",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash-image-preview",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash-image-preview (Nano Banana)"
        },
        "prompt": "={{ $('Prepare Wordpress').item.json.featured_image_prompt }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        832,
        1888
      ],
      "id": "cc42307d-e9aa-4ced-84e4-af2e9f1e6243",
      "name": "Generate an image",
      "credentials": {
        "googlePalmApi": {
          "id": "8eDMUtP7P20s67XX",
          "name": "Gemini API 10/10/2025"
        }
      }
    },
    {
      "parameters": {
        "title": "={{ $json.title }}",
        "additionalFields": {
          "authorId": 6,
          "content": "={{ $json.html_body }}",
          "slug": "={{ $json.handle }}",
          "status": "draft"
        }
      },
      "type": "n8n-nodes-base.wordpress",
      "typeVersion": 1,
      "position": [
        672,
        1888
      ],
      "id": "01dd412c-b304-443d-a330-613f3c5cb00e",
      "name": "Create a post",
      "credentials": {
        "wordpressApi": {
          "id": "SZ3gmYkTqQpnfmh2",
          "name": "collagenwise"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://collagenwise.ro/wp-json/wp/v2/media",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wordpressApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Disposition",
              "value": "=attachment; filename=\"{{ $('Prepare Wordpress').item.json.featured_image_title }}.webp\""
            }
          ]
        },
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {}
      },
      "id": "41ed09e5-e5d8-49da-b403-54d61bc8c692",
      "name": "Upload Image",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1152,
        1888
      ],
      "typeVersion": 4.2,
      "credentials": {
        "wordpressApi": {
          "id": "SZ3gmYkTqQpnfmh2",
          "name": "collagenwise"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://collagenwise.ro/wp-json/wp/v2/posts/{{ $('Create a post').item.json.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wordpressApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "featured_media",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "2deb9793-651a-45b6-ad01-c3570d9da22a",
      "name": "Set Featured Image",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1472,
        1888
      ],
      "typeVersion": 4.2,
      "credentials": {
        "wordpressApi": {
          "id": "SZ3gmYkTqQpnfmh2",
          "name": "collagenwise"
        }
      }
    },
    {
      "parameters": {
        "content": "## -> Post on Wordpress",
        "height": 220,
        "width": 1460,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        480,
        1824
      ],
      "id": "9f6872c9-aa7e-4caf-9c0d-9043619a6a21",
      "name": "Sticky Note38"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://collagenwise.ro/wp-json/wp/v2/media/{{ $json.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wordpressApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "title",
              "value": "={{ $('Prepare Wordpress').item.json.featured_image_title }}"
            },
            {
              "name": "slug",
              "value": "={{ $('Prepare Wordpress').item.json.featured_image_title.toLowerCase().replace(/[^\\w\\s-]/g, '').trim().replace(/\\s+/g, '-') }}"
            },
            {
              "name": "alt_text",
              "value": "={{ $('Prepare Wordpress').item.json.featured_image_alt_text }}"
            },
            {
              "name": "description",
              "value": "={{ $('Prepare Wordpress').item.json.featured_image_prompt }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1312,
        1888
      ],
      "id": "903371ac-a9e2-4df1-a0fa-70989213b8b0",
      "name": "Update image meta",
      "credentials": {
        "wordpressApi": {
          "id": "SZ3gmYkTqQpnfmh2",
          "name": "collagenwise"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "583bfd6e-9ecf-49f9-9310-e5246472e959",
              "name": "Option",
              "value": "Wordpress",
              "type": "string"
            },
            {
              "id": "a155979a-f043-46b2-8941-eef6fb2ea6f1",
              "name": "meta_title",
              "value": "={{ $json.output.meta_title }}",
              "type": "string"
            },
            {
              "id": "78f53810-62cf-47c3-9881-926d013f823d",
              "name": "handle",
              "value": "={{ $json.output.handle }}",
              "type": "string"
            },
            {
              "id": "f5593873-4304-40dd-a4dc-bb191d2fee08",
              "name": "meta_description",
              "value": "={{ $json.output.meta_description }}",
              "type": "string"
            },
            {
              "id": "492ff9f9-c052-4418-b1d2-6dfe3b2f0388",
              "name": "featured_image_prompt",
              "value": "={{ $json.output.featured_image_prompt }}",
              "type": "string"
            },
            {
              "id": "dc6bc05a-9b09-47cf-afdb-651dbbf2c7c4",
              "name": "featured_image_title",
              "value": "={{ $json.output.featured_image_title }}",
              "type": "string"
            },
            {
              "id": "c44bd938-5f30-41e8-b8da-6d591242498f",
              "name": "featured_image_alt_text",
              "value": "={{ $json.output.featured_image_alt_text }}",
              "type": "string"
            },
            {
              "id": "1e07bac8-ec8a-49af-b13e-59f4bdc54126",
              "name": "title",
              "value": "={{ $('Arrange by sections').item.json.title }}",
              "type": "string"
            },
            {
              "id": "3db5f758-2703-4cda-a45c-70e9c257a65e",
              "name": "html_body",
              "value": "={{ $('HTML Format').item.json.html_full }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        512,
        1888
      ],
      "id": "0663cc16-91f0-4e26-ac29-7dd7b12c5c03",
      "name": "Prepare Wordpress"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Get First Draft').item.json.first_draft }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=# **Article Metadata Generator Agent**\n\nYou are an expert SEO metadata specialist who creates compelling, search-optimized metadata for articles.\n\n---\n\n## üéØ Your Mission\n\nRead the provided article (in markdown) and generate 6 SEO-optimized metadata fields that will drive clicks and engagement.\n\n**You MUST use think_tool at 4 strategic checkpoints during this process.**\n\n---\n\n## üìã Workflow\n\n### Step 1: Analyze the Article\n\n**Read the article and extract:**\n1. **Primary keyword** - The main topic/phrase (usually in H1 title)\n2. **Article language** - What language is the article written in?\n3. **Main benefit** - What value does the reader get?\n4. **Article type** - Guide, listicle, how-to, comparison, etc.\n5. **Key visual concept** - What should the featured image show?\n\n---\n\n### Step 2: CHECKPOINT 1 - Use think_tool for Analysis Validation\n\nüß† **MANDATORY: Use think_tool to verify your extraction before proceeding**\n```\nCHECKPOINT 1 - ARTICLE ANALYSIS:\n\nLANGUAGE DETECTED:\n- Article language: [detected language name]\n- Will generate metadata in: [same language, without special characters]\n- Special characters present: [YES - list them / NO]\n\nPRIMARY KEYWORD EXTRACTED:\n- Original keyword: \"[exact keyword phrase from article]\"\n- Found in: [H1 title / first paragraph / Key Takeaway]\n- Character count: [X] characters\n- Latin-safe version: \"[keyword with special chars converted]\"\n\nMAIN BENEFIT IDENTIFIED:\n- Core value proposition: \"[what reader gains from article]\"\n- Secondary benefits: \n  * [Benefit 1]\n  * [Benefit 2]\n  * [Benefit 3]\n\nARTICLE TYPE & STRUCTURE:\n- Format: [Guide / Listicle / How-to / Comparison / Review / Tutorial / etc.]\n- Estimated length: [~X words]\n- Has TOC: [YES/NO]\n- Has FAQ: [YES/NO]\n- Has tables/lists: [YES/NO]\n\nVISUAL CONCEPT FOR IMAGE:\n- Main subject: \"[primary focus - what's the hero element]\"\n- Setting/context: \"[environment/background]\"\n- Suggested style: [Professional / Casual / Technical / Medical / Clean / Modern / etc.]\n- Article type suggests: [workspace / product / diagram / person / process / comparison / etc.]\n- Key elements to include: [list 2-3 key visual elements]\n\nSPECIAL CHARACTER CONVERSION PLAN:\n[List any special characters that need conversion to Latin equivalents]\nExample format:\n- [special char] ‚Üí [latin char] (in words: [list])\n\nMETADATA GENERATION PLAN:\n- meta_title target: \"[primary keyword] + [benefit/type]\" in [language]\n- handle target: \"[primary-keyword-slug]\" in [language], lowercase\n- meta_description target: \"[keyword] + [benefit] + [CTA]\" in [language]\n- image_prompt target: English description of [visual concept]\n- image_alt_text target: Describe [visual elements] in [language]\n- image_title target: Short descriptive title with keyword in [language]\n\nPOTENTIAL ISSUES TO WATCH:\n- Character count challenges: [any concerns about fitting in limits?]\n- Special character density: [HIGH/MEDIUM/LOW]\n- Keyword complexity: [SIMPLE/MODERATE/COMPLEX]\n\nSTATUS: ‚úÖ ANALYSIS COMPLETE - READY TO GENERATE DRAFT METADATA\n\nNEXT ACTION: Generate draft metadata for all 6 fields\n```\n\n---\n\n### Step 3: Generate Draft Metadata\n\n**Create initial versions of all 6 fields:**\n\n1. Draft meta_title\n2. Draft handle\n3. Draft meta_description\n4. Draft featured_image_prompt\n5. Draft featured_image_alt_text\n6. Draft featured_image_title\n\n**Don't worry about perfection yet - focus on getting the content right.**\n\n---\n\n### Step 4: CHECKPOINT 2 - Use think_tool for Draft Validation\n\nüß† **MANDATORY: Use think_tool to review your draft metadata before character validation**\n```\nCHECKPOINT 2 - DRAFT METADATA REVIEW:\n\nDRAFT META_TITLE:\n- Draft: \"[your draft title]\"\n- Contains primary keyword: [YES at position X / NO]\n- Language correct: [YES - matches article / NO]\n- Includes benefit/value: [YES - what benefit / NO]\n- Capitalization: [Title Case ‚úì / needs fixing]\n- Special characters present: [NONE ‚úì / LIST THEM ‚úó]\n- Preliminary assessment: [GOOD / NEEDS WORK]\n\nDRAFT HANDLE:\n- Draft: \"[your draft handle]\"\n- Based on primary keyword: [YES ‚úì / NO ‚úó]\n- All lowercase: [YES ‚úì / NO ‚úó]\n- Uses hyphens only: [YES ‚úì / NO - has underscores/spaces ‚úó]\n- Special characters present: [NONE ‚úì / LIST THEM ‚úó]\n- Word count: [X words] (target: 3-8)\n- Preliminary assessment: [GOOD / NEEDS WORK]\n\nDRAFT META_DESCRIPTION:\n- Draft: \"[your draft description]\"\n- Contains primary keyword: [YES at position X / NO]\n- Language correct: [YES - matches article / NO]\n- Has clear benefit: [YES - what benefit / NO]\n- Has call-to-action: [YES - what CTA / NO]\n- Special characters present: [NONE ‚úì / LIST THEM ‚úó]\n- Preliminary assessment: [GOOD / NEEDS WORK]\n\nDRAFT IMAGE_PROMPT:\n- Draft: \"[your draft prompt]\"\n- In English: [YES ‚úì / NO ‚úó]\n- Describes subject clearly: [YES / NO]\n- Includes composition details: [YES / NO]\n- Includes lighting details: [YES / NO]\n- Includes style/mood: [YES / NO]\n- Matches article topic: [YES / NO]\n- Uses sentences (not keywords): [YES ‚úì / NO ‚úó]\n- Preliminary assessment: [GOOD / NEEDS WORK]\n\nDRAFT IMAGE_ALT_TEXT:\n- Draft: \"[your draft alt text]\"\n- Language correct: [YES - matches article / NO]\n- Describes visible elements: [YES / NO]\n- Includes primary keyword naturally: [YES / NO]\n- Avoids \"image of\" phrases: [YES ‚úì / NO ‚úó]\n- Special characters present: [NONE ‚úì / LIST THEM ‚úó]\n- Preliminary assessment: [GOOD / NEEDS WORK]\n\nDRAFT IMAGE_TITLE:\n- Draft: \"[your draft image title]\"\n- Language correct: [YES - matches article / NO]\n- Includes primary keyword: [YES / NO]\n- Short and descriptive: [YES / NO]\n- Special characters present: [NONE ‚úì / LIST THEM ‚úó]\n- Preliminary assessment: [GOOD / NEEDS WORK]\n\nISSUES IDENTIFIED:\n[List any problems found in drafts]\n- Issue 1: [description] - FIX: [what to do]\n- Issue 2: [description] - FIX: [what to do]\n\nREVISIONS NEEDED:\n[List what needs to be changed before character counting]\n- [ ] Fix special characters in [field name]\n- [ ] Adjust language in [field name]\n- [ ] Add missing element to [field name]\n- [ ] Improve clarity in [field name]\n\nSTATUS: [‚úÖ READY FOR CHARACTER VALIDATION / ‚ö†Ô∏è NEEDS REVISIONS]\n\nNEXT ACTION: [Count characters and validate against limits / Fix issues first]\n```\n\n**If issues found, revise the drafts now before proceeding.**\n\n---\n\n### Step 5: Character Count Validation\n\n**Count characters/words for each field:**\n\n1. meta_title: Count characters (target: 50-60)\n2. handle: Count words (target: 3-8)\n3. meta_description: Count characters (target: 150-160)\n4. featured_image_prompt: Count words (target: 80-120)\n5. featured_image_alt_text: Count words (target: 10-15)\n6. featured_image_title: Count words (target: 5-10)\n\n**Adjust any field that's outside the target range.**\n\n---\n\n### Step 6: CHECKPOINT 3 - Use think_tool for Final Content Validation\n\nüß† **MANDATORY: Use think_tool for comprehensive final check before formatting JSON**\n```\nCHECKPOINT 3 - FINAL CONTENT VALIDATION:\n\nFINAL META_TITLE:\n- Final version: \"[your final title]\"\n- Character count: [X] characters (target: 50-60)\n- Status: [‚úÖ WITHIN RANGE / ‚ùå TOO SHORT / ‚ùå TOO LONG]\n- Contains primary keyword: [‚úÖ YES at position X / ‚ùå NO]\n- Language: [‚úÖ Matches article / ‚ùå Wrong language]\n- Capitalization: [‚úÖ Title Case / ‚ùå Needs fixing]\n- Special characters: [‚úÖ NONE / ‚ùå FOUND: list]\n- VALIDATION: [‚úÖ PASS / ‚ùå FAIL - must fix]\n\nFINAL HANDLE:\n- Final version: \"[your final handle]\"\n- Word count: [X] words (target: 3-8)\n- Status: [‚úÖ WITHIN RANGE / ‚ùå TOO SHORT / ‚ùå TOO LONG]\n- All lowercase: [‚úÖ YES / ‚ùå NO - has uppercase]\n- Uses hyphens only: [‚úÖ YES / ‚ùå NO - has other chars]\n- No special characters: [‚úÖ CONFIRMED / ‚ùå FOUND: list]\n- Matches primary keyword: [‚úÖ YES / ‚ùå NO]\n- VALIDATION: [‚úÖ PASS / ‚ùå FAIL - must fix]\n\nFINAL META_DESCRIPTION:\n- Final version: \"[your final description]\"\n- Character count: [X] characters (target: 150-160)\n- Status: [‚úÖ WITHIN RANGE / ‚ùå TOO SHORT / ‚ùå TOO LONG]\n- Contains primary keyword: [‚úÖ YES at position X / ‚ùå NO]\n- Language: [‚úÖ Matches article / ‚ùå Wrong language]\n- Has benefit: [‚úÖ YES / ‚ùå NO]\n- Has CTA: [‚úÖ YES / ‚ùå NO]\n- Special characters: [‚úÖ NONE / ‚ùå FOUND: list]\n- VALIDATION: [‚úÖ PASS / ‚ùå FAIL - must fix]\n\nFINAL IMAGE_PROMPT:\n- Final version: \"[your final prompt]\"\n- Word count: [X] words (target: 80-120)\n- Status: [‚úÖ WITHIN RANGE / ‚ùå TOO SHORT / ‚ùå TOO LONG]\n- In English: [‚úÖ YES / ‚ùå NO]\n- Has subject description: [‚úÖ YES / ‚ùå NO]\n- Has composition details: [‚úÖ YES / ‚ùå NO]\n- Has lighting details: [‚úÖ YES / ‚ùå NO]\n- Has style/mood: [‚úÖ YES / ‚ùå NO]\n- Uses sentences: [‚úÖ YES / ‚ùå NO - keyword list]\n- Matches article topic: [‚úÖ YES / ‚ùå NO]\n- VALIDATION: [‚úÖ PASS / ‚ùå FAIL - must fix]\n\nFINAL IMAGE_ALT_TEXT:\n- Final version: \"[your final alt text]\"\n- Word count: [X] words (target: 10-15)\n- Status: [‚úÖ WITHIN RANGE / ‚ùå TOO SHORT / ‚ùå TOO LONG]\n- Language: [‚úÖ Matches article / ‚ùå Wrong language]\n- Describes visible elements: [‚úÖ YES / ‚ùå NO]\n- Includes primary keyword: [‚úÖ YES naturally / ‚ùå NO]\n- No \"image of\" phrases: [‚úÖ CORRECT / ‚ùå FOUND]\n- Special characters: [‚úÖ NONE / ‚ùå FOUND: list]\n- VALIDATION: [‚úÖ PASS / ‚ùå FAIL - must fix]\n\nFINAL IMAGE_TITLE:\n- Final version: \"[your final image title]\"\n- Word count: [X] words (target: 5-10)\n- Status: [‚úÖ WITHIN RANGE / ‚ùå TOO SHORT / ‚ùå TOO LONG]\n- Language: [‚úÖ Matches article / ‚ùå Wrong language]\n- Contains primary keyword: [‚úÖ YES / ‚ùå NO]\n- Short and descriptive: [‚úÖ YES / ‚ùå NO - too vague]\n- Suitable as image filename: [‚úÖ YES / ‚ùå NO]\n- Special characters: [‚úÖ NONE / ‚ùå FOUND: list]\n- VALIDATION: [‚úÖ PASS / ‚ùå FAIL - must fix]\n\nOVERALL VALIDATION SUMMARY:\n- Total fields: 6\n- Passed validation: [X] / 6\n- Failed validation: [X] / 6\n\nCRITICAL ISSUES BLOCKING JSON FORMATTING:\n[NONE - Ready to format JSON ‚úÖ / LIST ALL FAILURES ‚ùå]\n\nIf any failures:\n- MUST FIX: [list each field and specific issue]\n- DO NOT FORMAT JSON until all fields pass validation\n\nCHECKPOINT COMPLIANCE:\n‚úì Checkpoint 1 (Analysis): COMPLETED\n‚úì Checkpoint 2 (Draft Review): COMPLETED\n‚úì Checkpoint 3 (Content Validation): COMPLETING NOW\n\nCONTENT STATUS: [‚úÖ ALL CONTENT VALIDATED - READY TO FORMAT JSON / ‚ùå CONTENT ISSUES MUST BE FIXED]\n\nIf ‚úÖ: Proceed to format JSON output\nIf ‚ùå: Fix all content issues, then re-validate\n```\n\n**If any field fails validation, fix it NOW before formatting JSON.**\n\n---\n\n### Step 7: Format JSON Output\n\n**Create the JSON structure with your validated content:**\n```json\n{\n  \"meta_title\": \"Your Final Title Here\",\n  \"handle\": \"your-final-handle-here\",\n  \"meta_description\": \"Your final description here with benefit and call to action.\",\n  \"featured_image_prompt\": \"Your final detailed image prompt in natural English sentences.\",\n  \"featured_image_alt_text\": \"Your final alt text here\",\n  \"featured_image_title\": \"Your Final Image Title Here\"\n}\n```\n\n---\n\n### Step 8: CHECKPOINT 4 - Use think_tool for JSON Structure Validation\n\nüß† **MANDATORY: Use think_tool to verify JSON structure before final output**\n```\nCHECKPOINT 4 - JSON STRUCTURE VALIDATION:\n\nJSON FORMAT CHECK:\n- Starts with opening brace: [‚úÖ { / ‚ùå Missing]\n- Ends with closing brace: [‚úÖ } / ‚ùå Missing]\n- No markdown code blocks: [‚úÖ Clean JSON / ‚ùå Has ```json``` markers]\n- No extra text before JSON: [‚úÖ Clean / ‚ùå Has preamble]\n- No extra text after JSON: [‚úÖ Clean / ‚ùå Has postamble]\n\nREQUIRED FIELDS CHECK:\n1. \"meta_title\": [‚úÖ PRESENT / ‚ùå MISSING]\n2. \"handle\": [‚úÖ PRESENT / ‚ùå MISSING]\n3. \"meta_description\": [‚úÖ PRESENT / ‚ùå MISSING]\n4. \"featured_image_prompt\": [‚úÖ PRESENT / ‚ùå MISSING]\n5. \"featured_image_alt_text\": [‚úÖ PRESENT / ‚ùå MISSING]\n6. \"featured_image_title\": [‚úÖ PRESENT / ‚ùå MISSING]\n\nFIELD NAME VALIDATION:\n- All field names in quotes: [‚úÖ YES / ‚ùå NO - list unquoted]\n- Correct spelling: [‚úÖ ALL CORRECT / ‚ùå ERRORS: list]\n- Exact names match schema:\n  * \"meta_title\": [‚úÖ / ‚ùå]\n  * \"handle\": [‚úÖ / ‚ùå]\n  * \"meta_description\": [‚úÖ / ‚ùå]\n  * \"featured_image_prompt\": [‚úÖ / ‚ùå]\n  * \"featured_image_alt_text\": [‚úÖ / ‚ùå]\n  * \"featured_image_title\": [‚úÖ / ‚ùå]\n\nFIELD VALUE VALIDATION:\n- All values in quotes: [‚úÖ YES / ‚ùå NO - list unquoted]\n- No unescaped quotes inside values: [‚úÖ SAFE / ‚ùå FOUND: list]\n- No line breaks inside values: [‚úÖ SAFE / ‚ùå FOUND in: list]\n- No trailing commas: [‚úÖ SAFE / ‚ùå FOUND after: list]\n\nSYNTAX VALIDATION:\n- Commas between fields: [‚úÖ ALL PRESENT / ‚ùå MISSING after: list]\n- No comma after last field: [‚úÖ CORRECT / ‚ùå Extra comma present]\n- Colons after field names: [‚úÖ ALL PRESENT / ‚ùå MISSING in: list]\n- Proper nesting: [‚úÖ FLAT STRUCTURE / ‚ùå Nested objects found]\n\nEXTRA FIELDS CHECK:\n- Only 6 required fields: [‚úÖ YES / ‚ùå NO - extra fields: list]\n- No additional properties: [‚úÖ CLEAN / ‚ùå FOUND: list]\n\nCHARACTER ENCODING:\n- Only Latin characters in metadata: [‚úÖ YES / ‚ùå Special chars in: list]\n- Only English in image_prompt: [‚úÖ YES / ‚ùå Other language detected]\n- Proper JSON escaping: [‚úÖ CORRECT / ‚ùå Needs escaping in: list]\n\nJSON VALIDITY TEST:\nParse the JSON mentally:\n- Valid JSON syntax: [‚úÖ PARSEABLE / ‚ùå SYNTAX ERROR: describe]\n- Can be parsed by JSON.parse(): [‚úÖ YES / ‚ùå NO - error: describe]\n\nFINAL JSON OUTPUT TO BE SENT:\n```\n[Write the complete JSON here exactly as it will be output]\n```\n\nSTRUCTURE VALIDATION SUMMARY:\n- Format issues: [X]\n- Field issues: [X]\n- Syntax issues: [X]\n- Total issues: [X]\n\nCRITICAL ERRORS BLOCKING OUTPUT:\n[NONE - Safe to output ‚úÖ / LIST ALL ERRORS ‚ùå]\n\nCHECKPOINT COMPLIANCE:\n‚úì Checkpoint 1 (Analysis): COMPLETED\n‚úì Checkpoint 2 (Draft Review): COMPLETED\n‚úì Checkpoint 3 (Content Validation): COMPLETED\n‚úì Checkpoint 4 (JSON Structure): COMPLETING NOW\n\nFINAL STATUS: [‚úÖ JSON STRUCTURE VALID - SAFE TO OUTPUT / ‚ùå JSON ERRORS MUST BE FIXED]\n\nIf ‚úÖ: Output the JSON immediately\nIf ‚ùå: Fix all JSON structure issues, then re-validate and output\n```\n\n**If any JSON structure issues found, fix them NOW before outputting.**\n\n---\n\n### Step 9: Output Final JSON\n\n**Only after ALL validations pass in Checkpoint 4:**\n\nOutput ONLY the JSON. No markdown blocks, no explanations, no other text.\n\nStart with `{` and end with `}`\n\n---\n\n## üî¥ Field Specifications\n\n### **1Ô∏è‚É£ meta_title** (50-60 characters)\n\n**Rules:**\n- ‚úÖ Write in the SAME language as the article\n- ‚úÖ Include primary keyword near the start\n- ‚úÖ Add value/benefit or descriptor\n- ‚úÖ Use proper capitalization (Title Case)\n- ‚úÖ ONLY Latin characters: A-Z, a-z, 0-9, spaces, basic punctuation\n- ‚úÖ Character count: 50-60 (strict)\n- ‚ùå NO special characters or diacritics (convert them)\n- ‚ùå NO emojis or symbols\n\n**Format patterns:**\n- `[Primary Keyword]: [Benefit/Type] [Descriptor]`\n- `[Primary Keyword] - [Complete/Ultimate] [Year] [Type]`\n- `[Action Verb] [Primary Keyword]: [Benefit] [Tips/Guide]`\n- `[Number] [Primary Keyword] [Benefits/Tips/Methods]`\n\n---\n\n### **2Ô∏è‚É£ handle** (URL slug, 3-8 words)\n\n**Rules:**\n- ‚úÖ Write in the SAME language as the article\n- ‚úÖ Based on primary keyword\n- ‚úÖ Lowercase only\n- ‚úÖ Use hyphens as separators (no underscores)\n- ‚úÖ 3-8 words maximum\n- ‚úÖ ONLY: a-z, 0-9, hyphens\n- ‚ùå NO special characters, spaces, or uppercase\n- ‚ùå NO multiple consecutive hyphens\n- ‚ùå NO leading/trailing hyphens\n\n**Generation process:**\n1. Take primary keyword phrase\n2. Convert to lowercase\n3. Replace all spaces with hyphens\n4. Remove/convert all special characters to Latin equivalents\n5. Remove multiple consecutive hyphens\n6. Trim leading/trailing hyphens\n\n---\n\n### **3Ô∏è‚É£ meta_description** (150-160 characters)\n\n**Rules:**\n- ‚úÖ Write in the SAME language as the article\n- ‚úÖ Include primary keyword in first half\n- ‚úÖ Highlight main benefit or value\n- ‚úÖ Include call-to-action\n- ‚úÖ ONLY Latin characters: A-Z, a-z, 0-9, basic punctuation (. , : - )\n- ‚úÖ Character count: 150-160 (strict)\n- ‚ùå NO special characters or diacritics (convert them)\n\n**Structure:**\n`[Primary keyword] + [main benefit]. [Supporting detail]. [CTA].`\n\n---\n\n### **4Ô∏è‚É£ featured_image_prompt** (80-120 words)\n\n**Rules:**\n- ‚úÖ Write in ENGLISH (for AI image generator compatibility)\n- ‚úÖ Write in clear, descriptive sentences (not keywords)\n- ‚úÖ Specify: subject, composition, lighting, style, mood\n- ‚úÖ Match article topic and tone\n- ‚úÖ Use photorealistic or professional illustration style\n- ‚úÖ Word count: 80-120 (strict)\n- ‚ùå NO vague descriptions\n- ‚ùå NO special characters or emojis\n\n**Image Prompt Formula:**\n\n**Structure your prompt with these elements:**\n\n1. **Main Subject** - What is the primary focus?\n2. **Arrangement** - How are elements positioned?\n3. **Viewpoint** - What angle/perspective?\n4. **Lighting** - What type and direction of light?\n5. **Color Palette** - What colors dominate?\n6. **Style** - What aesthetic or photography type?\n7. **Mood** - What feeling should it convey?\n\n**Template:**\n\"[Subject description] [positioned/arranged on] [surface/setting]. [Shot/Viewed] from [angle] with [lighting type] [creating/producing] [lighting effect]. [Color description] composition with [mood/atmosphere]. [Photography/illustration style], [focus/depth details], [aesthetic descriptor]. [Format if relevant].\"\n\n**Adapt your prompt based on article type:**\n\n- **Tutorial/Instructional** ‚Üí Show process, hands-on, step-by-step\n- **Product/Service** ‚Üí Center subject, clean background, highlight features\n- **Informational** ‚Üí Conceptual visual, organized elements, clear hierarchy\n- **Comparison** ‚Üí Side-by-side arrangement, balanced composition, equal emphasis\n- **Review/Analysis** ‚Üí Subject with context, detailed view, professional setup\n\n---\n\n### **5Ô∏è‚É£ featured_image_alt_text** (10-15 words)\n\n**Rules:**\n- ‚úÖ Write in the SAME language as the article\n- ‚úÖ Describe what's actually visible in the image\n- ‚úÖ Include primary keyword naturally\n- ‚úÖ Be specific and accurate\n- ‚úÖ Write for accessibility (screen readers)\n- ‚úÖ ONLY Latin characters\n- ‚úÖ Word count: 10-15 (strict)\n- ‚ùå NO \"image of\" or \"picture of\"\n- ‚ùå NO marketing language\n- ‚ùå NO special characters or diacritics (convert them)\n\n**Format:**\n`[Main subject] [with/showing] [key elements] [in/on] [setting/context]`\n\n---\n\n### **6Ô∏è‚É£ featured_image_title** (5-10 words)\n\n**Rules:**\n- ‚úÖ Write in the SAME language as the article\n- ‚úÖ Include primary keyword\n- ‚úÖ Short and descriptive\n- ‚úÖ Suitable as image filename/title\n- ‚úÖ Use proper capitalization (Title Case)\n- ‚úÖ ONLY Latin characters: A-Z, a-z, 0-9, spaces\n- ‚úÖ Word count: 5-10 (strict)\n- ‚ùå NO special characters or diacritics (convert them)\n- ‚ùå NO vague titles\n- ‚ùå NO articles like \"the\", \"a\", \"an\" at the start\n\n**Purpose:**\nThis will be used as the image file title and for SEO image optimization.\n\n**Format patterns:**\n- `[Primary Keyword] [Descriptor]`\n- `[Primary Keyword] [Type] [Context]`\n- `[Descriptor] [Primary Keyword] [Setting]`\n\n**Good examples:**\n- \"Planning Guide Workspace Setup\" (5 words)\n- \"Tutorial Steps Process Diagram\" (5 words)\n- \"Product Comparison Side View\" (5 words)\n- \"Analysis Results Dashboard Display\" (5 words)\n\n**Bad examples:**\n- \"The Planning Guide\" (too vague, has article)\n- \"Image for article\" (generic, no keyword)\n- \"Picture\" (too short, no value)\n\n---\n\n## üö´ Critical Rules - Character Restrictions\n\n**ALL metadata fields (except image_prompt) must:**\n- ‚úÖ Use ONLY Latin characters: A-Z, a-z\n- ‚úÖ Use ONLY these punctuation marks: . , : - ( )\n- ‚úÖ Use numbers: 0-9\n- ‚úÖ Convert all special characters to Latin equivalents\n- ‚ùå NO diacritics, accents, or special characters\n- ‚ùå NO emojis or symbols\n\n**Special character conversion principle:**\n- Convert accented/modified characters to their base Latin equivalents\n- Remove characters that don't have clear Latin alternatives\n- Preserve meaning while using only basic Latin alphabet\n\n---\n\n## üìã Required JSON Structure\n\n**Your output must match this exact structure:**\n```json\n{\n  \"meta_title\": \"string value here\",\n  \"handle\": \"string-value-here\",\n  \"meta_description\": \"string value here\",\n  \"featured_image_prompt\": \"string value here\",\n  \"featured_image_alt_text\": \"string value here\",\n  \"featured_image_title\": \"String Value Here\"\n}\n```\n\n**Critical JSON Requirements:**\n- ‚úÖ Exactly 6 fields (no more, no less)\n- ‚úÖ Field names must match exactly (case-sensitive)\n- ‚úÖ All values must be strings (in quotes)\n- ‚úÖ No nested objects or arrays\n- ‚úÖ No trailing comma after last field\n- ‚úÖ No markdown code blocks\n- ‚úÖ No text before or after JSON\n\n---\n\n## üöÄ Execute Now\n\n**Follow this exact sequence:**\n\n1. ‚úÖ Read the article provided by the user\n2. üß† **USE think_tool - CHECKPOINT 1** (analyze article)\n3. ‚úÖ Generate draft metadata for all 6 fields\n4. üß† **USE think_tool - CHECKPOINT 2** (review drafts)\n5. ‚úÖ Validate and adjust character/word counts\n6. üß† **USE think_tool - CHECKPOINT 3** (final content validation)\n7. ‚úÖ Format JSON with validated content\n8. üß† **USE think_tool - CHECKPOINT 4** (JSON structure validation)\n9. ‚úÖ Output ONLY the JSON (if all validations pass)\n\n**All 4 think_tool checkpoints are MANDATORY. Do not skip any.**\n\nRemember: Your output must follow the exact structured format.\n\n**Begin processing the article now.**",
          "maxIterations": 10
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        1616,
        1632
      ],
      "id": "f6fb1ec5-7e72-4db6-b585-014533c09542",
      "name": "Article Metadata Generator",
      "retryOnFail": true,
      "maxTries": 2
    },
    {
      "parameters": {
        "content": "## -> Metadata & Image",
        "height": 224,
        "width": 416,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1520,
        1568
      ],
      "id": "e233005c-1d1d-4da1-892f-b15d75848f1d",
      "name": "Sticky Note19"
    },
    {
      "parameters": {
        "operation": "resize",
        "width": 1200,
        "height": 628,
        "options": {
          "format": "webp"
        }
      },
      "type": "n8n-nodes-base.editImage",
      "typeVersion": 1,
      "position": [
        992,
        1888
      ],
      "id": "6585bdfb-f66b-4b7c-b9fc-46030c47a0db",
      "name": "Convert to WebP"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a8eb909e-3b28-401d-bb78-2f2fc680f582",
              "name": "Keyword Strategy",
              "value": "={{ $('Keyword Strategist').item.json.candidates[0].content.parts[0].text }}",
              "type": "string"
            },
            {
              "id": "c79d0ff0-5328-4138-a912-363f4a86a4cb",
              "name": "title",
              "value": "={{ $('Arrange by sections').item.json.title }}",
              "type": "string"
            },
            {
              "id": "9dc7f8fb-d8c0-4038-a44b-40bbd51254ad",
              "name": "meta_title",
              "value": "={{ $('Article Metadata Generator').item.json.output.meta_title }}",
              "type": "string"
            },
            {
              "id": "bf32a654-7883-43bf-af22-e62e7df8aa1e",
              "name": "meta_description",
              "value": "={{ $('Article Metadata Generator').item.json.output.meta_description }}",
              "type": "string"
            },
            {
              "id": "c8fa176f-f192-4ec4-b2ca-da3d25f1ea75",
              "name": "handle",
              "value": "={{ $('Article Metadata Generator').item.json.output.handle }}",
              "type": "string"
            },
            {
              "id": "7c6e83fc-8f23-427f-94de-34ae6ca6ff4a",
              "name": "link",
              "value": "={{ $('Create a post').item.json.link }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1632,
        1888
      ],
      "id": "2da22f0f-d30d-49de-b55b-80c8974842fa",
      "name": "Get WP Data"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6a8948d3-d068-4b48-bf56-953f22abbd5a",
              "name": "Topic Idea",
              "value": "={{ $('Filter Action').item.json.body.rowValues[0]['1'] }}",
              "type": "string"
            },
            {
              "id": "85506453-d69e-4a62-b671-f597d618ffd2",
              "name": "Title",
              "value": "={{ $('Filter Action').item.json.body.rowValues[0]['2'] }}",
              "type": "string"
            },
            {
              "id": "f019ba34-2141-45e1-b6e7-fe19ad3e3764",
              "name": "Description",
              "value": "={{ $('Filter Action').item.json.body.rowValues[0]['3'] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1504,
        336
      ],
      "id": "a86346b3-362a-43f1-ad65-cacfd75c7abc",
      "name": "Get Topic Data"
    },
    {
      "parameters": {
        "content": "## -> Generate Outline Doc",
        "height": 224,
        "width": 656,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        800,
        960
      ],
      "id": "3a7cd21a-8ccd-408f-b2f7-e7e71677a26b",
      "name": "Sticky Note71"
    },
    {
      "parameters": {
        "toolDescription": "AI Agent that is a specialist in EEAT.",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "=# EEAT Research Agent\n\nYou find and validate authoritative sources to enhance content credibility (EEAT: Experience, Expertise, Authoritativeness, Trustworthiness).\n\n## Context\n- Date: {{ $now.toFormat(\"dd LLLL yyyy\") }}\n- Client: {{ $('Get Business Data').item.json.client_name }}\n- Market: {{ $('Get Business Data').item.json.client_country }}\n- Language: {{ $('Get Business Data').item.json.client_language }}\n\n## Your Task\n\nWhen the Outline Creator sends you a research query, you must:\n\n1. **Call get_business_data first** - Understand client industry and context\n2. **Call get_eeat_citations** - Gets 5-10 pre-vetted authoritative sources relevant to the industry\n3. **Analyze the sources** - Review source types, authority levels, relevance topics, key data points\n4. **Call online_search** - Use this tool to find specific facts, statistics, or studies from these authoritative sources\n5. **Return structured results** - Provide citations with exact data points, URLs, and usage recommendations\n\n## Tools Execution Order\n\n**Step 1:** Call `get_business_data`\n- Extract: client_name, industry, client_country, client_language\n\n**Step 2:** Call `get_eeat_citations`\n- Returns: Pre-vetted sources (Government, Academic, Medical institutions)\n- Extract: URLs, source names, relevance topics, authority indicators\n\n**Step 3:** Call `online_search` with enhanced query\n- Input: User's query + source URLs/names from Step 2\n- Goal: Find specific facts, statistics, quotes, study results\n- Focus: Only use the authoritative sources from Step 2\n\n## Output Format\n\nReturn results in {{ $('Get Business Data').item.json.client_language }}:\n```\n**Sources Found: X**\n\n**1. [Source Title]**\n- **URL:** [complete link]\n- **Type:** [Government/Academic/Medical/Industry Authority]\n- **Authority:** [Why it's credible]\n- **Key Data:** [Specific statistic/study/fact]\n- **Usage:** [Where to cite in content - H2/H3 section]\n- **Recommended Citation:** \"[Exact text or paraphrase]\"\n\n**2. [Source Title]**\n[...repeat...]\n```\n\n## Critical Rules\n\n‚úÖ **Always:**\n- Call get_business_data FIRST\n- Call get_eeat_citations SECOND\n- Only cite sources from the pre-vetted list\n- Provide exact statistics/data points, not generalities\n- Include complete URLs\n- Write in {{ $('Get Business Data').item.json.client_language }}\n\n‚ùå **Never:**\n- Skip get_business_data or get_eeat_citations\n- Use competitor sources\n- Cite news sites, blogs, or commercial sites\n- Invent data or sources\n- Return results without specific facts/statistics\n\n## Example Query Flow\n\n**Input from Outline Creator:** \"Find studies about [topic] and [specific aspect]\"\n\n**Your Process:**\n1. Call get_business_data ‚Üí Understand industry context\n2. Call get_eeat_citations ‚Üí Get 8 authoritative sources\n3. Extract: Academic journals, government agencies, medical institutions\n4. Call online_search: \"[query] [source names or domains]\"\n5. Return: 3-5 sources with exact statistics, study results, and citation recommendations\n\n**Begin execution when you receive a research query.**"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        576,
        1408
      ],
      "id": "f537c57d-38f3-42f8-a944-cc8c115fac8e",
      "name": "eeat_agent"
    },
    {
      "parameters": {
        "content": "## -> First Article Draft",
        "height": 224,
        "width": 384,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        480,
        1568
      ],
      "id": "00309532-434b-4126-b3eb-af34a9386445",
      "name": "Sticky Note61"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1504,
        896
      ],
      "id": "a929905a-cf74-4e73-8835-f6b1312c82be",
      "name": "merge"
    },
    {
      "parameters": {
        "content": "`Keyword Strategist Tools`",
        "width": 976,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        480,
        528
      ],
      "id": "8c0a036d-0905-4a63-b429-496067265547",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "wa0kkSaygUdBVzcF",
          "mode": "list",
          "cachedResultName": "[-KR- Business Data]",
          "cachedResultUrl": "/projects/6s3sOILcGEL9TSZr/datatables/wa0kkSaygUdBVzcF"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "session_id",
              "keyValue": "={{ $('SessioN Data üëÄ').first().json['Business Data Session ID'] }}"
            }
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTableTool",
      "typeVersion": 1,
      "position": [
        848,
        1232
      ],
      "id": "b033661a-30f4-42e9-b9d8-8d973f7f2e4a",
      "name": "get_business_data"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "ZnsklgmGZiqdWGjq",
          "mode": "list",
          "cachedResultName": "Internal Links",
          "cachedResultUrl": "/projects/6s3sOILcGEL9TSZr/datatables/ZnsklgmGZiqdWGjq"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "session_id",
              "keyValue": "={{ $('SessioN Data üëÄ').item.json['Internal Links Session ID'] }}"
            }
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTableTool",
      "typeVersion": 1,
      "position": [
        528,
        1232
      ],
      "id": "36f4354f-19ba-4ebd-bb96-98ea0af1da04",
      "name": "get_internal_Links"
    },
    {
      "parameters": {
        "content": "`Outline Creator Tools`",
        "width": 608,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        480,
        1200
      ],
      "id": "2dc5d1d5-7f58-4ba1-a6a7-a3035b5aa7ad",
      "name": "Sticky Note62"
    },
    {
      "parameters": {
        "content": "`EEAT sub-agent and his Tools`",
        "width": 608,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        480,
        1376
      ],
      "id": "df0fc322-6e64-4bef-b589-87f3177f526c",
      "name": "Sticky Note66"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1rWyiIdQh_rWtiSYdJm4qNvc1LqduTdaJbBu6sXXzmzM",
          "mode": "list",
          "cachedResultName": "Rankenstein v9 Dashboard",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rWyiIdQh_rWtiSYdJm4qNvc1LqduTdaJbBu6sXXzmzM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1328152878,
          "mode": "list",
          "cachedResultName": "Wordpress Content",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rWyiIdQh_rWtiSYdJm4qNvc1LqduTdaJbBu6sXXzmzM/edit#gid=1328152878"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Title": "={{ $('Get Topic Data').first().json.Title }}",
            "Keyword Research": "=https://drive.google.com/uc?export=download&id={{ $json.id }}"
          },
          "matchingColumns": [
            "Title"
          ],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Topic input",
              "displayName": "Topic input",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Title",
              "displayName": "Title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Description",
              "displayName": "Description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Keyword Research",
              "displayName": "Keyword Research",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Outline",
              "displayName": "Outline",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Wordpress Draft Link",
              "displayName": "Wordpress Draft Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1312,
        768
      ],
      "id": "f0d381b1-a01b-4b94-964b-bd3741a64bcd",
      "name": "Research Link",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "LLp60YlJOI8qZKgK",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1rWyiIdQh_rWtiSYdJm4qNvc1LqduTdaJbBu6sXXzmzM",
          "mode": "list",
          "cachedResultName": "Rankenstein v9 Dashboard",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rWyiIdQh_rWtiSYdJm4qNvc1LqduTdaJbBu6sXXzmzM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1328152878,
          "mode": "list",
          "cachedResultName": "Wordpress Content",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rWyiIdQh_rWtiSYdJm4qNvc1LqduTdaJbBu6sXXzmzM/edit#gid=1328152878"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Title": "={{ $('Get Topic Data').first().json.Title }}",
            "row_number": 0,
            "Outline": "=https://drive.google.com/uc?export=download&id={{ $json.id }}"
          },
          "matchingColumns": [
            "Title"
          ],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Topic input",
              "displayName": "Topic input",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Title",
              "displayName": "Title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Description",
              "displayName": "Description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Keyword Research",
              "displayName": "Keyword Research",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Outline",
              "displayName": "Outline",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Wordpress Draft Link",
              "displayName": "Wordpress Draft Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1312,
        1024
      ],
      "id": "e0238f03-3579-4d7d-b78d-b207601c7ec4",
      "name": "Outline Link",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "LLp60YlJOI8qZKgK",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $('Outline Creator').item.json.candidates[0].content.parts[0].text }}"
            }
          ]
        },
        "simplify": false,
        "options": {
          "systemMessage": "=# **Content Writer Agent**\n\nYou are an Expert Content Writer creating top-ranking, EEAT-compliant articles.\n\n**Context:**\n- Client: {{ $('Get Business Data').item.json.client_name }}\n- Market: {{ $('Get Business Data').item.json.client_country }}\n- Language: {{ $('Get Business Data').item.json.client_language }}\n- Date: {{ $now.toFormat(\"dd LLLL yyyy\") }}\n\n---\n\n## ‚ö†Ô∏è BEFORE YOU START: Use think_tool for Checkpoint 1\n\n**Parse the outline first, then use think_tool to verify you understand everything.**\n\n---\n\n## üéØ Your Mission\n\nTransform the outline into a publication-ready article that:\n1. **Follows outline exactly** - Structure, keywords, citations, elements\n2. **Hits keyword targets** - Place primary keyword exact phrase the EXACT number of times specified\n3. **Qualifies ALL claims** - No absolute language anywhere\n4. **Engages readers** - Natural, helpful, trustworthy writing\n\n---\n\n## üî¥ Critical Rules\n\n### Rule 1: The Outline is Law\n- Every paragraph in outline = one paragraph in article\n- Every keyword placement = exact placement in article\n- Every citation = properly integrated with hyperlink\n- Every table/list/box = created as specified\n- **Never add, skip, or reorganize**\n\n### Rule 2: Primary Keyword - Hit the Target Exactly\n\n**The outline specifies EXACT locations for primary keyword. Use them ALL.**\n\n**Counting rules:**\n- ‚úÖ Count ONLY if the exact phrase appears exactly as written\n- ‚ùå Do NOT count if words are split, reversed, or modified\n- ‚ùå Do NOT count grammatical variations\n\n**If outline says \"6-8 placements\" at specific locations, place it in ALL those locations.**\n\n### Rule 3: EEAT Safety Net - Zero Tolerance for Absolutes\n\n**Scan EVERY sentence. Transform absolute language immediately:**\n\n| ‚ùå NEVER Use | ‚úÖ ALWAYS Use Instead |\n|-------------|----------------------|\n| \"proves\" / \"proven\" | \"research suggests\" / \"studies indicate\" |\n| \"confirms\" / \"confirmed\" | \"demonstrates\" / \"shows\" |\n| \"guarantees\" / \"guaranteed\" | \"may help\" / \"can contribute to\" |\n| \"is responsible for\" | \"plays a role in\" / \"contributes to\" |\n| \"directly responsible\" | \"contributes significantly\" / \"plays a key role\" |\n| \"ideal\" / \"perfect\" | \"well-suited\" / \"effective\" |\n| \"the best\" | \"an effective\" / \"a proven approach\" |\n| \"eliminates\" | \"may reduce\" / \"helps reduce\" |\n| \"causes\" | \"is associated with\" / \"may contribute to\" |\n| \"will result in\" | \"may lead to\" / \"can contribute to\" |\n| \"always\" | \"often\" / \"typically\" |\n\n**Add qualifications:**\n- After ALL benefit claims: \"Results may vary individually\"\n- After ALL statistics: Include study context\n- Keep tone confident but qualified\n\n### Rule 4: Citations = Context + Hyperlink\n\n**Every citation needs ALL of these:**\n- Study type (meta-analysis, RCT, clinical trial, review, etc.)\n- Sample size OR duration OR year (minimum one)\n- Hyperlink to URL from outline\n\n**Good format:**\n- \"A [2023 meta-analysis](URL) of 1,200 participants found...[1]\"\n- \"In a [randomized controlled trial](URL) over 12 weeks, researchers observed...[2]\"\n\n**Bad format:**\n- \"Studies show...[1]\"\n\n### Rule 5: Answer-First Where Specified\n\n**From outline, identify where answer-first is required:**\n- **Key Takeaway Box:** First sentence = main answer + primary keyword\n- **H2 Sections:** First paragraph starts with direct answer\n- **H3 Subsections:** First sentence is direct answer\n- **FAQ:** Bold direct answer first (50-75 words total)\n\n### Rule 6: think_tool - 3 Checkpoints MANDATORY\n\n1. **After parsing outline** - Verify understanding\n2. **At 50% completion** - Quality check + keyword count\n3. **Before output** - Final verification + keyword count\n\n---\n\n## üìã Workflow\n\n### Step 1: Parse the Outline\n\n**Extract from the user's outline:**\n- H1, target word count, language\n- Primary keyword: exact phrase + maximum placement count + EXACT locations from keyword map\n- All H2/H3 titles, paragraph counts\n- All EEAT elements with specifications\n- All citations with URLs\n- All content elements (tables, lists, images)\n- All internal links (anchor, URL, placement)\n- Answer-first requirements\n- Writing guidance per section\n\n---\n\n### Step 2: CHECKPOINT 1 - Use think_tool NOW\n\nüß† **Call think_tool with:**\n```\nCHECKPOINT 1 - OUTLINE PARSED:\n\nCLIENT & CONTEXT:\n- Client: {{ $('Get Business Data').item.json.client_name }}\n- Market: {{ $('Get Business Data').item.json.client_country }}\n- Language: {{ $('Get Business Data').item.json.client_language }}\n\nARTICLE SPECS:\n- H1: [exact title]\n- Target words: [count]\n- Primary keyword: \"[exact phrase]\"\n- Primary keyword TARGET: [X] placements (from outline)\n\nPRIMARY KEYWORD LOCATIONS (from outline's keyword placement map):\n[CRITICAL: List EVERY location where outline specifies placement]\n1. [Location 1 - e.g., \"Key Takeaway Box - first sentence\"]\n2. [Location 2 - e.g., \"Introduction paragraph 1\"]\n3. [Location 3 - e.g., \"H2 section title - paragraph 1\"]\n4. [Location 4 - e.g., \"Conclusion paragraph 1\"]\n[Continue for ALL placements specified in outline]\n\nTOTAL REQUIRED: [X] placements - MUST place in ALL these locations\n\nSTRUCTURE:\n- H2 sections: [count] - [list all titles]\n- H3 subsections: [count] - [list all titles]\n- Total paragraphs: [count]\n- FAQ: [count] questions\n\nEEAT ELEMENTS:\n- Key Takeaway Box: [specs]\n- Author box: [content]\n- Transparency box: [content]\n- Callouts: [count and locations]\n\nCITATIONS: [count] - all have URLs\n\nCONTENT ELEMENTS (CANNOT SKIP):\n- Tables: [count] - [list each with location]\n- Lists: [count] - [list each with location]\n- Images: [count] - [list placements]\n\nINTERNAL LINKS: [count] - [list each]\n\nEEAT SAFETY NET:\nWill scan and qualify: \"proves\", \"confirms\", \"guarantees\", \"is responsible for\",\n\"ideal\", \"perfect\", \"best\", \"eliminates\", \"causes\", \"always\", \"will\", etc.\n\nWRITING PLAN:\n1. Write following outline exactly\n2. Place primary keyword in ALL [X] designated locations\n3. Qualify ALL absolute language automatically\n4. Integrate citations with full context + hyperlinks\n5. Create ALL tables/lists/boxes\n6. Write naturally and engagingly\n7. Use Checkpoint 2 at 50%\n8. Use Checkpoint 3 before output\n\nSTATUS: ‚úÖ READY TO WRITE\n\nCRITICAL: Must hit [X] primary keyword placements exactly\n```\n\n---\n\n### Step 3: Write the Article\n\n**Follow outline structure exactly:**\n```markdown\n# [H1 from outline]\n\n> **üîë Key Takeaway**\n>\n> [First sentence MUST include primary keyword exact phrase + direct answer]\n>\n> [Bullets as outline specifies]\n\n[Introduction - follow outline specs]\n\n---\n> **üë§ [Author box from outline]**\n---\n> **‚ÑπÔ∏è [Transparency box from outline]**\n---\n\n## [H2 from outline]\n\n[Paragraphs per outline:\n- Word count per outline\n- Answer-first if required\n- Keywords where specified\n- Citations with context + hyperlink\n- QUALIFY all absolutes]\n\n[Tables/lists/callouts where specified]\n\n### [H3 from outline]\n\n[Continue following outline]\n\n## [FAQ from outline]\n\n### [Question 1]\n\n**[Bold direct answer].** [Context]. [Example]. [Qualification if needed].\n\n[50-75 words total]\n\n[Continue all FAQ]\n\n## [Conclusion]\n\n[Follow outline - include primary keyword if specified]\n\n---\n\n## References\n\n[All references with URLs]\n```\n\n**As you write, constantly check:**\n- ‚úÖ Is this sentence absolute? ‚Üí Qualify it\n- ‚úÖ Did I place primary keyword in designated location? ‚Üí Track it\n- ‚úÖ Does this citation have context + hyperlink? ‚Üí Add them\n- ‚úÖ Natural, engaging tone? ‚Üí Keep it helpful\n\n---\n\n### Step 4: CHECKPOINT 2 - Use think_tool at 50%\n\nüß† **When ~50% complete, call think_tool:**\n```\nCHECKPOINT 2 - MIDPOINT CHECK:\n\nPROGRESS: [X] of [Y] paragraphs (~50% complete)\n\nOUTLINE ADHERENCE:\n‚úì Following structure exactly: [YES/NO]\n‚úì All titles match: [YES/NO]\n‚úì Word counts on target: [YES/NO]\n\nPRIMARY KEYWORD EXACT PHRASE - CRITICAL CHECK:\n‚úì Exact phrase: \"[phrase]\"\n‚úì TARGET from outline: [X] placements in designated locations\n‚úì CURRENT COUNT: [X] of [X] target\n‚úì Placements used so far:\n  1. [Location] - \"[show context]\" ‚úì exact phrase verified\n  2. [Location] - \"[show context]\" ‚úì exact phrase verified\n  [List all used]\n‚úì REMAINING LOCATIONS NEEDED: [list locations still to use]\n‚úì STATUS: [‚úÖ ON TRACK to hit [X] / ‚ö†Ô∏è BEHIND - need [X] more]\n\nEEAT SAFETY NET - ACTIVE SCAN:\n‚úì Absolute words found and transformed: [X] instances\n  Examples:\n  - \"[absolute]\" ‚Üí \"[qualified version]\"\n  - \"[absolute]\" ‚Üí \"[qualified version]\"\n‚úì Remaining absolutes: [NONE / ‚ùå FOUND: list them]\n‚úì All benefit claims have disclaimers: [YES/NO]\n\nCITATIONS:\n‚úì So far: [X] of [Y] - all have context + hyperlinks: [YES/NO]\n\nEEAT ELEMENTS:\n‚úì Key Takeaway: [DONE] - exact phrase in first sentence: [YES/NO]\n‚úì Author/Transparency boxes: [DONE/PENDING]\n\nCONTENT ELEMENTS:\n‚úì Tables: [X] of [Y]\n‚úì Lists: [X] of [Y]\n\nQUALITY:\n‚úì Engaging tone: [YES/NO]\n‚úì Natural flow: [YES/NO]\n\nNEXT: Complete remaining 50%, hit ALL remaining keyword locations\n\nSTATUS: [‚úÖ ON TRACK / ‚ö†Ô∏è NEEDS ATTENTION]\n```\n\n---\n\n### Step 5: Complete Article\n\n**Finish all remaining sections, ensuring:**\n- Primary keyword placed in ALL remaining designated locations\n- All absolute language qualified\n- All content elements created\n- All internal links placed\n\n---\n\n### Step 6: CHECKPOINT 3 - Use think_tool Before Output\n\nüß† **Before outputting, call think_tool:**\n```\nCHECKPOINT 3 - FINAL VERIFICATION:\n\nSTRUCTURE:\n‚úì Paragraphs: [X] / [X outline] = [‚úÖ MATCH / ‚ùå MISMATCH]\n‚úì All H2/H3 match: [YES/NO]\n‚úì Nothing added/skipped: [YES/NO]\n\nPRIMARY KEYWORD - FINAL COUNT (CRITICAL):\n‚úì Exact phrase: \"[phrase]\"\n‚úì TARGET from outline: [X] placements in [X] designated locations\n‚úì FINAL COUNT: [X] placements\n‚úì ALL OCCURRENCES VERIFIED:\n  1. [Location] - \"[context]\" ‚úì exact phrase\n  2. [Location] - \"[context]\" ‚úì exact phrase\n  3. [Location] - \"[context]\" ‚úì exact phrase\n  [List ALL - verify each is exact, not split/modified]\n‚úì ALL DESIGNATED LOCATIONS USED: [‚úÖ YES / ‚ùå NO - missing: list]\n‚úì STATUS: [‚úÖ HIT TARGET EXACTLY / ‚ùå UNDER/OVER]\n‚úì ACTION: [‚úÖ APPROVED / ‚ùå MUST ADD TO: locations]\n\nEEAT - FINAL SCAN (ZERO TOLERANCE):\n‚úì Absolute language scan for:\n  \"proves\", \"proven\", \"confirms\", \"confirmed\", \"guarantees\", \"guaranteed\",\n  \"is responsible for\", \"directly responsible\", \"ideal\", \"perfect\", \n  \"the best\", \"eliminates\", \"causes\", \"will result\", \"always\"\n‚úì Found and unqualified: [NONE / ‚ùå LIST EACH]\n‚úì If any remain: MUST qualify before output\n‚úì All benefit claims have disclaimers: [YES/NO]\n\nANSWER-FIRST:\n‚úì Key Takeaway: Exact phrase in first sentence: [YES/NO]\n‚úì All H2/H3: Answer-first where required: [YES/NO]\n‚úì All FAQ: Bold direct answer, 50-75 words: [YES/NO]\n\nEEAT ELEMENTS:\n‚úì All boxes present: Key Takeaway ‚úì, Author ‚úì, Transparency ‚úì, Callouts [X] of [X] ‚úì\n‚úì All use blockquote format: [YES/NO]\n\nCITATIONS:\n‚úì Total: [X] / [X outline] = [MATCH/MISMATCH]\n‚úì All have: study type + (sample/year/duration) + hyperlink: [YES/NO]\n‚úì Reference list complete: [YES/NO]\n\nCONTENT ELEMENTS:\n‚úì Tables: [X] of [X] at correct locations\n‚úì Lists: [X] of [X] at correct locations\n‚úì All created: [‚úÖ YES / ‚ùå NO - missing: list]\n\nINTERNAL LINKS:\n‚úì Total: [X] / [X outline] = [MATCH/MISMATCH]\n‚úì All natural integration: [YES/NO]\n\nOUTPUT READY:\n‚úì Clean markdown: [YES/NO]\n‚úì No think_tool text in body: [YES/NO]\n‚úì No placeholders: [YES/NO]\n‚úì Publication-ready: [YES/NO]\n\nCHECKPOINTS:\n‚úì Checkpoint 1: ‚úÖ DONE\n‚úì Checkpoint 2: ‚úÖ DONE\n‚úì Checkpoint 3: ‚úÖ COMPLETING NOW\n\nCRITICAL ISSUES: [NONE / ‚ùå LIST]\n\nFINAL STATUS: [‚úÖ READY TO OUTPUT / ‚ùå FIX ISSUES FIRST]\n```\n\n**If ‚ùå: Fix all issues then output**\n**If ‚úÖ: Output clean article**\n\n---\n\n### Step 7: Output Clean Article\n\n**Output ONLY:**\n```markdown\n# [H1]\n\n[Complete article]\n\n---\n\n## References\n\n[All references with URLs]\n```\n\n**NO think_tool text, NO meta, NO notes, NO placeholders**\n\n---\n\n## üö´ Never Do\n\n- ‚ùå Skip think_tool checkpoints\n- ‚ùå Miss ANY designated primary keyword location\n- ‚ùå Use absolute language (proves, guarantees, etc.)\n- ‚ùå Cite without context + hyperlink\n- ‚ùå Skip content elements\n- ‚ùå Add/skip paragraphs\n- ‚ùå Include checkpoint text in output\n\n## ‚úÖ Always Do\n\n- ‚úÖ Use all 3 think_tool checkpoints\n- ‚úÖ Place primary keyword in EVERY designated location from outline\n- ‚úÖ Qualify EVERY absolute word in ANY language\n- ‚úÖ Add context + hyperlink to EVERY citation\n- ‚úÖ Create ALL tables/lists/boxes\n- ‚úÖ Write naturally and helpfully\n- ‚úÖ Answer-first where required\n- ‚úÖ Output clean markdown only\n\n---\n\n## üìä Success Checklist\n\n**Before output, verify:**\n- [ ] Used all 3 think_tool checkpoints\n- [ ] Primary keyword: [X] placements in ALL designated locations ‚úÖ\n- [ ] ZERO absolute language remaining ‚úÖ\n- [ ] ALL citations have context + hyperlinks ‚úÖ\n- [ ] ALL content elements created ‚úÖ\n- [ ] Engaging, natural writing ‚úÖ\n- [ ] Clean markdown output ‚úÖ\n\n**Result:** 9.5+/10 top-ranking article that readers trust and search engines reward.",
          "maxOutputTokens": 30000,
          "temperature": 0.6,
          "maxToolsIterations": 40
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        512,
        1632
      ],
      "id": "4ae42e54-37a7-4efa-b00f-bd7c5973d8e9",
      "name": "Content Creator",
      "retryOnFail": true,
      "maxTries": 2,
      "credentials": {
        "googlePalmApi": {
          "id": "8eDMUtP7P20s67XX",
          "name": "Gemini API 10/10/2025"
        }
      }
    },
    {
      "parameters": {
        "description": "This tool provides the keywords that the client's page is ranking for.",
        "workflowId": {
          "__rl": true,
          "value": "yDmk0mHvY4VD8NMa",
          "mode": "list",
          "cachedResultUrl": "/workflow/yDmk0mHvY4VD8NMa",
          "cachedResultName": "Laboratory ‚Äî Part 0 - Tools"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "function": "get_business_ranked_keywords",
            "location_code": "={{ $('SessioN Data üëÄ').first().json.location_code }}",
            "language_code": "={{ $('SessioN Data üëÄ').first().json.language_code }}",
            "keyword": "={{ $('SessioN Data üëÄ').first().json['Business Data Session ID'] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "function",
              "displayName": "function",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "keyword",
              "displayName": "keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "location_code",
              "displayName": "location_code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "language_code",
              "displayName": "language_code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        688,
        1232
      ],
      "id": "12b3875a-1709-41f6-bc22-89a106572b6b",
      "name": "get_business_ranked_keywords"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        992,
        1232
      ],
      "id": "b7c41c3d-603d-4f49-9ce0-6d6e3a37787d",
      "name": "think_tool"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        1344,
        560
      ],
      "id": "6a8d1763-bed2-4e46-85d4-d4e9131f61c2",
      "name": "Think_tool"
    },
    {
      "parameters": {
        "description": "=This tool provides keyword data for specified keyword.  ",
        "workflowId": {
          "__rl": true,
          "value": "yDmk0mHvY4VD8NMa",
          "mode": "list",
          "cachedResultUrl": "/workflow/yDmk0mHvY4VD8NMa",
          "cachedResultName": "Laboratory ‚Äî Part 0 - Tools"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "function": "keyword_overview",
            "location_code": "={{ $('SessioN Data üëÄ').first().json.location_code }}",
            "language_code": "={{ $('SessioN Data üëÄ').first().json.language_code }}",
            "keyword": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('keyword', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "function",
              "displayName": "function",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "keyword",
              "displayName": "keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "location_code",
              "displayName": "location_code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "language_code",
              "displayName": "language_code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        880,
        560
      ],
      "id": "37d539d8-e1a5-4c40-9887-256993792551",
      "name": "keyword_overview"
    },
    {
      "parameters": {
        "jsCode": "// Get the markdown content from the input\nconst markdownContent = $input.item.json.first_draft;\n\nif (!markdownContent) {\n  throw new Error('No markdown content found in first_draft field.');\n}\n\n// Split content into lines for processing\nconst lines = markdownContent.split('\\n');\n\nlet title = '';\nlet introduction = [];\nlet body = [];\nlet tableOfContents = [];\nlet inIntroduction = false;\nlet inBody = false;\n\nfor (let i = 0; i < lines.length; i++) {\n  const line = lines[i];\n  const trimmedLine = line.trim();\n  \n  // ========================================\n  // 1. EXTRACT TITLE (H1)\n  // ========================================\n  if (trimmedLine.startsWith('# ') && !title) {\n    // Extract title and remove H1 marker\n    title = trimmedLine.replace(/^#\\s+/, '').trim();\n    \n    // Remove special symbols: backticks, asterisks, underscores, pipes, etc.\n    title = title\n      .replace(/`/g, '')           // Remove backticks\n      .replace(/\\*/g, '')          // Remove asterisks\n      .replace(/_/g, '')           // Remove underscores\n      .replace(/\\|/g, '')          // Remove pipes\n      .replace(/\\[|\\]/g, '')       // Remove brackets\n      .replace(/\\(|\\)/g, '')       // Remove parentheses\n      .replace(/~/g, '')           // Remove tildes\n      .replace(/\\\\/g, '')          // Remove backslashes\n      .trim();\n    \n    inIntroduction = true; // Start capturing introduction\n    continue;\n  }\n  \n  // ========================================\n  // 2. DETECT FIRST H2 (Start of Body)\n  // ========================================\n  if (trimmedLine.startsWith('## ')) {\n    inIntroduction = false;\n    inBody = true;\n    \n    // Extract H2 heading for table of contents (clean it too)\n    let heading = trimmedLine.replace(/^##\\s+/, '').trim();\n    \n    // Remove markdown formatting from TOC entries\n    heading = heading\n      .replace(/\\*\\*/g, '')        // Remove bold\n      .replace(/\\*/g, '')          // Remove italic\n      .replace(/`/g, '')           // Remove code\n      .replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, '$1'); // Remove links, keep text\n    \n    tableOfContents.push(heading);\n  }\n  \n  // ========================================\n  // 3. CAPTURE INTRODUCTION\n  // ========================================\n  if (inIntroduction && !inBody) {\n    // Include all content after title and before first H2\n    // This includes: Key Takeaway, paragraphs, EEAT boxes, etc.\n    introduction.push(line);\n  }\n  \n  // ========================================\n  // 4. CAPTURE BODY\n  // ========================================\n  if (inBody) {\n    body.push(line);\n  }\n}\n\n// ========================================\n// 5. CLEAN UP AND JOIN\n// ========================================\n\n// Join arrays back into strings\nlet introductionText = introduction.join('\\n').trim();\nlet bodyText = body.join('\\n').trim();\n\n// Remove excessive empty lines (more than 2 consecutive)\nintroductionText = introductionText.replace(/\\n{3,}/g, '\\n\\n');\nbodyText = bodyText.replace(/\\n{3,}/g, '\\n\\n');\n\n// ========================================\n// 6. VALIDATION & FALLBACKS\n// ========================================\n\n// If no title found, try to extract from first non-empty line\nif (!title && lines.length > 0) {\n  title = lines.find(line => line.trim().length > 0)?.trim() || 'Untitled';\n  title = title.replace(/^#*\\s*/, '').replace(/`/g, '').trim();\n}\n\n// If no introduction found, use empty string\nif (!introductionText) {\n  introductionText = '';\n}\n\n// If no body found, use remaining content after introduction\nif (!bodyText && markdownContent.includes('##')) {\n  const firstH2Index = markdownContent.indexOf('##');\n  bodyText = markdownContent.substring(firstH2Index).trim();\n} else if (!bodyText) {\n  bodyText = '';\n}\n\n// If no TOC, try to extract all H2s from body\nif (tableOfContents.length === 0 && bodyText) {\n  const h2Regex = /^##\\s+(.+)$/gm;\n  let match;\n  while ((match = h2Regex.exec(bodyText)) !== null) {\n    let heading = match[1].trim()\n      .replace(/\\*\\*/g, '')\n      .replace(/\\*/g, '')\n      .replace(/`/g, '');\n    tableOfContents.push(heading);\n  }\n}\n\n// ========================================\n// 7. RETURN STRUCTURED DATA\n// ========================================\n\nreturn {\n  json: {\n    title: title,\n    introduction: introductionText,\n    table_of_contents: tableOfContents,\n    body: bodyText,\n    \n    // Optional metadata for debugging/verification\n    metadata: {\n      title_length: title.length,\n      introduction_length: introductionText.length,\n      body_length: bodyText.length,\n      toc_count: tableOfContents.length,\n      has_title: !!title,\n      has_introduction: !!introductionText,\n      has_body: !!bodyText\n    }\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1056,
        1632
      ],
      "id": "fed788fe-694f-41c3-a0cf-2a4acc055483",
      "name": "Arrange by sections"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7a578290-bc84-46fa-a0f5-ee5172103dfd",
              "name": "first_draft",
              "value": "={{ $json.candidates[0].content.parts[0].text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        912,
        1632
      ],
      "id": "ea679837-308e-4623-bd9c-5f73ad79eae6",
      "name": "Get First Draft"
    },
    {
      "parameters": {
        "content": "## -> ",
        "height": 224,
        "width": 320,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        880,
        1568
      ],
      "id": "bfd465e1-bb7b-439e-913f-f8d54821e69f",
      "name": "Sticky Note67"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "615f0f58-d1ae-4a70-a523-b97532182114",
              "name": "markdown",
              "value": "={{ $json.candidates[0].content.parts[0].text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        832,
        768
      ],
      "id": "75d4bf8e-7f3e-4316-b05a-c221d0564cee",
      "name": "Get Research"
    },
    {
      "parameters": {
        "jsCode": "// ========================================\n// COMPLETE N8N FUNCTION NODE CODE\n// Copy everything from here down into your n8n Function node\n// ========================================\n\n/**\n * Markdown to HTML Converter\n */\nfunction markdownToHtml(markdown) {\n  let html = markdown;\n\n  // Convert tables\n  html = convertTables(html);\n\n  // Convert headers (H1-H6)\n  html = html.replace(/^######\\s+(.+)$/gm, '<h6>$1</h6>');\n  html = html.replace(/^#####\\s+(.+)$/gm, '<h5>$1</h5>');\n  html = html.replace(/^####\\s+(.+)$/gm, '<h4>$1</h4>');\n  html = html.replace(/^###\\s+(.+)$/gm, '<h3>$1</h3>');\n  html = html.replace(/^##\\s+(.+)$/gm, '<h2>$1</h2>');\n  html = html.replace(/^#\\s+(.+)$/gm, '<h1>$1</h1>');\n\n  // Convert horizontal rules\n  html = html.replace(/^---$/gm, '<hr>');\n\n  // Convert bold text\n  html = html.replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>');\n  html = html.replace(/__(.+?)__/g, '<strong>$1</strong>');\n\n  // Convert italic text\n  html = html.replace(/\\*(.+?)\\*/g, '<em>$1</em>');\n  html = html.replace(/_(.+?)_/g, '<em>$1</em>');\n\n  // Convert inline code\n  html = html.replace(/`([^`]+)`/g, '<code>$1</code>');\n\n  // Convert links\n  html = html.replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\">$1</a>');\n\n  // Convert unordered lists\n  html = convertUnorderedLists(html);\n\n  // Convert ordered lists\n  html = convertOrderedLists(html);\n\n  // Convert checkboxes\n  html = html.replace(/^\\s*-\\s+\\[x\\]\\s+(.+)$/gm, '<li class=\"checked\">‚úì $1</li>');\n  html = html.replace(/^\\s*-\\s+\\[\\s\\]\\s+(.+)$/gm, '<li class=\"unchecked\">‚òê $1</li>');\n\n  // Convert paragraphs\n  html = convertParagraphs(html);\n\n  return wrapInDocument(html);\n}\n\nfunction convertTables(text) {\n  const lines = text.split('\\n');\n  let result = [];\n  let i = 0;\n  \n  while (i < lines.length) {\n    const line = lines[i];\n    \n    // Check if this line looks like a table header\n    if (line.trim().startsWith('|') && line.trim().endsWith('|')) {\n      // Check if next line is a separator\n      if (i + 1 < lines.length && lines[i + 1].match(/^\\|[\\s\\-:]+\\|/)) {\n        // This is a table!\n        const headers = line.trim().split('|').filter(cell => cell.trim()).map(h => h.trim());\n        i += 2; // Skip header and separator\n        \n        let tableHtml = '<table>\\n<thead>\\n<tr>\\n';\n        headers.forEach(h => {\n          tableHtml += `<th>${h}</th>\\n`;\n        });\n        tableHtml += '</tr>\\n</thead>\\n<tbody>\\n';\n        \n        // Get all table rows\n        while (i < lines.length && lines[i].trim().startsWith('|') && lines[i].trim().endsWith('|')) {\n          const cells = lines[i].trim().split('|').filter(cell => cell.trim()).map(c => c.trim());\n          tableHtml += '<tr>\\n';\n          cells.forEach(cell => {\n            tableHtml += `<td>${cell}</td>\\n`;\n          });\n          tableHtml += '</tr>\\n';\n          i++;\n        }\n        \n        tableHtml += '</tbody>\\n</table>\\n';\n        result.push(tableHtml);\n        continue;\n      }\n    }\n    \n    result.push(line);\n    i++;\n  }\n  \n  return result.join('\\n');\n}\n\nfunction convertUnorderedLists(text) {\n  const lines = text.split('\\n');\n  let result = [];\n  let inList = false;\n  let listLevel = 0;\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const match = line.match(/^(\\s*)-\\s+(.+)$/);\n\n    if (match) {\n      const indent = match[1].length;\n      const content = match[2];\n      const currentLevel = Math.floor(indent / 2);\n\n      if (!inList) {\n        result.push('<ul>');\n        inList = true;\n        listLevel = currentLevel;\n      } else if (currentLevel > listLevel) {\n        result.push('<ul>');\n        listLevel = currentLevel;\n      } else if (currentLevel < listLevel) {\n        for (let j = 0; j < listLevel - currentLevel; j++) {\n          result.push('</ul>');\n        }\n        listLevel = currentLevel;\n      }\n\n      result.push(`<li>${content}</li>`);\n    } else {\n      if (inList) {\n        for (let j = 0; j <= listLevel; j++) {\n          result.push('</ul>');\n        }\n        inList = false;\n        listLevel = 0;\n      }\n      result.push(line);\n    }\n  }\n\n  if (inList) {\n    for (let j = 0; j <= listLevel; j++) {\n      result.push('</ul>');\n    }\n  }\n\n  return result.join('\\n');\n}\n\nfunction convertOrderedLists(text) {\n  const lines = text.split('\\n');\n  let result = [];\n  let inList = false;\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const match = line.match(/^\\d+\\.\\s+(.+)$/);\n\n    if (match) {\n      if (!inList) {\n        result.push('<ol>');\n        inList = true;\n      }\n      result.push(`<li>${match[1]}</li>`);\n    } else {\n      if (inList) {\n        result.push('</ol>');\n        inList = false;\n      }\n      result.push(line);\n    }\n  }\n\n  if (inList) {\n    result.push('</ol>');\n  }\n\n  return result.join('\\n');\n}\n\nfunction convertParagraphs(text) {\n  const lines = text.split('\\n');\n  let result = [];\n  let paragraph = [];\n\n  for (let line of lines) {\n    if (line.match(/^\\s*<[^>]+>/)) {\n      if (paragraph.length > 0) {\n        result.push(`<p>${paragraph.join(' ')}</p>`);\n        paragraph = [];\n      }\n      result.push(line);\n    } else if (line.trim() === '') {\n      if (paragraph.length > 0) {\n        result.push(`<p>${paragraph.join(' ')}</p>`);\n        paragraph = [];\n      }\n      result.push('');\n    } else {\n      paragraph.push(line.trim());\n    }\n  }\n\n  if (paragraph.length > 0) {\n    result.push(`<p>${paragraph.join(' ')}</p>`);\n  }\n\n  return result.join('\\n');\n}\n\nfunction wrapInDocument(content) {\n  return `<!DOCTYPE html>\n<html lang=\"ro\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Keyword Research Strategy Report</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans\", Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n            font-size: 16px;\n            line-height: 1.5;\n            color: #1f2328;\n            background-color: #ffffff;\n            padding: 20px;\n        }\n        \n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n            background-color: #ffffff;\n            padding: 40px;\n        }\n        \n        /* Headings */\n        h1, h2, h3, h4, h5, h6 {\n            margin-top: 24px;\n            margin-bottom: 16px;\n            font-weight: 600;\n            line-height: 1.25;\n            color: #1f2328;\n        }\n        \n        h1 {\n            font-size: 2em;\n            margin-top: 0;\n            padding-bottom: 0.3em;\n            border-bottom: 1px solid #d1d9e0b3;\n        }\n        \n        h2 {\n            font-size: 1.5em;\n            padding-bottom: 0.3em;\n            border-bottom: 1px solid #d1d9e0b3;\n        }\n        \n        h3 {\n            font-size: 1.25em;\n        }\n        \n        h4 {\n            font-size: 1em;\n        }\n        \n        h5 {\n            font-size: 0.875em;\n        }\n        \n        h6 {\n            font-size: 0.85em;\n            color: #59636e;\n        }\n        \n        /* Paragraphs */\n        p {\n            margin-top: 0;\n            margin-bottom: 16px;\n            line-height: 1.5;\n        }\n        \n        /* Lists */\n        ul, ol {\n            margin-top: 0;\n            margin-bottom: 16px;\n            padding-left: 2em;\n        }\n        \n        li {\n            margin-top: 0.25em;\n        }\n        \n        li.checked {\n            color: #27ae60;\n            list-style-type: none;\n            margin-left: -1.25em;\n        }\n        \n        li.unchecked {\n            color: #59636e;\n            list-style-type: none;\n            margin-left: -1.25em;\n        }\n        \n        /* Tables */\n        table {\n            width: 100%;\n            border-collapse: collapse;\n            border-spacing: 0;\n            margin-top: 0;\n            margin-bottom: 16px;\n            display: block;\n            overflow: auto;\n        }\n        \n        thead {\n            display: table-header-group;\n            vertical-align: middle;\n        }\n        \n        tbody {\n            display: table-row-group;\n            vertical-align: middle;\n        }\n        \n        tr {\n            background-color: #ffffff;\n            border-top: 1px solid #d1d9e0;\n        }\n        \n        tr:nth-child(2n) {\n            background-color: #f6f8fa;\n        }\n        \n        th, td {\n            padding: 6px 13px;\n            border: 1px solid #d1d9e0;\n        }\n        \n        th {\n            font-weight: 600;\n            background-color: #f6f8fa;\n            text-align: left;\n        }\n        \n        /* Code */\n        code {\n            padding: 0.2em 0.4em;\n            margin: 0;\n            font-size: 85%;\n            background-color: rgba(175, 184, 193, 0.2);\n            border-radius: 6px;\n            font-family: ui-monospace, SFMono-Regular, \"SF Mono\", Menlo, Consolas, \"Liberation Mono\", monospace;\n        }\n        \n        /* Text formatting */\n        strong {\n            font-weight: 600;\n        }\n        \n        em {\n            font-style: italic;\n        }\n        \n        /* Links */\n        a {\n            color: #0969da;\n            text-decoration: none;\n        }\n        \n        a:hover {\n            text-decoration: underline;\n        }\n        \n        /* Horizontal rule */\n        hr {\n            height: 0.25em;\n            padding: 0;\n            margin: 24px 0;\n            background-color: #d1d9e0;\n            border: 0;\n        }\n        \n        /* Responsive design */\n        @media print {\n            body {\n                background-color: white;\n                padding: 0;\n            }\n            .container {\n                padding: 20px;\n            }\n        }\n        \n        @media (max-width: 768px) {\n            .container {\n                padding: 20px;\n            }\n            h1 {\n                font-size: 1.75em;\n            }\n            h2 {\n                font-size: 1.375em;\n            }\n            table {\n                font-size: 0.9em;\n            }\n            th, td {\n                padding: 4px 8px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        ${content}\n    </div>\n</body>\n</html>`;\n}\n\n// ========================================\n// N8N EXECUTION CODE - THIS RUNS IN N8N\n// ========================================\n\n// Get markdown from input item\n// Change 'markdown' to your actual field name if different\nconst markdown = $input.item.json.markdown;\n\n// Convert to HTML\nconst html = markdownToHtml(markdown);\n\n// Return as array of items (n8n format)\nreturn [{ \n  json: { \n    html: html,\n    original_markdown: markdown // optional: keep original\n  } \n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        992,
        768
      ],
      "id": "24994143-83a7-498a-a26c-ffe8caa27732",
      "name": "HTML",
      "alwaysOutputData": false,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "createFromText",
        "content": "={{ $json.html }}",
        "name": "=Keyword Research - {{ $('Update Processing').item.json.Title }}.html",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lrO0o56kQ1npPIwpbFc3WzllUWj95svX",
          "mode": "list",
          "cachedResultName": "n8n test",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1lrO0o56kQ1npPIwpbFc3WzllUWj95svX"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1152,
        768
      ],
      "id": "3ac82c75-cbb5-46bb-8fce-f4f2d7f93054",
      "name": "Create Research",
      "alwaysOutputData": false,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "qn45t4z4EfLyo25D",
          "name": "InovAI Account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "615f0f58-d1ae-4a70-a523-b97532182114",
              "name": "markdown",
              "value": "={{ $json.candidates[0].content.parts[0].text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        832,
        1024
      ],
      "id": "7b100a71-e5c4-4e65-99b8-91cddb7f039c",
      "name": "Get Outline"
    },
    {
      "parameters": {
        "jsCode": "// ========================================\n// COMPLETE N8N FUNCTION NODE CODE\n// Copy everything from here down into your n8n Function node\n// ========================================\n\n/**\n * Markdown to HTML Converter\n */\nfunction markdownToHtml(markdown) {\n  let html = markdown;\n\n  // Convert tables\n  html = convertTables(html);\n\n  // Convert headers (H1-H6)\n  html = html.replace(/^######\\s+(.+)$/gm, '<h6>$1</h6>');\n  html = html.replace(/^#####\\s+(.+)$/gm, '<h5>$1</h5>');\n  html = html.replace(/^####\\s+(.+)$/gm, '<h4>$1</h4>');\n  html = html.replace(/^###\\s+(.+)$/gm, '<h3>$1</h3>');\n  html = html.replace(/^##\\s+(.+)$/gm, '<h2>$1</h2>');\n  html = html.replace(/^#\\s+(.+)$/gm, '<h1>$1</h1>');\n\n  // Convert horizontal rules\n  html = html.replace(/^---$/gm, '<hr>');\n\n  // Convert bold text\n  html = html.replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>');\n  html = html.replace(/__(.+?)__/g, '<strong>$1</strong>');\n\n  // Convert italic text\n  html = html.replace(/\\*(.+?)\\*/g, '<em>$1</em>');\n  html = html.replace(/_(.+?)_/g, '<em>$1</em>');\n\n  // Convert inline code\n  html = html.replace(/`([^`]+)`/g, '<code>$1</code>');\n\n  // Convert links\n  html = html.replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\">$1</a>');\n\n  // Convert unordered lists\n  html = convertUnorderedLists(html);\n\n  // Convert ordered lists\n  html = convertOrderedLists(html);\n\n  // Convert checkboxes\n  html = html.replace(/^\\s*-\\s+\\[x\\]\\s+(.+)$/gm, '<li class=\"checked\">‚úì $1</li>');\n  html = html.replace(/^\\s*-\\s+\\[\\s\\]\\s+(.+)$/gm, '<li class=\"unchecked\">‚òê $1</li>');\n\n  // Convert paragraphs\n  html = convertParagraphs(html);\n\n  return wrapInDocument(html);\n}\n\nfunction convertTables(text) {\n  const lines = text.split('\\n');\n  let result = [];\n  let i = 0;\n  \n  while (i < lines.length) {\n    const line = lines[i];\n    \n    // Check if this line looks like a table header\n    if (line.trim().startsWith('|') && line.trim().endsWith('|')) {\n      // Check if next line is a separator\n      if (i + 1 < lines.length && lines[i + 1].match(/^\\|[\\s\\-:]+\\|/)) {\n        // This is a table!\n        const headers = line.trim().split('|').filter(cell => cell.trim()).map(h => h.trim());\n        i += 2; // Skip header and separator\n        \n        let tableHtml = '<table>\\n<thead>\\n<tr>\\n';\n        headers.forEach(h => {\n          tableHtml += `<th>${h}</th>\\n`;\n        });\n        tableHtml += '</tr>\\n</thead>\\n<tbody>\\n';\n        \n        // Get all table rows\n        while (i < lines.length && lines[i].trim().startsWith('|') && lines[i].trim().endsWith('|')) {\n          const cells = lines[i].trim().split('|').filter(cell => cell.trim()).map(c => c.trim());\n          tableHtml += '<tr>\\n';\n          cells.forEach(cell => {\n            tableHtml += `<td>${cell}</td>\\n`;\n          });\n          tableHtml += '</tr>\\n';\n          i++;\n        }\n        \n        tableHtml += '</tbody>\\n</table>\\n';\n        result.push(tableHtml);\n        continue;\n      }\n    }\n    \n    result.push(line);\n    i++;\n  }\n  \n  return result.join('\\n');\n}\n\nfunction convertUnorderedLists(text) {\n  const lines = text.split('\\n');\n  let result = [];\n  let inList = false;\n  let listLevel = 0;\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const match = line.match(/^(\\s*)-\\s+(.+)$/);\n\n    if (match) {\n      const indent = match[1].length;\n      const content = match[2];\n      const currentLevel = Math.floor(indent / 2);\n\n      if (!inList) {\n        result.push('<ul>');\n        inList = true;\n        listLevel = currentLevel;\n      } else if (currentLevel > listLevel) {\n        result.push('<ul>');\n        listLevel = currentLevel;\n      } else if (currentLevel < listLevel) {\n        for (let j = 0; j < listLevel - currentLevel; j++) {\n          result.push('</ul>');\n        }\n        listLevel = currentLevel;\n      }\n\n      result.push(`<li>${content}</li>`);\n    } else {\n      if (inList) {\n        for (let j = 0; j <= listLevel; j++) {\n          result.push('</ul>');\n        }\n        inList = false;\n        listLevel = 0;\n      }\n      result.push(line);\n    }\n  }\n\n  if (inList) {\n    for (let j = 0; j <= listLevel; j++) {\n      result.push('</ul>');\n    }\n  }\n\n  return result.join('\\n');\n}\n\nfunction convertOrderedLists(text) {\n  const lines = text.split('\\n');\n  let result = [];\n  let inList = false;\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const match = line.match(/^\\d+\\.\\s+(.+)$/);\n\n    if (match) {\n      if (!inList) {\n        result.push('<ol>');\n        inList = true;\n      }\n      result.push(`<li>${match[1]}</li>`);\n    } else {\n      if (inList) {\n        result.push('</ol>');\n        inList = false;\n      }\n      result.push(line);\n    }\n  }\n\n  if (inList) {\n    result.push('</ol>');\n  }\n\n  return result.join('\\n');\n}\n\nfunction convertParagraphs(text) {\n  const lines = text.split('\\n');\n  let result = [];\n  let paragraph = [];\n\n  for (let line of lines) {\n    if (line.match(/^\\s*<[^>]+>/)) {\n      if (paragraph.length > 0) {\n        result.push(`<p>${paragraph.join(' ')}</p>`);\n        paragraph = [];\n      }\n      result.push(line);\n    } else if (line.trim() === '') {\n      if (paragraph.length > 0) {\n        result.push(`<p>${paragraph.join(' ')}</p>`);\n        paragraph = [];\n      }\n      result.push('');\n    } else {\n      paragraph.push(line.trim());\n    }\n  }\n\n  if (paragraph.length > 0) {\n    result.push(`<p>${paragraph.join(' ')}</p>`);\n  }\n\n  return result.join('\\n');\n}\n\nfunction wrapInDocument(content) {\n  return `<!DOCTYPE html>\n<html lang=\"ro\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Keyword Research Strategy Report</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans\", Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n            font-size: 16px;\n            line-height: 1.5;\n            color: #1f2328;\n            background-color: #ffffff;\n            padding: 20px;\n        }\n        \n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n            background-color: #ffffff;\n            padding: 40px;\n        }\n        \n        /* Headings */\n        h1, h2, h3, h4, h5, h6 {\n            margin-top: 24px;\n            margin-bottom: 16px;\n            font-weight: 600;\n            line-height: 1.25;\n            color: #1f2328;\n        }\n        \n        h1 {\n            font-size: 2em;\n            margin-top: 0;\n            padding-bottom: 0.3em;\n            border-bottom: 1px solid #d1d9e0b3;\n        }\n        \n        h2 {\n            font-size: 1.5em;\n            padding-bottom: 0.3em;\n            border-bottom: 1px solid #d1d9e0b3;\n        }\n        \n        h3 {\n            font-size: 1.25em;\n        }\n        \n        h4 {\n            font-size: 1em;\n        }\n        \n        h5 {\n            font-size: 0.875em;\n        }\n        \n        h6 {\n            font-size: 0.85em;\n            color: #59636e;\n        }\n        \n        /* Paragraphs */\n        p {\n            margin-top: 0;\n            margin-bottom: 16px;\n            line-height: 1.5;\n        }\n        \n        /* Lists */\n        ul, ol {\n            margin-top: 0;\n            margin-bottom: 16px;\n            padding-left: 2em;\n        }\n        \n        li {\n            margin-top: 0.25em;\n        }\n        \n        li.checked {\n            color: #27ae60;\n            list-style-type: none;\n            margin-left: -1.25em;\n        }\n        \n        li.unchecked {\n            color: #59636e;\n            list-style-type: none;\n            margin-left: -1.25em;\n        }\n        \n        /* Tables */\n        table {\n            width: 100%;\n            border-collapse: collapse;\n            border-spacing: 0;\n            margin-top: 0;\n            margin-bottom: 16px;\n            display: block;\n            overflow: auto;\n        }\n        \n        thead {\n            display: table-header-group;\n            vertical-align: middle;\n        }\n        \n        tbody {\n            display: table-row-group;\n            vertical-align: middle;\n        }\n        \n        tr {\n            background-color: #ffffff;\n            border-top: 1px solid #d1d9e0;\n        }\n        \n        tr:nth-child(2n) {\n            background-color: #f6f8fa;\n        }\n        \n        th, td {\n            padding: 6px 13px;\n            border: 1px solid #d1d9e0;\n        }\n        \n        th {\n            font-weight: 600;\n            background-color: #f6f8fa;\n            text-align: left;\n        }\n        \n        /* Code */\n        code {\n            padding: 0.2em 0.4em;\n            margin: 0;\n            font-size: 85%;\n            background-color: rgba(175, 184, 193, 0.2);\n            border-radius: 6px;\n            font-family: ui-monospace, SFMono-Regular, \"SF Mono\", Menlo, Consolas, \"Liberation Mono\", monospace;\n        }\n        \n        /* Text formatting */\n        strong {\n            font-weight: 600;\n        }\n        \n        em {\n            font-style: italic;\n        }\n        \n        /* Links */\n        a {\n            color: #0969da;\n            text-decoration: none;\n        }\n        \n        a:hover {\n            text-decoration: underline;\n        }\n        \n        /* Horizontal rule */\n        hr {\n            height: 0.25em;\n            padding: 0;\n            margin: 24px 0;\n            background-color: #d1d9e0;\n            border: 0;\n        }\n        \n        /* Responsive design */\n        @media print {\n            body {\n                background-color: white;\n                padding: 0;\n            }\n            .container {\n                padding: 20px;\n            }\n        }\n        \n        @media (max-width: 768px) {\n            .container {\n                padding: 20px;\n            }\n            h1 {\n                font-size: 1.75em;\n            }\n            h2 {\n                font-size: 1.375em;\n            }\n            table {\n                font-size: 0.9em;\n            }\n            th, td {\n                padding: 4px 8px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        ${content}\n    </div>\n</body>\n</html>`;\n}\n\n// ========================================\n// N8N EXECUTION CODE - THIS RUNS IN N8N\n// ========================================\n\n// Get markdown from input item\n// Change 'markdown' to your actual field name if different\nconst markdown = $input.item.json.markdown;\n\n// Convert to HTML\nconst html = markdownToHtml(markdown);\n\n// Return as array of items (n8n format)\nreturn [{ \n  json: { \n    html: html,\n    original_markdown: markdown // optional: keep original\n  } \n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        992,
        1024
      ],
      "id": "bdbad99d-89a8-470e-a470-f89a9ce4030e",
      "name": "html",
      "alwaysOutputData": false,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "createFromText",
        "content": "={{ $json.html }}",
        "name": "=Outline - {{ $('Update Processing').item.json.Title }}.html",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lrO0o56kQ1npPIwpbFc3WzllUWj95svX",
          "mode": "list",
          "cachedResultName": "n8n test",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1lrO0o56kQ1npPIwpbFc3WzllUWj95svX"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1152,
        1024
      ],
      "id": "33e2a6ea-bb25-4fcb-9866-8b722894eb96",
      "name": "Create Outline",
      "alwaysOutputData": false,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "qn45t4z4EfLyo25D",
          "name": "InovAI Account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1520,
        1376
      ],
      "id": "beac14fc-508d-4a5c-aa70-179ea71646be",
      "name": "<-"
    },
    {
      "parameters": {
        "content": "",
        "width": 160,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1488,
        1360
      ],
      "id": "cdf730df-ef87-4c99-9f8d-5756ee9e160c",
      "name": "Sticky Note72"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        752,
        1632
      ],
      "id": "3ef3266c-e8e8-4360-97a5-e0ae3bb6222d",
      "name": "Think_Tool"
    },
    {
      "parameters": {
        "content": "### **`get_businesss_data`** tool Inputs:\n* Function: `Get`\n* Must Match: `All Conditions`\n* session_id: `{{ $('SessioN Data üëÄ').first().json['Business Data Session ID'] }}`",
        "height": 128,
        "width": 432,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1904,
        384
      ],
      "id": "60eb0b3e-aa1f-4ae5-a93c-afa1713d73a5",
      "name": "Sticky Note30"
    },
    {
      "parameters": {
        "content": "![n8n Creator Profile](https://pub-a17d2fc7266e4743b378a51308926c96.r2.dev/Screenshot%202025-11-02%20160206.png)",
        "height": 128,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1664,
        384
      ],
      "id": "1370a004-6155-4f70-b578-12e5ae11e2a1",
      "name": "Sticky Note36"
    },
    {
      "parameters": {
        "content": "![n8n Creator Profile](https://pub-a17d2fc7266e4743b378a51308926c96.r2.dev/Screenshot%202025-11-02%20160306.png)",
        "height": 128,
        "width": 272,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2352,
        672
      ],
      "id": "c78363ae-58c1-4172-8d02-778456556b5a",
      "name": "Sticky Note37"
    },
    {
      "parameters": {
        "content": "### **`Get_business_ranked_keywords`** Sub-Workflow Tool Input\n * function: `get_business_ranked_keywords`\n* keyword: `{{ $('SSessioN Data üìç').first().json['Business Data Session ID'] }}`\n* location_code: `{{ $('SessioN Data üìç').first().json.location_code }}`\n* language_code: `{{ $('SessioN Data üìç').first().json.language_code }}`",
        "height": 128,
        "width": 656,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2624,
        672
      ],
      "id": "8cb00398-163a-4057-947e-71fab8dab7f6",
      "name": "Sticky Note31"
    },
    {
      "parameters": {
        "content": "![n8n Creator Profile](https://pub-a17d2fc7266e4743b378a51308926c96.r2.dev/Screenshot%202025-11-02%20160655.png)",
        "height": 128,
        "width": 272,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1488,
        528
      ],
      "id": "24791408-3048-4521-a3ea-371eaf310f1e",
      "name": "Sticky Note39"
    },
    {
      "parameters": {
        "content": "### **`keyword_overview`** Sub-Workflow Tool Input\n* function: `keyword_overview`\n* keyword: Defined automatically by the model\n* location_code: `{{ $('SessioN Data üìç').first().json.location_code }}`\n* language_code: `{{ $('SessioN Data üìç').first().json.language_code }}`",
        "height": 128,
        "width": 576,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1760,
        528
      ],
      "id": "4877250a-0c59-4050-9089-792c34e2980a",
      "name": "Sticky Note32"
    },
    {
      "parameters": {
        "content": "### **`serp_search`** Sub-Workflow Tool Input\n* function: `serp_search`\n* keyword: Defined automatically by the model\n* location_code: `{{ $('SessioN Data üìç').item.json.location_code }}`\n* language_code: `{{ $('SessioN Data üìç').item.json.language_code }}`",
        "height": 128,
        "width": 576,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1760,
        672
      ],
      "id": "e58328b5-56c4-49be-af0a-73133f68fd9f",
      "name": "Sticky Note24"
    },
    {
      "parameters": {
        "content": "![n8n Creator Profile](https://pub-a17d2fc7266e4743b378a51308926c96.r2.dev/Screenshot%202025-11-02%20160945.png)",
        "height": 128,
        "width": 272,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1488,
        672
      ],
      "id": "8b01fd39-6438-4c4e-b6bf-1bbf6a848601",
      "name": "Sticky Note40"
    },
    {
      "parameters": {
        "content": "![n8n Creator Profile](https://pub-a17d2fc7266e4743b378a51308926c96.r2.dev/Screenshot%202025-11-02%20161100.png)",
        "height": 128,
        "width": 272,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2352,
        528
      ],
      "id": "92aff6a9-ad07-4bd0-96f4-1123961c88a8",
      "name": "Sticky Note41"
    },
    {
      "parameters": {
        "content": "### **`suggested_keyworus`** Sub-Workflow Tool Input\n* function: `suggested_keywords`\n* keyword: Defined automatically by the model\n* location_code: `{{ $('SessioN Data üìç').first().json.location_code }}`\n* language_code: `{{ $('SessioN Data üìç').first().json.language_code }}`",
        "height": 128,
        "width": 576,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2624,
        528
      ],
      "id": "9673eadd-e01f-4ffb-9f8a-fb2cffb7f678",
      "name": "Sticky Note42"
    },
    {
      "parameters": {
        "content": "### **`get_internal_Links`** Tool Inputs:\n* Operation: `Get`\n* Data table: `Internal Links`\n* session_id: `{{ $('SessioN Data üëÄ').item.json['Internal Links Session ID'] }}`",
        "height": 112,
        "width": 640,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1776,
        1088
      ],
      "id": "366cdcce-2935-48eb-a727-ffb6e82c6462",
      "name": "Sticky Note45"
    },
    {
      "parameters": {
        "content": "![n8n Creator Profile](https://pub-a17d2fc7266e4743b378a51308926c96.r2.dev/Screenshot%202025-11-02%20161748.png)",
        "height": 112,
        "width": 272,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1504,
        1088
      ],
      "id": "eb106869-16e8-4265-b9d6-f8513166da4d",
      "name": "Sticky Note46"
    },
    {
      "parameters": {
        "content": "![n8n Creator Profile](https://pub-a17d2fc7266e4743b378a51308926c96.r2.dev/Screenshot%202025-11-02%20161940.png)",
        "height": 128,
        "width": 272,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1504,
        1216
      ],
      "id": "4b5832d1-d42d-4951-a389-a92be4fdd193",
      "name": "Sticky Note47"
    },
    {
      "parameters": {
        "content": "### **`get_business_ranked_keywords`** Sub-Workflow Tool Input\n* function: `get_business_ranked_keywords`\n* keyword: `{{ $('SessioN Data üìç').first().json['Business Data Session ID'] }}`\n* location_code: `{{ $('SessioN Data üìç').first().json.location_code }}`\n* language_code: `{{ $('SessioN Data üìç').first().json.language_code }}`",
        "height": 128,
        "width": 640,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1776,
        1216
      ],
      "id": "27f26856-9741-4a74-a5db-24a7e00e5ad1",
      "name": "Sticky Note48"
    },
    {
      "parameters": {
        "content": "![n8n Creator Profile](https://pub-a17d2fc7266e4743b378a51308926c96.r2.dev/Screenshot%202025-11-02%20162155.png)",
        "height": 112,
        "width": 272,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2432,
        1088
      ],
      "id": "45787c15-595a-45e4-b037-02a0be5b764b",
      "name": "Sticky Note49"
    },
    {
      "parameters": {
        "content": "### **`get_business_data`** Tool Inputs:\n* Operation: `Get`\n* Data table: `[Business Data]`\n* session_id: `{{ $('SessioN Data üëÄ').first().json['Business Data Session ID'] }}`",
        "height": 112,
        "width": 656,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2704,
        1088
      ],
      "id": "be200d0f-1190-4d5d-a205-eadb59e6a29a",
      "name": "Sticky Note50"
    },
    {
      "parameters": {
        "content": "![n8n Creator Profile](https://pub-a17d2fc7266e4743b378a51308926c96.r2.dev/Screenshot%202025-11-02%20162339.png)",
        "height": 128,
        "width": 272,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2432,
        1216
      ],
      "id": "194b58ef-b1d9-4382-a6ab-5b8b01ea686e",
      "name": "Sticky Note51"
    },
    {
      "parameters": {
        "content": "### **`get_eeat_citaions`** Tool Inputs:\n* Operation: `Get`\n* Data table: `EEAT Citations`\n* Must Match: `Any Condition`\n* session_id: `{{ $('SessioN Data üëÄ').first().json['Business Data Session ID'] }}`",
        "height": 128,
        "width": 656,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2704,
        1216
      ],
      "id": "313cd543-4bab-4aaf-9bd3-eafcad0f2f4e",
      "name": "Sticky Note52"
    },
    {
      "parameters": {
        "content": "`Make sure you set up the tools correctly, check the images and text for reference, make adjustments if needed`",
        "height": 80,
        "width": 336,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1664,
        288
      ],
      "id": "65c4a870-2a8c-47a3-b1f1-28a7f5113d2c",
      "name": "Sticky Note17"
    },
    {
      "parameters": {
        "content": "![n8n Creator Profile](https://pub-70c57f6d49284d1da8650039c2add836.r2.dev/ai%20marketing%20hub.png)",
        "height": 176,
        "width": 272,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1152,
        1232
      ],
      "id": "8f6cd1db-f4aa-440e-896a-9379cc9d4000",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "content": "**Workflow created by [@AgriciDaniel](https://www.youtube.com/@AgriciDaniel)**\n* [AI Marketing Hub](https://www.skool.com/ai-marketing-hub)\n* [AI Marketing Hub Pro](https://www.skool.com/ai-marketing-hub-pro)",
        "height": 96,
        "width": 272,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1152,
        1392
      ],
      "id": "6df9bfd2-df81-4b03-94de-885054f4c386",
      "name": "Sticky Note11"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        1840,
        1648
      ],
      "id": "e6b28acc-51f7-449c-a386-6949e05fbffa",
      "name": "Think"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"meta_title\": \"string value here\",\n  \"handle\": \"string-value-here\",\n  \"meta_description\": \"string value here\",\n  \"featured_image_prompt\": \"string value here\",\n  \"featured_image_alt_text\": \"string value here\",\n  \"featured_image_title\": \"String Value Here\"\n}",
        "autoFix": true,
        "customizeRetryPrompt": true,
        "prompt": "Instructions:\n--------------\n{instructions}\n--------------\nCompletion:\n--------------\n{completion}\n--------------\n\nAbove, the Completion did not satisfy the constraints given in the Instructions.\n\nError:\n--------------\n{error}\n--------------\n\nCRITICAL ISSUES IDENTIFIED:\n\n1. **Output Format Violation**: Your response did not match the required JSON structure specified in the instructions.\n\n2. **Common Problems to Fix**:\n   - Remove ALL text before and after the JSON object\n   - Remove markdown code block markers (``` or ```json)\n   - Remove explanatory text or comments\n   - Ensure valid JSON syntax (proper quotes, commas, brackets)\n   - Include ALL required fields from the structure\n   - Do NOT add extra fields not in the specification\n\n3. **Validation Checklist**:\n   ‚úì Is this PURE JSON with no other text?\n   ‚úì Does it match the EXACT structure required?\n   ‚úì Are all field names spelled correctly?\n   ‚úì Are all arrays and objects properly closed?\n   ‚úì Are strings in double quotes?\n   ‚úì Is there no trailing comma after the last item?\n\n4. **Required Actions**:\n   - Return ONLY the JSON object\n   - Start with { and end with }\n   - No markdown formatting\n   - No explanations\n   - No comments\n   - Just pure, valid JSON\n\nPlease try again. Please only respond with an answer that satisfies the constraints laid out in the Instructions. Return ONLY the required JSON structure with no additional text:"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        1616,
        1728
      ],
      "id": "ad82b710-2cc5-411d-9c84-fe7fcbdf4e2c",
      "name": "Output"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1rWyiIdQh_rWtiSYdJm4qNvc1LqduTdaJbBu6sXXzmzM",
          "mode": "list",
          "cachedResultName": "WordPress Content Engine v2",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rWyiIdQh_rWtiSYdJm4qNvc1LqduTdaJbBu6sXXzmzM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1328152878,
          "mode": "list",
          "cachedResultName": "Wordpress Content",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rWyiIdQh_rWtiSYdJm4qNvc1LqduTdaJbBu6sXXzmzM/edit#gid=1328152878"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Title": "={{ $('Get Topic Data').first().json.Title }}",
            "Wordpress Draft Link": "={{ $('Get WP Data').item.json.link }}",
            "Status": "Completed"
          },
          "matchingColumns": [
            "Title"
          ],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Topic input",
              "displayName": "Topic input",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Title",
              "displayName": "Title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Description",
              "displayName": "Description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Keyword Research",
              "displayName": "Keyword Research",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Outline",
              "displayName": "Outline",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Wordpress Draft Link",
              "displayName": "Wordpress Draft Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1792,
        1888
      ],
      "id": "10690ba8-8222-4b88-a80a-0398e2fa6194",
      "name": "Insert Blog Data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "LLp60YlJOI8qZKgK",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.errorTrigger",
      "typeVersion": 1,
      "position": [
        544,
        2128
      ],
      "id": "f42b5c9a-9f42-4a4e-bee6-e16366af4e83",
      "name": "Error Trigger"
    },
    {
      "parameters": {
        "sendTo": "example@gmail.com",
        "subject": "n8n - Error occured in Rankenstein v9 - Part 2 - Content Creation",
        "emailType": "text",
        "message": "Check it ASAP",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        752,
        2128
      ],
      "id": "509d32fb-9045-4f83-8832-2c769d5d269f",
      "name": "Send a message",
      "webhookId": "73a11999-705b-49c1-b234-b60b3327099e",
      "credentials": {
        "gmailOAuth2": {
          "id": "aangs07AC0IQryBR",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "content": "## In case error happens, we get notified",
        "height": 240,
        "width": 464,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        480,
        2064
      ],
      "id": "68353835-8389-4c7e-9b9c-6ee5a55189fe",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "claude-sonnet-4-5-20250929",
          "cachedResultName": "Claude Sonnet 4.5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        1536,
        1648
      ],
      "id": "a802422a-b9e8-4b5e-9e83-db0f7e7a0fc6",
      "name": "sonnet4.5",
      "credentials": {
        "anthropicApi": {
          "id": "Vth1RbYCGxq3gK4G",
          "name": "10-17-2025"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "615f0f58-d1ae-4a70-a523-b97532182114",
              "name": "markdown",
              "value": "={{ $json.candidates[0].content.parts[0].text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1040,
        2128
      ],
      "id": "73915831-6387-4ec2-a131-e228e06206e9",
      "name": "Get Article"
    },
    {
      "parameters": {
        "operation": "createFromText",
        "content": "={{ $json.html }}",
        "name": "=Article - {{ $('Update Processing').item.json.Title }}.html",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lrO0o56kQ1npPIwpbFc3WzllUWj95svX",
          "mode": "list",
          "cachedResultName": "n8n test",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1lrO0o56kQ1npPIwpbFc3WzllUWj95svX"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1360,
        2128
      ],
      "id": "0df61bcb-d9a8-44d3-b95b-7f2aeb095690",
      "name": "Create Article",
      "alwaysOutputData": false,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "qn45t4z4EfLyo25D",
          "name": "InovAI Account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "content": "### In case you want the article as html and not wordpress",
        "height": 240,
        "width": 608,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        976,
        2064
      ],
      "id": "b6d480f9-1ea6-4982-bb23-e2fcfef18a20",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "jsCode": "// ========================================\n// COMPLETE N8N FUNCTION NODE CODE\n// Copy everything from here down into your n8n Function node\n// ========================================\n\n/**\n * Markdown to HTML Converter\n */\nfunction markdownToHtml(markdown) {\n  let html = markdown;\n\n  // Convert tables\n  html = convertTables(html);\n\n  // Convert headers (H1-H6)\n  html = html.replace(/^######\\s+(.+)$/gm, '<h6>$1</h6>');\n  html = html.replace(/^#####\\s+(.+)$/gm, '<h5>$1</h5>');\n  html = html.replace(/^####\\s+(.+)$/gm, '<h4>$1</h4>');\n  html = html.replace(/^###\\s+(.+)$/gm, '<h3>$1</h3>');\n  html = html.replace(/^##\\s+(.+)$/gm, '<h2>$1</h2>');\n  html = html.replace(/^#\\s+(.+)$/gm, '<h1>$1</h1>');\n\n  // Convert horizontal rules\n  html = html.replace(/^---$/gm, '<hr>');\n\n  // Convert bold text\n  html = html.replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>');\n  html = html.replace(/__(.+?)__/g, '<strong>$1</strong>');\n\n  // Convert italic text\n  html = html.replace(/\\*(.+?)\\*/g, '<em>$1</em>');\n  html = html.replace(/_(.+?)_/g, '<em>$1</em>');\n\n  // Convert inline code\n  html = html.replace(/`([^`]+)`/g, '<code>$1</code>');\n\n  // Convert links\n  html = html.replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\">$1</a>');\n\n  // Convert unordered lists\n  html = convertUnorderedLists(html);\n\n  // Convert ordered lists\n  html = convertOrderedLists(html);\n\n  // Convert checkboxes\n  html = html.replace(/^\\s*-\\s+\\[x\\]\\s+(.+)$/gm, '<li class=\"checked\">‚úì $1</li>');\n  html = html.replace(/^\\s*-\\s+\\[\\s\\]\\s+(.+)$/gm, '<li class=\"unchecked\">‚òê $1</li>');\n\n  // Convert paragraphs\n  html = convertParagraphs(html);\n\n  return wrapInDocument(html);\n}\n\nfunction convertTables(text) {\n  const lines = text.split('\\n');\n  let result = [];\n  let i = 0;\n  \n  while (i < lines.length) {\n    const line = lines[i];\n    \n    // Check if this line looks like a table header\n    if (line.trim().startsWith('|') && line.trim().endsWith('|')) {\n      // Check if next line is a separator\n      if (i + 1 < lines.length && lines[i + 1].match(/^\\|[\\s\\-:]+\\|/)) {\n        // This is a table!\n        const headers = line.trim().split('|').filter(cell => cell.trim()).map(h => h.trim());\n        i += 2; // Skip header and separator\n        \n        let tableHtml = '<table>\\n<thead>\\n<tr>\\n';\n        headers.forEach(h => {\n          tableHtml += `<th>${h}</th>\\n`;\n        });\n        tableHtml += '</tr>\\n</thead>\\n<tbody>\\n';\n        \n        // Get all table rows\n        while (i < lines.length && lines[i].trim().startsWith('|') && lines[i].trim().endsWith('|')) {\n          const cells = lines[i].trim().split('|').filter(cell => cell.trim()).map(c => c.trim());\n          tableHtml += '<tr>\\n';\n          cells.forEach(cell => {\n            tableHtml += `<td>${cell}</td>\\n`;\n          });\n          tableHtml += '</tr>\\n';\n          i++;\n        }\n        \n        tableHtml += '</tbody>\\n</table>\\n';\n        result.push(tableHtml);\n        continue;\n      }\n    }\n    \n    result.push(line);\n    i++;\n  }\n  \n  return result.join('\\n');\n}\n\nfunction convertUnorderedLists(text) {\n  const lines = text.split('\\n');\n  let result = [];\n  let inList = false;\n  let listLevel = 0;\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const match = line.match(/^(\\s*)-\\s+(.+)$/);\n\n    if (match) {\n      const indent = match[1].length;\n      const content = match[2];\n      const currentLevel = Math.floor(indent / 2);\n\n      if (!inList) {\n        result.push('<ul>');\n        inList = true;\n        listLevel = currentLevel;\n      } else if (currentLevel > listLevel) {\n        result.push('<ul>');\n        listLevel = currentLevel;\n      } else if (currentLevel < listLevel) {\n        for (let j = 0; j < listLevel - currentLevel; j++) {\n          result.push('</ul>');\n        }\n        listLevel = currentLevel;\n      }\n\n      result.push(`<li>${content}</li>`);\n    } else {\n      if (inList) {\n        for (let j = 0; j <= listLevel; j++) {\n          result.push('</ul>');\n        }\n        inList = false;\n        listLevel = 0;\n      }\n      result.push(line);\n    }\n  }\n\n  if (inList) {\n    for (let j = 0; j <= listLevel; j++) {\n      result.push('</ul>');\n    }\n  }\n\n  return result.join('\\n');\n}\n\nfunction convertOrderedLists(text) {\n  const lines = text.split('\\n');\n  let result = [];\n  let inList = false;\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const match = line.match(/^\\d+\\.\\s+(.+)$/);\n\n    if (match) {\n      if (!inList) {\n        result.push('<ol>');\n        inList = true;\n      }\n      result.push(`<li>${match[1]}</li>`);\n    } else {\n      if (inList) {\n        result.push('</ol>');\n        inList = false;\n      }\n      result.push(line);\n    }\n  }\n\n  if (inList) {\n    result.push('</ol>');\n  }\n\n  return result.join('\\n');\n}\n\nfunction convertParagraphs(text) {\n  const lines = text.split('\\n');\n  let result = [];\n  let paragraph = [];\n\n  for (let line of lines) {\n    if (line.match(/^\\s*<[^>]+>/)) {\n      if (paragraph.length > 0) {\n        result.push(`<p>${paragraph.join(' ')}</p>`);\n        paragraph = [];\n      }\n      result.push(line);\n    } else if (line.trim() === '') {\n      if (paragraph.length > 0) {\n        result.push(`<p>${paragraph.join(' ')}</p>`);\n        paragraph = [];\n      }\n      result.push('');\n    } else {\n      paragraph.push(line.trim());\n    }\n  }\n\n  if (paragraph.length > 0) {\n    result.push(`<p>${paragraph.join(' ')}</p>`);\n  }\n\n  return result.join('\\n');\n}\n\nfunction wrapInDocument(content) {\n  return `<!DOCTYPE html>\n<html lang=\"ro\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Keyword Research Strategy Report</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans\", Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n            font-size: 16px;\n            line-height: 1.5;\n            color: #1f2328;\n            background-color: #ffffff;\n            padding: 20px;\n        }\n        \n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n            background-color: #ffffff;\n            padding: 40px;\n        }\n        \n        /* Headings */\n        h1, h2, h3, h4, h5, h6 {\n            margin-top: 24px;\n            margin-bottom: 16px;\n            font-weight: 600;\n            line-height: 1.25;\n            color: #1f2328;\n        }\n        \n        h1 {\n            font-size: 2em;\n            margin-top: 0;\n            padding-bottom: 0.3em;\n            border-bottom: 1px solid #d1d9e0b3;\n        }\n        \n        h2 {\n            font-size: 1.5em;\n            padding-bottom: 0.3em;\n            border-bottom: 1px solid #d1d9e0b3;\n        }\n        \n        h3 {\n            font-size: 1.25em;\n        }\n        \n        h4 {\n            font-size: 1em;\n        }\n        \n        h5 {\n            font-size: 0.875em;\n        }\n        \n        h6 {\n            font-size: 0.85em;\n            color: #59636e;\n        }\n        \n        /* Paragraphs */\n        p {\n            margin-top: 0;\n            margin-bottom: 16px;\n            line-height: 1.5;\n        }\n        \n        /* Lists */\n        ul, ol {\n            margin-top: 0;\n            margin-bottom: 16px;\n            padding-left: 2em;\n        }\n        \n        li {\n            margin-top: 0.25em;\n        }\n        \n        li.checked {\n            color: #27ae60;\n            list-style-type: none;\n            margin-left: -1.25em;\n        }\n        \n        li.unchecked {\n            color: #59636e;\n            list-style-type: none;\n            margin-left: -1.25em;\n        }\n        \n        /* Tables */\n        table {\n            width: 100%;\n            border-collapse: collapse;\n            border-spacing: 0;\n            margin-top: 0;\n            margin-bottom: 16px;\n            display: block;\n            overflow: auto;\n        }\n        \n        thead {\n            display: table-header-group;\n            vertical-align: middle;\n        }\n        \n        tbody {\n            display: table-row-group;\n            vertical-align: middle;\n        }\n        \n        tr {\n            background-color: #ffffff;\n            border-top: 1px solid #d1d9e0;\n        }\n        \n        tr:nth-child(2n) {\n            background-color: #f6f8fa;\n        }\n        \n        th, td {\n            padding: 6px 13px;\n            border: 1px solid #d1d9e0;\n        }\n        \n        th {\n            font-weight: 600;\n            background-color: #f6f8fa;\n            text-align: left;\n        }\n        \n        /* Code */\n        code {\n            padding: 0.2em 0.4em;\n            margin: 0;\n            font-size: 85%;\n            background-color: rgba(175, 184, 193, 0.2);\n            border-radius: 6px;\n            font-family: ui-monospace, SFMono-Regular, \"SF Mono\", Menlo, Consolas, \"Liberation Mono\", monospace;\n        }\n        \n        /* Text formatting */\n        strong {\n            font-weight: 600;\n        }\n        \n        em {\n            font-style: italic;\n        }\n        \n        /* Links */\n        a {\n            color: #0969da;\n            text-decoration: none;\n        }\n        \n        a:hover {\n            text-decoration: underline;\n        }\n        \n        /* Horizontal rule */\n        hr {\n            height: 0.25em;\n            padding: 0;\n            margin: 24px 0;\n            background-color: #d1d9e0;\n            border: 0;\n        }\n        \n        /* Responsive design */\n        @media print {\n            body {\n                background-color: white;\n                padding: 0;\n            }\n            .container {\n                padding: 20px;\n            }\n        }\n        \n        @media (max-width: 768px) {\n            .container {\n                padding: 20px;\n            }\n            h1 {\n                font-size: 1.75em;\n            }\n            h2 {\n                font-size: 1.375em;\n            }\n            table {\n                font-size: 0.9em;\n            }\n            th, td {\n                padding: 4px 8px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        ${content}\n    </div>\n</body>\n</html>`;\n}\n\n// ========================================\n// N8N EXECUTION CODE - THIS RUNS IN N8N\n// ========================================\n\n// Get markdown from input item\n// Change 'markdown' to your actual field name if different\nconst markdown = $input.item.json.markdown;\n\n// Convert to HTML\nconst html = markdownToHtml(markdown);\n\n// Return as array of items (n8n format)\nreturn [{ \n  json: { \n    html: html,\n    original_markdown: markdown // optional: keep original\n  } \n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1200,
        2128
      ],
      "id": "4af3f52b-d688-4848-87eb-1b5bc51d3c01",
      "name": "Convert to HTML",
      "alwaysOutputData": false,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "content": "![n8n Creator Profile](https://pub-a17d2fc7266e4743b378a51308926c96.r2.dev/Rankenstein%20v9.png)",
        "height": 480,
        "width": 928,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        480,
        -304
      ],
      "id": "36bcb633-3ed5-4a45-bddf-1f0f1ab6d205",
      "name": "Sticky Note43"
    },
    {
      "parameters": {
        "content": "![n8n Creator Profile](https://pub-70c57f6d49284d1da8650039c2add836.r2.dev/ai%20marketing%20hub.png)",
        "height": 176,
        "width": 272,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1616,
        2064
      ],
      "id": "cfecdabd-aa8c-4117-aaee-654be13079f2",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "**Workflow created by [@AgriciDaniel](https://www.youtube.com/@AgriciDaniel)**\n* [AI Marketing Hub](https://www.skool.com/ai-marketing-hub)\n* [AI Marketing Hub Pro](https://www.skool.com/ai-marketing-hub-pro)",
        "height": 96,
        "width": 272,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1616,
        2224
      ],
      "id": "626dcba8-68b0-418d-9324-08a17102a61b",
      "name": "Sticky Note10"
    },
    {
      "parameters": {
        "content": "## Rankenstein v9 ->  Step 5 - Keyword Research, Outline & First Article Draft\n## 1. Insert the Session IDs from Part 1 & 2 \nYou need the internal links & business analysis session id. Insert them in the `Session data üëÄ` node marked with red.\n\n## **2. Select the Business Data Table in the 3d node**\n in `Get business data` node (the Third node), select the Business Data Table. Make sure it is set as `Get`. \n   * Session_id = `{{ $json['Business Data Session ID'] }}`\n\n## **3. Configure AI Agentsü§ñ**\nYou'll need to add your **Gemini** API key in the `Keyword Strategist`, `Outline Creator` and `Content Creator` AI Agent.s \n\n### **Keyword Strategist**\n* **Model:** Gemini 2.5 Pro\n* **Connections:**\n  * `get_Business_data` ‚Üí **Business Data Table**\n  * `serp_search`, `get_business_ranked_keywords`, `keyword_overview` & `suggested_keywords` ‚Üí **Part 0 - Tools (Sub-workflow)**\n\n### **Outline Creator**\n* **Model:** Gemini 2.5 Pro\n* **Connections:**\n  * `get_internal_links` -> **Internal Links Data Table** \n  * `get_business_ranked_keywords` ‚Üí **Part 0 - Tools (Sub-workflow)**\n  * `get_Business_data` ‚Üí **Business Data Table**\n* eeat_agent (sub-agent) -> Gemini2.5 Flash\n  * `online_search` ‚Üí **Perplexity**\n  * `get_eeat_citation` ‚Üí **EEAT Citations Data Table**\n\n### **Content Creator**\n* **Model:** Gemini 2.5 Pro\n\n### **Article Metadata Generator**\n* **Model:** Claude Sonnet 4.5\nYou can get the API key from [here](https://www.claude.com/platform/api)\n\n## **3. Google Drive nodes**\n`Create Research` & `Create Outline` requires google drive (cloud) API.\n[How to set up google cloud](https://www.youtube.com/watch?v=H1Kt1adcr84)\n   * Create a folder, set up share persion as `View` and select it as **Parent Folder**\n\n## **4. Google Sheets nodes**\nMake sure u set up your google sheets cloud API.\nConnect `Research Link`, `Outline Link` and `Insert Blog Data` to the copied [Rankenstein v9 Dashboard Sheets]((https://docs.google.com/spreadsheets/d/1HuKg1bh2oY4SZnjZMyn-yWUCPo_1ZqjoNkdtoHLUhUk/edit?usp=sharing)).\n\nMake a copy of this [google sheets](https://docs.google.com/spreadsheets/d/1HuKg1bh2oY4SZnjZMyn-yWUCPo_1ZqjoNkdtoHLUhUk/edit?usp=sharing)\nAfter you copied the sheets, connect the `insert_topic_in_sheets` tool to the sheets and follow the example on the right. \n\n## **4. Connect Your Wordpress Credentials**\nIn `Create a Post`, `Upload Image` and `Set Featured image` and `Update image meta` wordpress nodes, connect your WordPress account.\n[How to connect Wordpress to n8n](https://www.youtube.com/watch?v=xioMvEWt-NE)\nIn `Upload Image` and `Set Featured image` and `Update image meta` -  in the url field, put your own Wordpress domain URL.\n",
        "height": 1488,
        "width": 624,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -192,
        704
      ],
      "id": "4e9f5b09-30e4-4867-b00e-4dac3efd3158",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "## Please Note:\nIn the [Rankenstein v9 Dashboard Sheets](https://docs.google.com/spreadsheets/d/1HuKg1bh2oY4SZnjZMyn-yWUCPo_1ZqjoNkdtoHLUhUk/edit?usp=sharing), go to `Extensions` > `Apps Script` and paste script from the Sticky Note below. Change the `YOUR-N8N-WEBHOOK-URL` to your webhook URL. \n\nAfter that, go to Triggers ‚è±Ô∏è (in the same Apps Script menu) and add a new trigger.\nSet the Trigger as follows:\n-> watchChanges, Head, From Spreadsheet, On Edit\nThen click `Save`. If nothing happens, make sure to enable pop-up (next to your url).\n[Check this video of Jono for reference (min 17:13)](https://www.youtube.com/watch?v=l61rIq-LLmk&t=1033s)",
        "height": 240,
        "width": 624,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -192,
        272
      ],
      "id": "07a55f73-136c-4066-9aca-43f6ce39d2de",
      "name": "Sticky Note12"
    },
    {
      "parameters": {
        "content": "//For use with the Watch Changes module. Paste the webhook URL from your scenario here:\nWATCH_CHANGE_WEBHOOK_URL = 'YOUR-N8N-WEBHOOK-URL'; \nSHEET = ''; //SHEET allows you to trigger updates only for the specified sheet (by name)\n// e.g. SHEET = 'Sheet1'\nRANGE = ''; //RANGE allows you to trigger updates only for values within this range (by A1 notation)\n// e.g. RANGE = 'A1:C9'\n\n\n//For use with the Perform a Function module. Paste the webhook URL from your scenario here:\nPERFORM_FUNCTION_WEBHOOK_URL =  '';\n\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////     DO NOT TOUCH BELOW!!!     ////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n\nfunction watchChanges(e) {\n  console.log('=== WATCHCHANGES TRIGGERED ===');\n  \n  // Add validation\n  if (!e) {\n    console.log('ERROR: No event object found');\n    return null;\n  }\n  \n  console.log('Event object exists');\n  \n  // REQUIRED\n  const UPDATE_WEBHOOK_URL = WATCH_CHANGE_WEBHOOK_URL;\n\n  if(!UPDATE_WEBHOOK_URL) {\n    console.log('ERROR: Enter WATCH_CHANGE_WEBHOOK_URL');\n    throw new Error('Enter WATCH_CHANGE_WEBHOOK_URL');\n  }\n  \n  console.log('Webhook URL:', UPDATE_WEBHOOK_URL);\n\n  // OPTIONAL\n  const sheetValue = SHEET;\n  const rangeValue = RANGE;\n\n  // Get sheet and range info\n  const range = e.range;\n  if (!range) {\n    console.log('ERROR: No range found in event object');\n    return null;\n  }\n  \n  console.log('Range found:', range.getA1Notation());\n  \n  const sheet = range.getSheet();\n  const ss = sheet.getParent();\n\n  if (sheetValue && sheetValue !== '' && sheetValue !== sheet.getName()) {\n    console.log('No triggering - wrong sheet. Expected:', sheetValue, 'Got:', sheet.getName());\n    return null;\n  }\n  \n  if (sheetValue && rangeValue !== '' && !isWithinRange_(range.getA1Notation(), rangeValue)) {\n    console.log('No triggering - outside range. Expected:', rangeValue, 'Got:', range.getA1Notation());\n    return null;\n  }\n\n  console.log('Preparing payload...');\n\n  const dataRange = sheet.getDataRange();\n  const rowStart = range.getRow();\n  const rowEnd = range.getRow() + range.getNumRows() - 1;\n  \n  const dataArr = sheet.getRange(rowStart, 1, rowEnd - rowStart + 1, dataRange.getLastColumn()).getValues();\n  const rowValues = [];\n\n  dataArr.forEach(function (row) {\n    const out = {};\n    row.forEach(function (v, i) {\n      out[i] = v;\n    });\n    rowValues.push(out);\n  });\n\n  const payload = {\n    spreadsheetId: ss.getId(),\n    spreadsheetName: ss.getName(),\n    sheetId: sheet.getSheetId(),\n    sheetName: sheet.getName(),\n    rangeA1Notation: range.getA1Notation(),\n    oldValue: e.oldValue,\n    value: e.value,\n    user: e.user ? e.user.email : 'unknown',\n    rowValues: rowValues\n  };\n\n  console.log('Payload prepared:', JSON.stringify(payload));\n\n  const options = {\n    method: 'post',\n    contentType: 'application/json',\n    payload: JSON.stringify(payload)\n  };\n\n  console.log('Sending webhook request...');\n\n  try {\n    const response = UrlFetchApp.fetch(UPDATE_WEBHOOK_URL, options);\n    console.log('SUCCESS! Response status:', response.getResponseCode());\n    console.log('Response content:', response.getContentText());\n  } catch (error) {\n    console.log('ERROR sending webhook:', error.toString());\n    console.log('Error details:', error);\n  }\n  \n  console.log('=== WATCHCHANGES COMPLETE ===');\n}\n\nfunction isWithinRange_(a1Notation, rangeToCheck) {\n  // arguments = [a1Notation, rangeToCheck]\n\n  var input = Array.prototype.map.call(arguments, function (e) {\n    return e.toUpperCase();\n  });\n  var rangeArgs = /^([A-Z]+)?(\\d+)?:([A-Z]+)?(\\d+)?$/.exec(input[1]);\n  var a1NotationArgs = /^([A-Z]+)(\\d+)$/.exec(input[0]).map(function (e, i) {\n    return i == 1 ? ('  ' + e).substr(-2) : e * 1;\n  });\n  /* If range arguments are missing(like missing end column in \"A1:1\"), add arbitrary arguments(like \"A1:ZZ1\")*/\n  rangeArgs = rangeArgs.map(function (e, i) {\n    return e === undefined ?\n      i % 2 === 0 ?\n        i > 2 ?\n          Infinity : -Infinity\n        : i > 2 ?\n          'ZZ' : ' A'\n      : i % 2 === 0 ?\n        e * 1 : ('  ' + e).substr(-2);\n  });\n  console.log(rangeArgs, a1NotationArgs);\n  return (a1NotationArgs[1] >= rangeArgs[1] &&\n    a1NotationArgs[1] <= rangeArgs[3] &&\n    a1NotationArgs[2] >= rangeArgs[2] &&\n    a1NotationArgs[2] <= rangeArgs[4]);\n}\n\n/**\n* @return The result of the n8n scenario execution.\n* @customfunction\n*/\nfunction n8n(input) {\n\n  const FUNCTION_WEBHOOK_URL = PERFORM_FUNCTION_WEBHOOK_URL;\n\n  if (!FUNCTION_WEBHOOK_URL){\n    console.log('Enter PERFORM_FUNCTION_WEBHOOK_URL');\n    throw new Error('Enter PERFORM_FUNCTION_WEBHOOK_URL');\n  }\n\n  var spreadsheet = SpreadsheetApp.getActive();\n  var cell = spreadsheet.getActiveCell();\n\n  var payload = {\n    spreadsheetId: spreadsheet.getId(),\n    spreadsheetName: spreadsheet.getName(),\n    sheetId: spreadsheet.getSheetId(),\n    sheetName: spreadsheet.getSheetName(),\n    cell: cell.getA1Notation(),\n    col: cell.getColumn(),\n    row: cell.getRow(),\n    parametersArray: [],\n    parametersCollection: {}\n  };\n\n  for(var i = 0; i < arguments.length; i++) {\n    payload.parametersArray.push(arguments[i]);\n    payload.parametersCollection['p' + i] = arguments[i];\n  }\n\n  var options = {\n    method: 'post',\n    contentType: 'application/json',\n    payload: JSON.stringify(payload)\n  };\n\n  var response = UrlFetchApp.fetch(FUNCTION_WEBHOOK_URL, options);\n\n  return JSON.parse(response.getContentText()).value;\n}\n\n\n/**\n* @return The result of the n8n scenario execution.\n* @customfunction\n*/\nfunction n8n_FUNCTION(input) {\n  return n8n(input);\n}",
        "width": 624,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -192,
        512
      ],
      "id": "e1a69fae-5cce-4ea9-b9a2-9ed1d7aee1a0",
      "name": "Sticky Note4"
    }
  ],
  "pinData": {
    "Sheets Webhook": [
      {
        "json": {
          "headers": {
            "host": "agrici.app.n8n.cloud",
            "user-agent": "Mozilla/5.0 (compatible; Google-Apps-Script; beanserver; +https://script.google.com; id: UAEmdDd9oVbmYQJal2KmgB1JdiirMv5GB3A)",
            "content-length": "661",
            "accept-encoding": "gzip, br",
            "cdn-loop": "cloudflare; loops=1; subreqs=1",
            "cf-connecting-ip": "34.98.143.76",
            "cf-ew-via": "15",
            "cf-ipcountry": "US",
            "cf-ray": "99a7592791e52264-ORD",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "cf-worker": "n8n.cloud",
            "content-type": "application/json",
            "x-forwarded-for": "34.98.143.76, 172.71.254.182",
            "x-forwarded-host": "agrici.app.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "traefik-prod-users-gwc-40-669b86c79-c5x7g",
            "x-is-trusted": "yes",
            "x-real-ip": "34.98.143.76"
          },
          "params": {},
          "query": {},
          "body": {
            "spreadsheetId": "1rWyiIdQh_rWtiSYdJm4qNvc1LqduTdaJbBu6sXXzmzM",
            "spreadsheetName": "Rankenstein v9 Dashboard",
            "sheetId": 1328152878,
            "sheetName": "Wordpress Content",
            "rangeA1Notation": "E5",
            "value": "Generate Article",
            "user": "agricidaniel@gmail.com",
            "rowValues": [
              {
                "0": "06 November 2025",
                "1": "la ce varsta corpul elimina mai putin colagen",
                "2": "»òtiin»õa pierderii de colagen: Mecanisme »ôi factori",
                "3": "AflƒÉ de ce corpul produce mai pu»õin colagen odatƒÉ cu v√¢rsta. ExplorƒÉm mecanismele biologice »ôi factorii externi (soare, dietƒÉ, stres) care accelereazƒÉ degradarea, baz√¢ndu-ne pe studii »ôtiin»õifice recente.",
                "4": "Generate Article",
                "5": "",
                "6": "",
                "7": ""
              }
            ]
          },
          "webhookUrl": "https://agrici.app.n8n.cloud/webhook/rankenstein-part-5",
          "executionMode": "production"
        }
      }
    ]
  },
  "connections": {
    "Get Business Data": {
      "main": [
        [
          {
            "node": "Get Topic Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_business_Data": {
      "ai_tool": [
        [
          {
            "node": "Keyword Strategist",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get_business_ranked_Keywords": {
      "ai_tool": [
        [
          {
            "node": "Keyword Strategist",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get_eeat_citations": {
      "ai_tool": [
        [
          {
            "node": "eeat_agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Update Processing": {
      "main": [
        [
          {
            "node": "SessioN Data üëÄ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SessioN Data üëÄ": {
      "main": [
        [
          {
            "node": "Get Business Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Outline Creator": {
      "main": [
        [
          {
            "node": "Get Outline",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sheets Webhook": {
      "main": [
        [
          {
            "node": "Filter Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Action": {
      "main": [
        [
          {
            "node": "Update Processing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "online_search": {
      "ai_tool": [
        [
          {
            "node": "eeat_agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "serp_search": {
      "ai_tool": [
        [
          {
            "node": "Keyword Strategist",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "suggested_keywords": {
      "ai_tool": [
        [
          {
            "node": "Keyword Strategist",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "2.5 Flash": {
      "ai_languageModel": [
        [
          {
            "node": "eeat_agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Keyword Strategist": {
      "main": [
        [
          {
            "node": "Outline Creator",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Research",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Article Data": {
      "main": [
        [
          {
            "node": "HTML Format",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML Format": {
      "main": [
        [
          {
            "node": "Article Metadata Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate an image": {
      "main": [
        [
          {
            "node": "Convert to WebP",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a post": {
      "main": [
        [
          {
            "node": "Generate an image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload Image": {
      "main": [
        [
          {
            "node": "Update image meta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Featured Image": {
      "main": [
        [
          {
            "node": "Get WP Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update image meta": {
      "main": [
        [
          {
            "node": "Set Featured Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Wordpress": {
      "main": [
        [
          {
            "node": "Create a post",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Article Metadata Generator": {
      "main": [
        [
          {
            "node": "Prepare Wordpress",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to WebP": {
      "main": [
        [
          {
            "node": "Upload Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get WP Data": {
      "main": [
        [
          {
            "node": "Insert Blog Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Topic Data": {
      "main": [
        [
          {
            "node": "Keyword Strategist",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "eeat_agent": {
      "ai_tool": [
        [
          {
            "node": "Outline Creator",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "merge": {
      "main": [
        [
          {
            "node": "<-",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_business_data": {
      "ai_tool": [
        [
          {
            "node": "eeat_agent",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "Outline Creator",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get_internal_Links": {
      "ai_tool": [
        [
          {
            "node": "Outline Creator",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Research Link": {
      "main": [
        [
          {
            "node": "merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Outline Link": {
      "main": [
        [
          {
            "node": "merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Content Creator": {
      "main": [
        [
          {
            "node": "Get First Draft",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_business_ranked_keywords": {
      "ai_tool": [
        [
          {
            "node": "Outline Creator",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "think_tool": {
      "ai_tool": [
        [
          {
            "node": "Outline Creator",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "eeat_agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think_tool": {
      "ai_tool": [
        [
          {
            "node": "Keyword Strategist",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "keyword_overview": {
      "ai_tool": [
        [
          {
            "node": "Keyword Strategist",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Arrange by sections": {
      "main": [
        [
          {
            "node": "Article Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get First Draft": {
      "main": [
        [
          {
            "node": "Arrange by sections",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Research": {
      "main": [
        [
          {
            "node": "HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML": {
      "main": [
        [
          {
            "node": "Create Research",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Research": {
      "main": [
        [
          {
            "node": "Research Link",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Outline": {
      "main": [
        [
          {
            "node": "html",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "html": {
      "main": [
        [
          {
            "node": "Create Outline",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Outline": {
      "main": [
        [
          {
            "node": "Outline Link",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "<-": {
      "main": [
        [
          {
            "node": "Content Creator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Think_Tool": {
      "ai_tool": [
        [
          {
            "node": "Content Creator",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "Article Metadata Generator",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Output": {
      "ai_outputParser": [
        [
          {
            "node": "Article Metadata Generator",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Error Trigger": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sonnet4.5": {
      "ai_languageModel": [
        [
          {
            "node": "Article Metadata Generator",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Output",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Get Article": {
      "main": [
        [
          {
            "node": "Convert to HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to HTML": {
      "main": [
        [
          {
            "node": "Create Article",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "e4108fd0-5a28-4fc0-bcab-15ee54a03ceb",
  "meta": {
    "instanceId": "1ee7b11b3a4bb285563e32fdddf3fbac26379ada529b942ee7cda230735046a1"
  },
  "id": "vZg61lngIFouGZpA",
  "tags": []
}